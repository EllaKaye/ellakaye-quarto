<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ella Kaye">
<meta name="dcterms.date" content="2021-05-26">
<meta name="description" content="How to create an appealing and accessible colour palette for a syntax highlighting scheme">

<title>ELLA KAYE - Custom Syntax Highlighting for {distill} Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-101621242-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<script>
  
  function getGiscusTheme() {
  const quartoTheme = localStorage.getItem("quarto-color-scheme");
  const giscusTheme = quartoTheme === "alternate" ? "dark" : "light";
  return giscusTheme;
}

function setGiscusTheme() {
  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }
  sendMessage({
    setConfig: {
      theme: getGiscusTheme(),
    },
  });
}

document.addEventListener('DOMContentLoaded', function () {
  const giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-repo": "EllaKaye/ellakaye-quarto",
    "data-repo-id": "R_kgDOHwJk_g",
    "data-category": "General",
    "data-category-id": "DIC_kwDOHwJk_s4CQr7D",
    "data-mapping": "title",
    "data-strict": "0",
    "data-reactions-enabled": "1",
    "data-emit-metadata": "0",
    "data-input-position": "top",
    "data-theme": getGiscusTheme(),
    "data-lang": "en",
    "crossorigin": "anonymous",
    "async": "",
  };

  // Dynamically create script tag
  const giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.body.appendChild(giscusScript);

  // Update giscus theme when theme switcher is clicked
  const toggle = document.querySelector('.quarto-color-scheme-toggle');
  if (toggle) {
    toggle.addEventListener('click', setGiscusTheme);
  }
});
  
</script>


<link rel="stylesheet" href="../../ek-styles.css">
<meta property="og:title" content="ELLA KAYE - Custom Syntax Highlighting for {distill} Part 2">
<meta property="og:description" content="How to create an appealing and accessible colour palette for a syntax highlighting scheme">
<meta property="og:image" content="https://ellakaye.co.uk/images/logo-white-background.png">
<meta property="og:site-name" content="ELLA KAYE">
<meta property="og:locale" content="en-GB">
<meta property="og:image:height" content="500">
<meta property="og:image:width" content="500">
<meta property="og:image:alt" content="A swatch of five colours, a pink, orange, green, blue and purple, all quite bright, but still all with a contrast ratio of 4.5:1 or better against white.
">
<meta name="twitter:title" content="ELLA KAYE - Custom Syntax Highlighting for {distill} Part 2">
<meta name="twitter:description" content="How to create an appealing and accessible colour palette for a syntax highlighting scheme">
<meta name="twitter:image" content="https://ellakaye.co.uk/posts/2021-05-26_custom-highlighting-distill-2/ek-syntax-highlighting-palette.png">
<meta name="twitter:creator" content="@ellamkaye">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="669">
<meta name="twitter:image-width" content="1100">
<meta name="twitter:image:alt" content="A swatch of five colours, a pink, orange, green, blue and purple, all quite bright, but still all with a contrast ratio of 4.5:1 or better against white.
">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ELLA<span class="icon-line"></span>KAYE</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">about</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">posts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html">talks</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../packages.html">packages</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../community.html">community</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact.html">contact</a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Custom Syntax Highlighting for {distill} Part 2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
            <p class="subtitle lead">Creating the Palette</p>
                  <div>
        <div class="description">
          <p>How to create an appealing and accessible colour palette for a syntax highlighting scheme</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">distill</div>
                <div class="quarto-category">colour</div>
                <div class="quarto-category">accessibility</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ella Kaye </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 26, 2021</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#part-1-recap-and-part-2-overview" id="toc-part-1-recap-and-part-2-overview" class="nav-link active" data-scroll-target="#part-1-recap-and-part-2-overview">Part 1 recap and Part 2 overview</a></li>
  <li><a href="#a-brief-primer-on-colour-theory" id="toc-a-brief-primer-on-colour-theory" class="nav-link" data-scroll-target="#a-brief-primer-on-colour-theory">A brief primer on colour theory</a>
  <ul class="collapse">
  <li><a href="#colour-harmonies" id="toc-colour-harmonies" class="nav-link" data-scroll-target="#colour-harmonies">Colour harmonies</a></li>
  <li><a href="#colour-spaces" id="toc-colour-spaces" class="nav-link" data-scroll-target="#colour-spaces">Colour spaces</a></li>
  </ul></li>
  <li><a href="#approach-1-colorslurp-and-hsb" id="toc-approach-1-colorslurp-and-hsb" class="nav-link" data-scroll-target="#approach-1-colorslurp-and-hsb">Approach 1: ColorSlurp and HSB</a>
  <ul class="collapse">
  <li><a href="#building-a-palette-based-on-my-pink-using-colour-theory" id="toc-building-a-palette-based-on-my-pink-using-colour-theory" class="nav-link" data-scroll-target="#building-a-palette-based-on-my-pink-using-colour-theory">Building a palette based on my <span style="color:#D4006A">pink</span>, using colour theory</a></li>
  <li><a href="#adapting-for-web-accessibility" id="toc-adapting-for-web-accessibility" class="nav-link" data-scroll-target="#adapting-for-web-accessibility">Adapting for web accessibility</a></li>
  <li><a href="#checking-for-colourblindness" id="toc-checking-for-colourblindness" class="nav-link" data-scroll-target="#checking-for-colourblindness">Checking for colourblindness</a></li>
  </ul></li>
  <li><a href="#approach-2-an-r-based-hcl-alternative" id="toc-approach-2-an-r-based-hcl-alternative" class="nav-link" data-scroll-target="#approach-2-an-r-based-hcl-alternative">Approach 2: An R-based HCL alternative</a>
  <ul class="collapse">
  <li><a href="#building-a-palette-based-on-my-pink-using-colour-theory-1" id="toc-building-a-palette-based-on-my-pink-using-colour-theory-1" class="nav-link" data-scroll-target="#building-a-palette-based-on-my-pink-using-colour-theory-1">Building a palette based on my <span style="color:#D4006A">pink</span>, using colour theory</a></li>
  <li><a href="#adapting-for-web-accessibility-1" id="toc-adapting-for-web-accessibility-1" class="nav-link" data-scroll-target="#adapting-for-web-accessibility-1">Adapting for web accessibility</a></li>
  <li><a href="#checking-for-colourblindness-1" id="toc-checking-for-colourblindness-1" class="nav-link" data-scroll-target="#checking-for-colourblindness-1">Checking for colourblindness</a></li>
  <li><a href="#but-do-i-like-it" id="toc-but-do-i-like-it" class="nav-link" data-scroll-target="#but-do-i-like-it">But, do I like it?</a></li>
  </ul></li>
  <li><a href="#back-to-part-1" id="toc-back-to-part-1" class="nav-link" data-scroll-target="#back-to-part-1">Back to Part 1</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/EllaKaye/ellakaye-quarto/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="callout-note top-callout callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Update: August 2022
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Since this post was originally written, I have replaced my {disill} website with this one built with <a href="https://quarto.org">Quarto</a>.</p>
<p>The highlighting you’ll see below is not quite the same as it appeared on my previous site, because the default <code>arrow</code> theme is implemented differently in {distill} and Quarto.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Moreover, I’m now using a very pale gray rather than white background, which necessitated a small shift in the green to achieve a sufficient colour contrast. And if you’re reading this in dark mode, it’s a whole different scheme again, though built on the same principles as described below.</p>
<p>I am keeping this post otherwise as was on the blog for posterity. Most of the content holds, regardless of how the site was built.</p>
</div>
</div>
</div>
<div class="cell">

</div>
<section id="part-1-recap-and-part-2-overview" class="level2">
<h2 class="anchored" data-anchor-id="part-1-recap-and-part-2-overview">Part 1 recap and Part 2 overview</h2>
<p>In Part 1 of this series, <a href="https://ellakaye.rbind.io/posts/2021-05-25-custom-syntax-highlighting-for-distill-part-1-modifying-the-default-theme/">custom syntax highlighting for {distill}: modifying the theme</a>, I describe how and why I went about the process of finding and modifying the default syntax highlighting for <a href="(https://rstudio.github.io/distill/)">{distill}</a> and how I created a function that wrapped that process for <a href="https://ellakaye.github.io/distilltools">{distilltools}</a>. I discuss the default syntax highlighting theme used on {distill} sites, and how we can modify it by replacing the five colours used there with five colours of our choosing.</p>
<p>I also outline the four criteria that were important to me as I went about choosing colours for my own syntax highlighting theme:</p>
<ul>
<li>It be based on the <span style="color:#D4006A">pink</span> that I use in my logo and elsewhere throughout this site</li>
<li>It uses colour theory to pick colours that look appealing together</li>
<li>It meets <a href="https://www.w3.org/WAI/standards-guidelines/wcag/">WCAG web accessibility guidelines</a>, by ensuring sufficient colour contrast, i.e.&nbsp;a ratio of 4.5:1, between each of the colours in the theme and this site’s background colour (white)</li>
<li>The colours in the palette are colourblind-friendly, i.e.&nbsp;still distinguishable to people with various difference types of colourblindness.</li>
</ul>
<p>This post spins out from Part 1 with a brief primer on colour theory and then a deep-dive into the processes, both thought and practical, of choosing colours for my palette that meet the above criteria. I show how I first went about this to derive the palette that’s implemented throughout this site. I also demonstrate a different, entirely R-based, approach to satisfying the criteria, which I decided to try out after learning more about different colour spaces as I was writing up this post. I much preferred the outcome of one approach to the other, but your mileage may vary.</p>
</section>
<section id="a-brief-primer-on-colour-theory" class="level2">
<h2 class="anchored" data-anchor-id="a-brief-primer-on-colour-theory">A brief primer on colour theory</h2>
<section id="colour-harmonies" class="level3">
<h3 class="anchored" data-anchor-id="colour-harmonies">Colour harmonies</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hsl-colour-wheel" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="hsl-colour-wheel-d4006a-annotated.png" class="img-fluid figure-img" alt="A circle filled with hues of red at the top (0 degrees), moving smoothly through orange, yellow (60 degrees), green (120 degrees), cyan (180 degrees), blue (240 degrees) and magenta(300 degrees) as you rotate clockwise round the circle. The colours are more saturated towards the edge of the circle and greyer towards the centre." width="375"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: An HSL colour wheel. Screen shot from <a href="https://www.canva.com/colors/color-wheel/">https://www.canva.com/colors/color-wheel/</a>, annotations adapted from <a href="https://dev.to/rneha725/hsl-and-hsla-in-css-31j3">https://dev.to/rneha725/hsl-and-hsla-in-css-31j3</a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Colour theory determines which colours ‘look good’ together, based on their relative position on a colour wheel, such as that in <a href="#fig-hsl-colour-wheel">Figure&nbsp;1</a>, somewhat analogously, I think, to how certain musical intervals sound more pleasing/harmonious than others, depending on the ratio of their frequencies. As shown in <a href="#fig-colour-harmonies">Figure&nbsp;2</a>, there are various different types of colour palettes that are in colour harmony, such as complementary (comprised of colours opposite each other on the wheel), analogous (three colours side by side) and triadic (three colours evenly spaced around the wheel). Note that all the colour schemes are derived from the same twelve colours, spaced evenly around a circle.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-colour-harmonies" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="colour-harmonies.jpg" class="img-fluid figure-img" alt="Six wheels each split into 12 equal segments of different colours, equally spaced round the colour wheel. Each wheel highlights two, three or four of these colours that look harmonious together."></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Harmonious colour combinations. Figure from <a href="https://www.widewalls.ch/magazine/color-theory-basics-elements-color-wheel">https://www.widewalls.ch/magazine/color-theory-basics-elements-color-wheel</a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="colour-spaces" class="level3">
<h3 class="anchored" data-anchor-id="colour-spaces">Colour spaces</h3>
<section id="rgb-hsb-and-hsl" class="level4">
<h4 class="anchored" data-anchor-id="rgb-hsb-and-hsl">RGB, HSB and HSL</h4>
<p>Another aspect of colour theory relates to colour spaces, and different ways that colours can be defined. The best known, at least in the context of designing for the web, is RGB (<strong>R</strong>ed <strong>G</strong>reen <strong>B</strong>lue), which defines a colour by how much of each of those three primary colours it contains, in a range of 0-255. It is the hexidecimal representations of these three numbers that combine to make up the hex code for a colour.</p>
<p>More intuitive, however, for adjusting colours, is defining them by HSB (<strong>H</strong>ue, <strong>S</strong>aturation, <strong>B</strong>rightness), also known as HSV (<strong>H</strong>ue, <strong>S</strong>aturation, <strong>V</strong>alue). HSB is a simple transformation of the RGB space. Similar to HSB is HSL (<strong>H</strong>ue, <strong>S</strong>aturation, <strong>L</strong>ightness), though HSL is considered an improved over HSB in terms of its perceptual qualities.</p>
<p>In HSB, the hue represents the colour type and is a number measured between 0 and 360°; it’s where you are on the colour wheel, ignoring how bright or intense the colour is. Saturation describes the intensity or richness of the hue, measured between 0 and 100%. 100% is the richest version of the colour and 0% is a shade of grey. Brightness measures, you guessed it, the brightness of the colour. Again, it ranges from 0 to 100%, with 0% being black and 100% being a very bright colour (here, black is not the opposite of white). Here’s an <a href="https://learnui.design/blog/the-hsb-color-system-practicioners-primer.html">excellent article on the HSB system</a>, which also explains how it differs from HSL. The differences between HSB and HSL are also illustrated in <a href="#fig-hsl-hsb-sliders">Figure&nbsp;3</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hsl-hsb-sliders" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="hsl-hsb-sliders.png" class="img-fluid figure-img" alt="Two sets of three colour sliders, one for HSL the other for HSB. Both have the same scale for hue. In HSL, the saturation runs from grey to bright pink. In HSB with saturation runs from white to bright pink. In HSL, the lightness runs from black to white, via the bright pink. In HSB, the Brightness runs from black to bright pink." width="1200"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: HSL and HSB sliders for the pink used throughout this site. Image is a screenshot from <a href="http://colorizer.org">http://colorizer.org</a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>It’s great to play around with an HSL or HSB colour wheel to get a sense of how harmonious colour schemes are built, and how the colours in them relate to each other on the wheel. I really like the <a href="https://www.canva.com/colors/color-wheel/">canva colour wheel</a>. It’s pretty simple, with only a few schemes, but it’s nicely designed and easy to use, and the page explains the basics of colour theory too. It’s a fun way to start building a palette. I like how you can pull the dots around the wheel and see how the colours relate, and if you click on a colour in the palette, there are HSL sliders too. Plus, as you move colours around, the background of the page changes colour, which is a nice touch!</p>
</section>
<section id="hcl" class="level4">
<h4 class="anchored" data-anchor-id="hcl">HCL</h4>
<p>Whilst websites on colour theory for designers tend to focus on either the HSB or HSL spaces, and it’s HSB or HSL wheels/sliders that tend to be built into design and colour software and apps, both spaces suffer from a lack of perceptual uniformity. The RGB rainbow palette is <a href="https://colorspace.r-forge.r-project.org/articles/endrainbow.html">notorious</a> for this. In general, RBG/HSB/HSL palettes are not a good choice for statistical graphics and data visualisation, where colour conveys meaning. For these purposes, the HCL colour space (<strong>H</strong>ue, <strong>C</strong>hroma, <strong>L</strong>uminance) offers a much better alternative. It is much more suitable for capturing human colour perception.</p>
<p>There is an R package for working with the HCL colour space, the intuitively named <a href="https://colorspace.r-forge.r-project.org/articles/colorspace.html">{colorspace}</a> <span class="citation" data-cites="Zeileis:2020">(<a href="#ref-Zeileis:2020" role="doc-biblioref">Zeileis et al. 2020</a>)</span>. It has many excellent vignettes, including one about the <a href="https://colorspace.r-forge.r-project.org/articles/color_spaces.html">HCL space</a> and its perceptual superiority over other colour spaces. The package also provides <a href="https://colorspace.r-forge.r-project.org/articles/hcl_palettes.html">colour palettes</a> and <a href="https://colorspace.r-forge.r-project.org/articles/ggplot2_color_scales.html">scales for {ggplot2}</a>. There is also support for <a href="https://developer.r-project.org/Blog/public/2019/04/01/hcl-based-color-palettes-in-grdevices/">HCL palettes in base R</a>. The HCL space is also used on <a href="http://medialab.github.io/iwanthue/">I want hue</a>, a site about colours aimed at data scientists, which allows you to generate and refine palettes of optimally distinct colours.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pink-in-hcl" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pink-in-HCL.png" class="img-fluid figure-img" alt="A triangle of HCL space, with bright pink on the far right, transitioning towards light grey on the top left corner and black on the bottom left corner." width="785"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: My pink on the Luminance-Chroma plane in the HCL space. Image is a screenshot from <a href="http://hclwizard.org:3000/hclcolorpicker/">http://hclwizard.org</a>.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>I haven’t seen the HCL space used elsewhere, at least not in the myriad of sites on colour theory for designers or colour/design apps than I use or have read when preparing my theme and this post. Perceptual uniformity is arguably more important in choosing colour palettes for data visualisation, where the colour conveys information about the data, than in picking a few colours that look good together for a syntax highlighting scheme.</p>
</section>
</section>
</section>
<section id="approach-1-colorslurp-and-hsb" class="level2">
<h2 class="anchored" data-anchor-id="approach-1-colorslurp-and-hsb">Approach 1: ColorSlurp and HSB</h2>
<section id="building-a-palette-based-on-my-pink-using-colour-theory" class="level3">
<h3 class="anchored" data-anchor-id="building-a-palette-based-on-my-pink-using-colour-theory">Building a palette based on my <span style="color:#D4006A">pink</span>, using colour theory</h3>
<p>As I discuss in Part 1 of this series, I know that I need a palette of five colours to replace the five colours used in the default syntax highlighting scheme that comes with {distill}. The problem with all the colour schemes defined in <a href="#fig-colour-harmonies">Figure&nbsp;2</a> is that they use a maximum of four colours. But not to worry! We know from colour theory that we can find 12 colours in harmony by taking evenly spaced colours around the HSL or HSB wheel, i.e.&nbsp;colours whose hues are 30° apart, given fixed values for saturation and brightness/lightness. Since we only need five colours, it’s sufficient to find the six colours that are 60° apart, and ignore one of them. Note that for five colours to appear harmonious, we have to respect these angles, not choose five colours that are 72° apart.</p>
<p>The main pink that I use in this site has hex <span style="background-color: #D4006A; color: white; padding:3px">#D4006A</span>. I use a great little Mac app called <a href="https://colorslurp.com">ColorSlurp</a> for building and assessing colour palettes. The basic version is free, though the pro version has great features for testing accessibility - more on that below. In ColorSlurp, I started a new palette with #D4006A as a starting point, then, making sure I was in HSB mode, found its HSB values are 330°, 100%, 83%. Leaving the S and B sliders where they are, the next colour I needed is 60° around the circle, i.e.&nbsp;at 30°, so I moved the H slider to that value and added the resulting orange to the palette. I then repeated that for 90°, 150°, 210° and 270°, giving me two shades of green, a blue and a purple. With a colour selected in ColorSlurp, you can also pull up the colour harmonies tab, <svg aria-hidden="true" role="img" viewbox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M512 255.1C512 256.9 511.1 257.8 511.1 258.7C511.6 295.2 478.4 319.1 441.9 319.1H344C317.5 319.1 296 341.5 296 368C296 371.4 296.4 374.7 297 377.9C299.2 388.1 303.5 397.1 307.9 407.8C313.9 421.6 320 435.3 320 449.8C320 481.7 298.4 510.5 266.6 511.8C263.1 511.9 259.5 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256V255.1zM96 255.1C78.33 255.1 64 270.3 64 287.1C64 305.7 78.33 319.1 96 319.1C113.7 319.1 128 305.7 128 287.1C128 270.3 113.7 255.1 96 255.1zM128 191.1C145.7 191.1 160 177.7 160 159.1C160 142.3 145.7 127.1 128 127.1C110.3 127.1 96 142.3 96 159.1C96 177.7 110.3 191.1 128 191.1zM256 63.1C238.3 63.1 224 78.33 224 95.1C224 113.7 238.3 127.1 256 127.1C273.7 127.1 288 113.7 288 95.1C288 78.33 273.7 63.1 256 63.1zM384 191.1C401.7 191.1 416 177.7 416 159.1C416 142.3 401.7 127.1 384 127.1C366.3 127.1 352 142.3 352 159.1C352 177.7 366.3 191.1 384 191.1z"></path></svg>, which gives quick access to some of these colours. As I only need five colours, I discarded one of the greens, keeping the one at 150°, which is complementary to the starting pink.</p>
<p>If you don’t use ColorSlurp or a similar app, there are many online options for building a palette in this way, for example <a href="http://colorizer.org">http://colorizer.org</a> (add a new color to the palette by clicking on the next square down to the right of the sliders). In both ColorSlurp and on colorizer.org, once you have defined a colour by its HSB values, you can read off the hex code, for ease of use in R.</p>
<p>At the end of this stage of the process, based purely on my pink and colour theory, my syntax highlighting palette now stood as in <a href="#fig-colour-theory-palette">Figure&nbsp;5</a>. In the HSB space, these colours all have a saturation of 100% and a brightness of 83%.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-colour-theory-palette" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="first-colour-swatch.png" class="img-fluid figure-img" alt="A swatch of five colours, very bright and vibrant shades of pink, orange, green, blue and purple." width="674"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Colours for syntax highlighting, starting from my main pink, based only on colour theory</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adapting-for-web-accessibility" class="level3">
<h3 class="anchored" data-anchor-id="adapting-for-web-accessibility">Adapting for web accessibility</h3>
<p>As noted in <a href="https://ellakaye.rbind.io/posts/2021-05-25-custom-syntax-highlighting-for-distill-part-1-modifying-the-default-theme/">Part 1</a> of this series, one key feature of the default syntax highlighting scheme for {distill} is that it is optimised for accessibility and colour contrast. According to the <a href="https://www.w3.org/WAI/standards-guidelines/wcag/">Web Content Accessibility Guidelines</a>, at the WCAG AA (minimum contrast) level, this requires that that contrast ratio between text and background colours be at least 4.5:1 for text of 14pt+ (which is the default text size for code in {distill}). The more stringent WCAG AAA (enhanced) level requires a ratio of at least 7:1.</p>
<p>The pro version of ColorSlurp includes a contrast checker, as in <a href="#fig-colorslurp-contrast">Figure&nbsp;6</a>, though there are many websites that also offer this. WebAIM (Web with Accessibility in Mind) has a very handy <a href="https://webaim.org/resources/contrastchecker/">contrast checker</a> which, like ColorSlurp, also includes sliders for adjusting the colours until the desired contrast is reached. Darkening a colour to improve contrast keeps the hue and saturation the same but reduces the brightness or lightness component (ColorSlurp uses HSB, WebAIM uses HSL).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-colorslurp-contrast" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="contrast-check.png" class="img-fluid figure-img" alt="Comparing my pink and white in the ColorSlurp app shows a contrast of 5.24 for text 14pt+, passing the WCAG AA standard. Sliders below show that the colour can be adjusted." width="598"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Contrast checking in ColorSlurp</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The <span style="background-color: #D4006A; color: white; padding:3px">pink</span>, <span style="background-color: #006AD4; color: white; padding:3px">blue</span> and <span style="background-color: #6A00D4; color: white; padding:3px">purple</span> in the palette created above have a contrast ratio of better than 4.5:1 with the pure white background, but the <span style="background-color: #D46A00; color: black; padding:3px">orange</span> and <span style="background-color: #00D46A; color: black; padding:3px">green</span> do not.</p>
<p>My first thought was to keep the pink, blue and purple the same, and to just reduce the brightness of the orange and green until the contrast ratio was a bit better than required. In the HSB space, that gives the palette in <a href="#fig-orange-green-less-bright">Figure&nbsp;7</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-orange-green-less-bright" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="second-colour-swatch.png" class="img-fluid figure-img" alt="A swatch of five colours, very bright and vibrant shades of pink, blue and purple, with less-bright shades of orange and green" width="673"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Reducing brightness in just the orange and green to achieve desired contrasts.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>It’s not bad, but when I applied that palette as a syntax highlighting scheme, to my eye the pink, blue and purple looked a little too bright relative to the orange.</p>
<p>My next thought was to reduce the brightness on all the colours to the level of the least bright colour that passes the accessibility check (the green, at 53%). That gives the palette in <a href="#fig-all-less-bright">Figure&nbsp;8</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-all-less-bright" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="third-colour-swatch.png" class="img-fluid figure-img" alt="A swatch of five colours, less bright versions of all five colours in the original palette." width="674"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;8: Reducing brightness in all colours to the level of the green.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>That looks way too dark for my liking. I don’t think it’s vibrant enough, and, although the colours all have good contrast against the white background, they don’t have much contrast with each other.</p>
<p>So, I settled on a compromise position. I reduced the brightness of the original pink, blue and purple from 83% to match the brightness of the accessibility-passing orange (71%), leaving only the green at a brightness of 53%, which it needs to pass the contrast check. This gives the palette in <a href="#fig-final-palette">Figure&nbsp;9</a>. To my eye, the green doesn’t appear considerably more dark/less bright than the other four colours. If anything, the greens in <a href="#fig-colour-theory-palette">Figure&nbsp;5</a> and <a href="#fig-all-less-bright">Figure&nbsp;8</a> which both have uniform brighness, look a little too bright compared to the other colours. I guess this is a result of the lack of perceptual uniformity of the HSB space.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-final-palette" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="ek-syntax-highlighting-palette.png" class="img-fluid figure-img" alt="A swatch of five colours, a pink, orange, green, blue and purple, all quite bright, but still all with a contrast ratio of 4.5:1 or better against white." width="550"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9: The palette I settled on for my syntax highlighting scheme.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>I’m happy with that, and that’s the syntax highlighting scheme I’ve adopted throughout this site, despite the fact that the palette now doesn’t actually include the pink that I set out to build my scheme around! However, because of the process I’ve followed, the pink that is in the palette does tone well with the brighter pink and I think my site still has a consistent look. In the end, it was more important that all the colours in the palette looked consistent together and met accessibility guidelines.</p>
<p>I am only just beginning to learn about web accessibility, and I know my site does not yet meet all best practices, but I’m committed to improving in this area. I first became aware of the issue of web accessibility because I follow <a href="https://twitter.com/spcanelon">Silvia Canelón on twitter</a> and I highly recommend you do the same! The <a href="https://www.a11yproject.com">a11y project</a> and <a href="https://webaim.org">WebAIM</a> are great places to learn more.</p>
</section>
<section id="checking-for-colourblindness" class="level3">
<h3 class="anchored" data-anchor-id="checking-for-colourblindness">Checking for colourblindness</h3>
<p>Some visual impairments require a high colour contrast between text and background colour in order to be able to read content on the web. Another class of visual impairment worth paying attention to when designing palettes is that of colour blindness.</p>
<p><a href="https://www.njtierney.com">Nick Tierney</a> has some excellent resources about colour and colourblindness and R packages for accessing these. <a href="https://njt-monash-colour.netlify.app/#1">These comprehensive slides</a> cover what colour is and how we perceive it, colourblindness, how to check how palettes/plots appear to those with different types of colourblindness, the HCL space, the {colorspace} package and how to create your own palettes. He also has a <a href="https://www.njtierney.com/post/2020/10/15/assess-colour/">short blog post</a> on quickly assessing colour palettes to ensure they’re colourblind-friendly.</p>
<p>As recommended in the above posts, I used the <a href="https://emilhvitfeldt.github.io/prismatic/">{prismatic}</a> package by <a href="https://www.hvitfeldt.me">Emil Hvitfeldt</a> to check how my syntax highlighting palette appears to those with different types of colourblindness:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prismatic)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ek_highlight_colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#5B00B6"</span>, <span class="st">"#005BB6"</span>, <span class="st">"#008643"</span>, <span class="st">"#B65B00"</span>, <span class="st">"#B6005B"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">check_color_blindness</span>(ek_highlight_colours)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-check-colourblindness" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="check-colourblindness.png" class="img-fluid figure-img" alt="Four colour palettes. One shows my pink/orange/green/blue/purple palette as is, the other three show how that palette appears to those with deuteranopia, protanopia and tritanopia. Under all those conditions, the five colours are distinguishable." width="647"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;10: Checking my palette for how it appears to those with various types of colourblindness.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Thankfully, for all three main types of colourblindess, the five colours in the palette are distinguishable, so no further adjustments are necessary.</p>
</section>
</section>
<section id="approach-2-an-r-based-hcl-alternative" class="level2">
<h2 class="anchored" data-anchor-id="approach-2-an-r-based-hcl-alternative">Approach 2: An R-based HCL alternative</h2>
<p>The above sections describe the processes, both thought and practical, that I went through to derive the colour palette for my syntax highlighting scheme, and I’m happy with what I came up with. As I was deriving my scheme, I was working in ColorSlurp and only had a cursory knowledge of the differences between the HSB, HSL and HCL colour spaces.</p>
<p>However, as I was writing up this blog post, I become increasingly curious about alternative approaches I might have taken. In particular, could I have come up with a scheme that met my criteria entirely in R? Given the incredible ecosystem that R is, it should be no surprise that the answer turned out to be yes! So, below is this alternative approach, using the <a href="https://colorspace.r-forge.r-project.org">{colorspace}</a>, <a href="https://matt-dray.github.io/coloratio/">{coloratio}</a> and <a href="https://emilhvitfeldt.github.io/prismatic/">{prismatic}</a> packages. Also, whereas the previous approach is based on the HSB colour space, this one uses HCL.</p>
<section id="building-a-palette-based-on-my-pink-using-colour-theory-1" class="level3">
<h3 class="anchored" data-anchor-id="building-a-palette-based-on-my-pink-using-colour-theory-1">Building a palette based on my <span style="color:#D4006A">pink</span>, using colour theory</h3>
<p>The {colorspace} package uses the HCL color space, so the first task was to convert a hex code into its hue, chroma and luminance components, and make them available for future use, which can be done as follows:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pink <span class="ot">&lt;-</span> <span class="fu">hex2RGB</span>(<span class="st">"#D4006A"</span>, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pink_hcl <span class="ot">&lt;-</span> <span class="fu">as</span>(pink, <span class="st">"polarLUV"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>pink_h <span class="ot">&lt;-</span> pink_hcl<span class="sc">@</span>coords[<span class="dv">1</span>, <span class="st">"H"</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>pink_c <span class="ot">&lt;-</span> pink_hcl<span class="sc">@</span>coords[<span class="dv">1</span>, <span class="st">"C"</span>]</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>pink_l <span class="ot">&lt;-</span> pink_hcl<span class="sc">@</span>coords[<span class="dv">1</span>, <span class="st">"L"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The function from {colorspace} that is going to do the hard work of building a palette with differing hues but constant chroma and luminance (or as close as it can in HCL space) is <a href="https://colorspace.r-forge.r-project.org/reference/hcl_palettes.html"><code>qualitative_hcl()</code></a>. By default, you give it the number of colours you want, and it works out equally spaced hues, starting at 0°. To override this default, you can give the <code>h</code> argument a start and end value, <code>c(start, end)</code>. Again, I’m going to choose six colours, 60° apart, and discard one of them.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> The <code>start</code> value should be in [0, 60) and the end value should be in [300, 360). Let the hue of our starting pink be <code>pink_h</code>. Then all the colours in the palette are going to have a hue <code>pink_h + 60 * k</code> for some integer k. The following code picks the start and end values we need to pass to <code>h</code>:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>seq_60 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">300</span>, <span class="at">to =</span> <span class="dv">300</span>, <span class="at">by =</span> <span class="dv">60</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>pink_60 <span class="ot">&lt;-</span> seq_60 <span class="sc">+</span> pink_h</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pink_h_lower <span class="ot">&lt;-</span> pink_60[<span class="fu">which</span>((pink_60 <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> pink_60 <span class="sc">&lt;</span> <span class="dv">60</span>))]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>pink_h_upper <span class="ot">&lt;-</span> pink_60[<span class="fu">which</span>((pink_60 <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">&amp;</span> pink_60 <span class="sc">&lt;</span> <span class="dv">360</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>That’s most of the hard work. Now we build the palette:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hcl_six <span class="ot">&lt;-</span> <span class="fu">qualitative_hcl</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">c</span>(pink_h_lower, pink_h_upper), </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> pink_c, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> pink_l</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hcl-six" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="hcl-six.png" class="img-fluid figure-img" alt="A swatch of six colours in the HCL space, a brown, two greens, a blue, magenta, and my pink" width="663"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;11: Six colours, with hues approximately 60° apart and roughly equal luminance, based around my pink.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The only personal decision I make in this section is which of these six colours to discard. Removing the first of the greens gives me the palette in <a href="#fig-hcl-five">Figure&nbsp;12</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hcl-five" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="hcl-five.png" class="img-fluid figure-img" alt="A swatch of five colours in the HCL space, my pink, a brown, green, blue and magenta." width="662"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;12: As in the previous figure but minus a green and rearranged</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">

</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Update: May 27th 2021
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Since publishing this post, Achim Zeileis, the author of the {colorspace} package, got in touch with me on <a href="https://twitter.com/AchimZeileis/status/1397580619857682437">twitter</a> to offer a bit more insight into what’s going on with this palette. The <code>hcl_six</code> palette does not, as I originally stated, have constant chroma. I have corrected the text above. Not all combinations of Hue/Chroma/Luminance exist in HCL space. At the luminance of my pink (~46) not many other hues can have such high chroma (~118), as demonstrated in <a href="#fig-hclplot">Figure&nbsp;13</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hclplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-hclplot-1.png" class="img-fluid figure-img" alt="A partially filled colour wheel for a luminance of 47 in HCL space, showing hues of orange, red and purple with high chroma, but with no greens or yellows of high chroma." width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;13: Hues and Chromas in HCL space at the Luminance of my pink</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><code>qualitative_hcl()</code> struggles in such circumstances, though does try to keep the luminance of the palette constant.</p>
</div>
</div>
</div>
</section>
<section id="adapting-for-web-accessibility-1" class="level3">
<h3 class="anchored" data-anchor-id="adapting-for-web-accessibility-1">Adapting for web accessibility</h3>
<p>When I was developing my scheme, I used my trusted ColorSlurp app to adjust colours to ensure they met WCAG standards of web accessibility. In writing up this post, I since learnt about web resources to do the same (e.g.&nbsp;<a href="https://webaim.org/resources/contrastchecker/">WebAIM contrast checker</a>) and now, for this section, I’ve discovered the <a href="https://github.com/matt-dray/coloratio">{coloratio}</a> by <a href="https://www.matt-dray.com">Matt Dray</a> and <a href="https://github.com/feddelegrand7/savonliquide">{savonliquide}</a> by <a href="https://ihaddadenfodil.com">Mohamed El Fodil Ihaddaden</a> packages that can do this in R.</p>
<p>Both packages have much to recommend them. {savonliquide} has the advantage of being on CRAN, and provides a toolbox that allows the user to implement accessibility-related concepts, including, but not limited to, contrast checking. {coloratio} is GitHub only, and only for contrast checking, but it has some additional functionality in that area above {savonliquide}, such as quick plotting of the colours in contrast, and a function, <code>cr_choose_bw()</code> that chooses which of black or white has the better contrast ratio with a user supplied colour (which, incidentally, I use to automatically choose the text colour when highlighting words with different background colours, e.g.&nbsp;<span style="background-color: #D4006A; color: white; padding:3px">#D4006A</span> vs <span style="background-color: #00D46A; color: black; padding:3px">#00D46A</span>).<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>Below, I use the <code>cr_get_ratio</code> function from <code>coloratio</code> to check the colour contrasts of each colour in the palette. Because it’s not vectorised, I use this in conjunction with <code>map2_dbl</code> from <a href="https://purrr.tidyverse.org">{purrr}</a> to get all the contrasts at once.</p>
<p>If any of the contrasts are less than 4.5, I then call on the <code>darken()</code> function from {colorspace}, which adjusts each colour in the palette to make it, you guessed it, a bit darker, therefore improving the contrast ratio. I loop over these checking and darkening iterations until all colours in the palette have a contrast ratio of at least 4.5:1 compared to white. Here is the code that achieves this:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coloratio)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">&lt;-</span> hcl_six[<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>contrasts <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    palette, </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"white"</span>, </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">cr_get_ratio</span>(.x, .y, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>min_contrast <span class="ot">&lt;-</span> <span class="fl">4.5</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>any_too_light <span class="ot">&lt;-</span> <span class="fu">any</span>(contrasts <span class="sc">&lt;</span> min_contrast)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (any_too_light) {</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  palette <span class="ot">&lt;-</span> <span class="fu">darken</span>(palette, <span class="at">amount =</span> <span class="fl">0.05</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  contrasts <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      palette, </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"white"</span>, </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">cr_get_ratio</span>(.x, .y, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  any_too_light <span class="ot">&lt;-</span> <span class="fu">any</span>(contrasts <span class="sc">&lt;</span> min_contrast)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>At the end of the process, the palette looks like this:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hcl-darkened" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="hcl-darkened.png" class="img-fluid figure-img" alt="A swatch of five colours, pink, brown, green, blue, magenta, all slightly darker than in the previous figure." width="662"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;14: An HCL palette where all colours have a contrast ratio of 4.5:1 or better against white</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="checking-for-colourblindness-1" class="level3">
<h3 class="anchored" data-anchor-id="checking-for-colourblindness-1">Checking for colourblindness</h3>
<p>As before, we use {prismatic} to check how the palette appears to those with various types of colourblindess. Whilst R can help us visualise this, we still need to use our judgement as to whether the output is acceptable. I believe, in <a href="#fig-hcl-darkened-colourblind">Figure&nbsp;15</a>, it is.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-hcl-darkened-colourblind" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="hcl-darkened-colourblind.png" class="img-fluid figure-img" alt="Four colour palettes. One shows the darkened HCL palette from the previous post as is, the other three show how that palette appears to those with deuteranopia, protanopia and tritanopia. Under all those conditions, the five colours are distinguishable." width="647"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;15: Checking how the darkened HCL palette appears to those with various types of colourblindness.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="but-do-i-like-it" class="level3">
<h3 class="anchored" data-anchor-id="but-do-i-like-it">But, do I like it?</h3>
<p>Going through the process of building a colour palette that meets my criteria purely in R, in as automated, reproducible and adaptable way as possible has been a great learning experience for me, and hopefully something that will be useful to others. I don’t much like the palette it produced, though, especially in comparison to the one I came up with previously. Although the HCL-based palette probably has slightly better theoretical perceptual qualities, I prefer the vibrancy of the colours in the palette I came up with using my first approach, and that’s the one I’ve adopted on this site.</p>
</section>
</section>
<section id="back-to-part-1" class="level2">
<h2 class="anchored" data-anchor-id="back-to-part-1">Back to Part 1</h2>
<p>Now that I have chosen my colour palette, head back to <a href="https://ellakaye.rbind.io/posts/2021-05-25-custom-syntax-highlighting-for-distill-part-1-modifying-the-default-theme/">Part 1</a> for details of how to modify the default {distill} syntax highlighting theme to incorporate them, and how to apply the custom theme to a {distill} site.</p>


<!-- -->


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-Zeileis:2020" class="csl-entry" role="doc-biblioentry">
Zeileis, Achim, Jason C. Fisher, Kurt Hornik, Ross Ihaka, Claire D. McWhite, Paul Murrell, Reto Stauffer, and Claus O. Wilke. 2020. <span>“<span class="nocase">colorspace</span>: A Toolbox for Manipulating and Assessing Colors and Palettes.”</span> <em>Journal of Statistical Software</em> 96 (1): 1–49. <a href="https://doi.org/10.18637/jss.v096.i01">https://doi.org/10.18637/jss.v096.i01</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>If you’d like to see the original theme in action, you can see it over at the <a href="https://distillery.rbind.io/posts/2021-05-26-custom-syntax-highlighting-for-distill-part-2-creating-the-palette/">distillery</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Again, I want to stress that this 60° apart approach and discard one is NOT something you should do when building a five-colour palette for a data visualisation. There, where the colours mean something in relation to the data, it’s important that the hues are evenly spaced. Even for qualitative data, the perceptual uniformity of five evenly-spaced colours is preferable. However, for a syntax highlighting scheme, where any of the colours can appear next to any of the others, and we want all pairs to look good together, and the colours convey no meaning, based on my current and still somewhat limited knowledge of colour theory, I think the six-at-sixty-degrees-discard-one approach is preferable (though I could probably be persuaded otherwise if anyone has a compelling case for an evenly-spaced 5 colours in this context too).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Since switching my website to Quarto, I have found out about the <a href="https://emilhvitfeldt.github.io/prismatic/reference/best_contrast.html"><code>best_contrast</code></a> function from {prismatic} that I will use instead of <code>cr_choose_bw</code> in future, since it allows us to specify the colours to contrast against, useful for me now that I am using very dark gray and very pale gray instead of black and white.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">https://creativecommons.org/licenses/by-sa/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kaye2021,
  author = {Ella Kaye},
  editor = {},
  title = {Custom {Syntax} {Highlighting} for \{Distill\} {Part} 2},
  date = {2021-05-26},
  url = {https://ellakaye.co.uk/posts/2021-05-26_custom-highlighting-distill-2},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kaye2021" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Ella Kaye. 2021. <span>“Custom Syntax Highlighting for {Distill} Part
2.”</span> May 26, 2021. <a href="https://ellakaye.co.uk/posts/2021-05-26_custom-highlighting-distill-2">https://ellakaye.co.uk/posts/2021-05-26_custom-highlighting-distill-2</a>.
</div></div></section></div></main> <!-- /main -->
<div class="giscus">
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content --><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Custom Syntax Highlighting for {distill} Part 2"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Creating the Palette"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">  How to create an appealing and accessible colour palette for a syntax highlighting scheme</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2021-05-26</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ella Kaye</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://twitter.com/ellamkaye</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="an">site-url:</span><span class="co"> https://ellakaye.rbind.io/</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> ek-syntax-highlighting-palette.png</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="an">image-alt:</span><span class="co"> |</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">  A swatch of five colours, a pink, orange, green, blue and purple, all quite bright, but still all with a contrast ratio of 4.5:1 or better against white.</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - distill</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - colour</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">  - accessibility</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span><span class="co"> </span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment lines below for different title and description to post</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  title: |</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  description: |</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment for different image to post</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co">  image: ek-syntax-highlighting-palette.png</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">  image-alt: |</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">    A swatch of five colours, a pink, orange, green, blue and purple, all quite bright, but still all with a contrast ratio of 4.5:1 or better against white.</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  defaults to 500 x 500 summary: uncomment lines below for large card</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">  image-width: 600 </span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co">  image-height: 314</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co">  card-style: "summary_large_image" </span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> bibliography.bib</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>:::{.callout-note collapse="false" .top-callout}</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="fu">## Update: August 2022</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>Since this post was originally written, I have replaced my {disill} website with this one built with <span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org)</span>. </span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>The highlighting you'll see below is not quite the same as it appeared on my previous site, because the default <span class="in">`arrow`</span> theme is implemented differently in {distill} and Quarto.^<span class="co">[</span><span class="ot">If you'd like to see the original theme in action, you can see it over at the [distillery](https://distillery.rbind.io/posts/2021-05-26-custom-syntax-highlighting-for-distill-part-2-creating-the-palette/).</span><span class="co">]</span> Moreover, I'm now using a very pale gray rather than white background, which necessitated a small shift in the green to achieve a sufficient colour contrast. And if you're reading this in dark mode, it's a whole different scheme again, though built on the same principles as described below.  </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>I am keeping this post otherwise as was on the blog for posterity. Most of the content holds, regardless of how the site was built.</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo = FALSE}</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(htmltools)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coloratio)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>bg_col <span class="ot">&lt;-</span> <span class="cf">function</span>(bg_col, <span class="at">text =</span> <span class="cn">NULL</span>, <span class="at">text_col =</span> <span class="cn">NULL</span>) {</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(text)) text <span class="ot">&lt;-</span> bg_col</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(text_col)) text_col <span class="ot">&lt;-</span> coloratio<span class="sc">::</span><span class="fu">cr_choose_bw</span>(bg_col)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  style <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"background-color: "</span>, bg_col, <span class="st">"; color: "</span>, text_col, <span class="st">"; padding:3px"</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">span</span>(<span class="at">style =</span> style, text)</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1 recap and Part 2 overview</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>In Part 1 of this series, <span class="co">[</span><span class="ot">custom syntax highlighting for {distill}: modifying the theme</span><span class="co">](https://ellakaye.rbind.io/posts/2021-05-25-custom-syntax-highlighting-for-distill-part-1-modifying-the-default-theme/)</span>, I describe how and why I went about the process of finding and modifying the default syntax highlighting for <span class="co">[</span><span class="ot">{distill}</span><span class="co">]</span>((https://rstudio.github.io/distill/)) and how I created a function that wrapped that process for <span class="co">[</span><span class="ot">{distilltools}</span><span class="co">](https://ellakaye.github.io/distilltools)</span>. I discuss the default syntax highlighting theme used on {distill} sites, and how we can modify it by replacing the five colours used there with five colours of our choosing.</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>I also outline the four criteria that were important to me as I went about choosing colours for my own syntax highlighting theme:</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It be based on the <span class="kw">&lt;span</span> <span class="er">style</span><span class="ot">=</span><span class="st">"color:#D4006A"</span><span class="kw">&gt;</span>pink<span class="kw">&lt;/span&gt;</span> that I use in my logo and elsewhere throughout this site</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It uses colour theory to pick colours that look appealing together</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It meets <span class="co">[</span><span class="ot">WCAG web accessibility guidelines</span><span class="co">](https://www.w3.org/WAI/standards-guidelines/wcag/)</span>, by ensuring sufficient colour contrast, i.e. a ratio of 4.5:1, between each of the colours in the theme and this site's background colour (white)</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The colours in the palette are colourblind-friendly, i.e. still distinguishable to people with various difference types of colourblindness.</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>This post spins out from Part 1 with a brief primer on colour theory and then a deep-dive into the processes, both thought and practical, of choosing colours for my palette that meet the above criteria. I show how I first went about this to derive the palette that's implemented throughout this site. I also demonstrate a different, entirely R-based, approach to satisfying the criteria, which I decided to try out after learning more about different colour spaces as I was writing up this post. I much preferred the outcome of one approach to the other, but your mileage may vary.</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## A brief primer on colour theory</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Colour harmonies</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-hsl-colour-wheel, fig.cap="An HSL colour wheel. Screen shot from [https://www.canva.com/colors/color-wheel/](https://www.canva.com/colors/color-wheel/), annotations adapted from [https://dev.to/rneha725/hsl-and-hsla-in-css-31j3](https://dev.to/rneha725/hsl-and-hsla-in-css-31j3).", fig.alt="A circle filled with hues of red at the top (0 degrees), moving smoothly through orange, yellow (60 degrees), green (120 degrees), cyan (180 degrees), blue (240 degrees) and magenta(300 degrees) as you rotate clockwise round the circle. The colours are more saturated towards the edge of the circle and greyer towards the centre.", echo = FALSE}</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"hsl-colour-wheel-d4006a-annotated.png"</span>)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>Colour theory determines which colours 'look good' together, based on their relative position on a colour wheel, such as that in @fig-hsl-colour-wheel, somewhat analogously, I think, to how certain musical intervals sound more pleasing/harmonious than others, depending on the ratio of their frequencies. As shown in @fig-colour-harmonies, there are various different types of colour palettes that are in colour harmony, such as complementary (comprised of colours opposite each other on the wheel), analogous (three colours side by side) and triadic (three colours evenly spaced around the wheel). Note that all the colour schemes are derived from the same twelve colours, spaced evenly around a circle. </span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-colour-harmonies, echo = FALSE, fig.cap = "Harmonious colour combinations. Figure from [https://www.widewalls.ch/magazine/color-theory-basics-elements-color-wheel](https://www.widewalls.ch/magazine/color-theory-basics-elements-color-wheel).", fig.alt="Six wheels each split into 12 equal segments of different colours, equally spaced round the colour wheel. Each wheel highlights two, three or four of these colours that look harmonious together."}</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"colour-harmonies.jpg"</span>)</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="fu">### Colour spaces</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="fu">#### RGB, HSB and HSL</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>Another aspect of colour theory relates to colour spaces, and different ways that colours can be defined. The best known, at least in the context of designing for the web, is RGB (**R**ed **G**reen **B**lue), which defines a colour by how much of each of those three primary colours it contains, in a range of 0-255. It is the hexidecimal representations of these three numbers that combine to make up the hex code for a colour.</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>More intuitive, however, for adjusting colours, is defining them by HSB (**H**ue, **S**aturation, **B**rightness), also known as HSV (**H**ue, **S**aturation, **V**alue). HSB is a simple transformation of the RGB space. Similar to HSB is HSL (**H**ue, **S**aturation, **L**ightness), though HSL is considered an improved over HSB in terms of its perceptual qualities.</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>In HSB, the hue represents the colour type and is a number measured between 0 and 360°; it's where you are on the colour wheel, ignoring how bright or intense the colour is. Saturation describes the intensity or richness of the hue, measured between 0 and 100%. 100% is the richest version of the colour and 0% is a shade of grey. Brightness measures, you guessed it, the brightness of the colour. Again, it ranges from 0 to 100%, with 0% being black and 100% being a very bright colour (here, black is not the opposite of white). Here's an <span class="co">[</span><span class="ot">excellent article on the HSB system</span><span class="co">](https://learnui.design/blog/the-hsb-color-system-practicioners-primer.html)</span>, which also explains how it differs from HSL. The differences between HSB and HSL are also illustrated in @fig-hsl-hsb-sliders.</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-hsl-hsb-sliders, echo = FALSE, fig.cap="HSL and HSB sliders for the pink used throughout this site. Image is a screenshot from [http://colorizer.org](http://colorizer.org).", fig.alt="Two sets of three colour sliders, one for HSL the other for HSB. Both have the same scale for hue. In HSL, the saturation runs from grey to bright pink. In HSB with saturation runs from white to bright pink. In HSL, the lightness runs from black to white, via the bright pink. In HSB, the Brightness runs from black to bright pink."}</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"hsl-hsb-sliders.png"</span>)</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>It's great to play around with an HSL or HSB colour wheel to get a sense of how harmonious colour schemes are built, and how the colours in them relate to each other on the wheel. I really like the <span class="co">[</span><span class="ot">canva colour wheel</span><span class="co">](https://www.canva.com/colors/color-wheel/)</span>. It's pretty simple, with only a few schemes, but it's nicely designed and easy to use, and the page explains the basics of colour theory too. It's a fun way to start building a palette. I like how you can pull the dots around the wheel and see how the colours relate, and if you click on a colour in the palette, there are HSL sliders too. Plus, as you move colours around, the background of the page changes colour, which is a nice touch! </span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a><span class="fu">#### HCL</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>Whilst websites on colour theory for designers tend to focus on either the HSB or HSL spaces, and it's HSB or HSL wheels/sliders that tend to be built into design and colour software and apps, both spaces suffer from a lack of perceptual uniformity. The RGB rainbow palette is <span class="co">[</span><span class="ot">notorious</span><span class="co">](https://colorspace.r-forge.r-project.org/articles/endrainbow.html)</span> for this. In general, RBG/HSB/HSL palettes are not a good choice for statistical graphics and data visualisation, where colour conveys meaning. For these purposes, the HCL colour space (**H**ue, **C**hroma, **L**uminance) offers a much better alternative. It is much more suitable for capturing human colour perception. </span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>There is an R package for working with the HCL colour space, the intuitively named <span class="co">[</span><span class="ot">{colorspace}</span><span class="co">](https://colorspace.r-forge.r-project.org/articles/colorspace.html)</span> <span class="co">[</span><span class="ot">@Zeileis:2020</span><span class="co">]</span>. It has many excellent vignettes, including one about the <span class="co">[</span><span class="ot">HCL space</span><span class="co">](https://colorspace.r-forge.r-project.org/articles/color_spaces.html)</span> and its perceptual superiority over other colour spaces. The package also provides <span class="co">[</span><span class="ot">colour palettes</span><span class="co">](https://colorspace.r-forge.r-project.org/articles/hcl_palettes.html)</span> and <span class="co">[</span><span class="ot">scales for {ggplot2}</span><span class="co">](https://colorspace.r-forge.r-project.org/articles/ggplot2_color_scales.html)</span>. There is also support for <span class="co">[</span><span class="ot">HCL palettes in base R</span><span class="co">](https://developer.r-project.org/Blog/public/2019/04/01/hcl-based-color-palettes-in-grdevices/)</span>. The HCL space is also used on <span class="co">[</span><span class="ot">I want hue</span><span class="co">](http://medialab.github.io/iwanthue/)</span>, a site about colours aimed at data scientists, which allows you to generate and refine palettes of optimally distinct colours.</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-pink-in-hcl, echo = FALSE, fig.cap="My pink on the Luminance-Chroma plane in the HCL space. Image is a screenshot from [http://hclwizard.org](http://hclwizard.org:3000/hclcolorpicker/).", fig.alt="A triangle of HCL space, with bright pink on the far right, transitioning towards light grey on the top left corner and black on the bottom left corner."}</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"pink-in-HCL.png"</span>)</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>I haven't seen the HCL space used elsewhere, at least not in the myriad of sites on colour theory for designers or colour/design apps than I use or have read when preparing my theme and this post. Perceptual uniformity is arguably more important in choosing colour palettes for data visualisation, where the colour conveys information about the data, than in picking a few colours that look good together for a syntax highlighting scheme. </span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="fu">## Approach 1: ColorSlurp and HSB</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a><span class="fu">### Building a palette based on my &lt;span style="color:#D4006A"&gt;pink&lt;/span&gt;, using colour theory</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>As I discuss in Part 1 of this series, I know that I need a palette of five colours to replace the five colours used in the default syntax highlighting scheme that comes with {distill}. The problem with all the colour schemes defined in @fig-colour-harmonies is that they use a maximum of four colours. But not to worry! We know from colour theory that we can find 12 colours in harmony by taking evenly spaced colours around the HSL or HSB wheel, i.e. colours whose hues are 30° apart, given fixed values for saturation and brightness/lightness. Since we only need five colours, it's sufficient to find the six colours that are 60° apart, and ignore one of them. Note that for five colours to appear harmonious, we have to respect these angles, not choose five colours that are 72° apart.</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>The main pink that I use in this site has hex <span class="in">`r bg_col("#D4006A")`</span>. I use a great little Mac app called <span class="co">[</span><span class="ot">ColorSlurp</span><span class="co">](https://colorslurp.com)</span> for building and assessing colour palettes. The basic version is free, though the pro version has great features for testing accessibility - more on that below. In ColorSlurp, I started a new palette with #D4006A as a starting point, then, making sure I was in HSB mode, found its HSB values are 330°, 100%, 83%. Leaving the S and B sliders where they are, the next colour I needed is 60° around the circle, i.e. at 30°, so I moved the H slider to that value and added the resulting orange to the palette. I then repeated that for 90°, 150°, 210° and 270°, giving me two shades of green, a blue and a purple. With a colour selected in ColorSlurp, you can also pull up the colour harmonies tab, <span class="in">`r fontawesome::fa("palette")`</span>, which gives quick access to some of these colours. As I only need five colours, I discarded one of the greens, keeping the one at 150°, which is complementary to the starting pink. </span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>If you don't use ColorSlurp or a similar app, there are many online options for building a palette in this way, for example <span class="co">[</span><span class="ot">http://colorizer.org</span><span class="co">](http://colorizer.org)</span> (add a new color to the palette by clicking on the next square down to the right of the sliders). In both ColorSlurp and on colorizer.org, once you have defined a colour by its HSB values, you can read off the hex code, for ease of use in R. </span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>At the end of this stage of the process, based purely on my pink and colour theory, my syntax highlighting palette now stood as in @fig-colour-theory-palette. In the HSB space, these colours all have a saturation of 100% and a brightness of 83%.</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-colour-theory-palette, echo = FALSE, fig.cap = "Colours for syntax highlighting, starting from my main pink, based only on colour theory", fig.alt="A swatch of five colours, very bright and vibrant shades of pink, orange, green, blue and purple."}</span></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="co">#ek_pure_highlight_colours &lt;- c("#D4006A", "#D46A00", "#00D46A", "#006AD4", "#6A00D4")</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a><span class="co">#swatchplot(ek_pure_highlight_colours, border = "transparent")</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the above code gives too much white around the swatches, so I ran the code, took a screen shot to crop it, then include that image back in.</span></span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"first-colour-swatch.png"</span>)</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adapting for web accessibility</span></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>As noted in <span class="co">[</span><span class="ot">Part 1</span><span class="co">](https://ellakaye.rbind.io/posts/2021-05-25-custom-syntax-highlighting-for-distill-part-1-modifying-the-default-theme/)</span> of this series, one key feature of the default syntax highlighting scheme for {distill} is that it is optimised for accessibility and colour contrast. According to the <span class="co">[</span><span class="ot">Web Content Accessibility Guidelines</span><span class="co">](https://www.w3.org/WAI/standards-guidelines/wcag/)</span>, at the WCAG AA (minimum contrast) level, this requires that that contrast ratio between text and background colours be at least 4.5:1 for text of 14pt+ (which is the default text size for code in {distill}). The more stringent WCAG AAA (enhanced) level requires a ratio of at least 7:1.</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>The pro version of ColorSlurp includes a contrast checker, as in @fig-colorslurp-contrast, though there are many websites that also offer this. WebAIM (Web with Accessibility in Mind) has a very handy <span class="co">[</span><span class="ot">contrast checker</span><span class="co">](https://webaim.org/resources/contrastchecker/)</span> which, like ColorSlurp, also includes sliders for adjusting the colours until the desired contrast is reached. Darkening a colour to improve contrast keeps the hue and saturation the same but reduces the brightness or lightness component (ColorSlurp uses HSB, WebAIM uses HSL).</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-colorslurp-contrast, echo = FALSE, fig.cap = "Contrast checking in ColorSlurp", fig.alt="Comparing my pink and white in the ColorSlurp app shows a contrast of 5.24 for text 14pt+, passing the WCAG AA standard. Sliders below show that the colour can be adjusted."}</span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"contrast-check.png"</span>)</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r bg_col("#D4006A", "pink")`</span>, <span class="in">`r bg_col("#006AD4", "blue")`</span> and <span class="in">`r bg_col("#6A00D4", "purple")`</span> in the palette created above have a contrast ratio of better than 4.5:1 with the pure white background, but the <span class="in">`r bg_col("#D46A00", "orange")`</span> and <span class="in">`r bg_col("#00D46A", "green")`</span> do not.</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>My first thought was to keep the pink, blue and purple the same, and to just reduce the brightness of the orange and green until the contrast ratio was a bit better than required. In the HSB space, that gives the palette in @fig-orange-green-less-bright. </span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-orange-green-less-bright, echo  = FALSE, fig.cap= "Reducing brightness in just the orange and green to achieve desired contrasts.", fig.alt="A swatch of five colours, very bright and vibrant shades of pink, blue and purple, with less-bright shades of orange and green"}</span></span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a><span class="co">#ek_pure_highlight_colours_og &lt;- c("#D4006A", "#B65B00", "#008643", "#006AD4", "#6A00D4")</span></span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a><span class="co">#swatchplot(ek_pure_highlight_colours_og, border = "transparent")</span></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the above code gives too much white around the swatches, so I ran the code, took a screen shot to crop it, then include that image back in.</span></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"second-colour-swatch.png"</span>)</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>It's not bad, but when I applied that palette as a syntax highlighting scheme, to my eye the pink, blue and purple looked a little too bright relative to the orange.</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>My next thought was to reduce the brightness on all the colours to the level of the least bright colour that passes the accessibility check (the green, at 53%). That gives the palette in @fig-all-less-bright.</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-all-less-bright, echo  = FALSE, fig.cap= "Reducing brightness in all colours to the level of the green.", fig.alt = "A swatch of five colours, less bright versions of all five colours in the original palette."}</span></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a><span class="co">#ek_darker_highlight_colours &lt;- c("#860043", "#884400", "#008643", "#004489", "#440088")</span></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a><span class="co">#swatchplot(ek_darker_highlight_colours, border = "transparent")</span></span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the above code gives too much white around the swatches, so I ran the code, took a screen shot to crop it, then include that image back in.</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"third-colour-swatch.png"</span>)</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>That looks way too dark for my liking. I don't think it's vibrant enough, and, although the colours all have good contrast against the white background, they don't have much contrast with each other.</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>So, I settled on a compromise position. I reduced the brightness of the original pink, blue and purple from 83% to match the brightness of the accessibility-passing orange (71%), leaving only the green at a brightness of 53%, which it needs to pass the contrast check. This gives the palette in @fig-final-palette. To my eye, the green doesn't appear considerably more dark/less bright than the other four colours. If anything, the greens in @fig-colour-theory-palette and @fig-all-less-bright which both have uniform brighness, look a little too bright compared to the other colours. I guess this is a result of the lack of perceptual uniformity of the HSB space. </span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-final-palette, echo = FALSE, fig.cap = "The palette I settled on for my syntax highlighting scheme.", fig.alt="A swatch of five colours, a pink, orange, green, blue and purple, all quite bright, but still all with a contrast ratio of 4.5:1 or better against white."}</span></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>ek_highlight_colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#5B00B6"</span>, <span class="st">"#005BB6"</span>, <span class="st">"#008643"</span>, <span class="st">"#B65B00"</span>, <span class="st">"#B6005B"</span>)</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a><span class="co">#swatchplot(rev(ek_highlight_colours), border = "transparent")</span></span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the above code gives too much white around the swatches, so I ran the code, took a screen shot to crop it, then include that image back in.</span></span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"ek-syntax-highlighting-palette.png"</span>)</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>I'm happy with that, and that's the syntax highlighting scheme I've adopted throughout this site, despite the fact that the palette now doesn't actually include the pink that I set out to build my scheme around! However, because of the process I've followed, the pink that is in the palette does tone well with the brighter pink and I think my site still has a consistent look. In the end, it was more important that all the colours in the palette looked consistent together and met accessibility guidelines. </span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>I am only just beginning to learn about web accessibility, and I know my site does not yet meet all best practices, but I'm committed to improving in this area. I first became aware of the issue of web accessibility because I follow <span class="co">[</span><span class="ot">Silvia Canelón on twitter</span><span class="co">](https://twitter.com/spcanelon)</span> and I highly recommend you do the same! The <span class="co">[</span><span class="ot">a11y project</span><span class="co">](https://www.a11yproject.com)</span> and <span class="co">[</span><span class="ot">WebAIM</span><span class="co">](https://webaim.org)</span> are great places to learn more. </span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking for colourblindness</span></span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>Some visual impairments require a high colour contrast between text and background colour in order to be able to read content on the web. Another class of visual impairment worth paying attention to when designing palettes is that of colour blindness. </span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Nick Tierney</span><span class="co">](https://www.njtierney.com)</span> has some excellent resources about colour and colourblindness and R packages for accessing these. <span class="co">[</span><span class="ot">These comprehensive slides</span><span class="co">](https://njt-monash-colour.netlify.app/#1)</span> cover what colour is and how we perceive it, colourblindness, how to check how palettes/plots appear to those with different types of colourblindness, the HCL space, the {colorspace} package and how to create your own palettes. He also has a <span class="co">[</span><span class="ot">short blog post</span><span class="co">](https://www.njtierney.com/post/2020/10/15/assess-colour/)</span> on quickly assessing colour palettes to ensure they're colourblind-friendly.</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>As recommended in the above posts, I used the <span class="co">[</span><span class="ot">{prismatic}</span><span class="co">](https://emilhvitfeldt.github.io/prismatic/)</span> package by <span class="co">[</span><span class="ot">Emil Hvitfeldt</span><span class="co">](https://www.hvitfeldt.me)</span> to check how my syntax highlighting palette appears to those with different types of colourblindness:</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prismatic)</span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>ek_highlight_colours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#5B00B6"</span>, <span class="st">"#005BB6"</span>, <span class="st">"#008643"</span>, <span class="st">"#B65B00"</span>, <span class="st">"#B6005B"</span>)</span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a><span class="fu">check_color_blindness</span>(ek_highlight_colours)</span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-check-colourblindness, echo = FALSE, fig.cap="Checking my palette for how it appears to those with various types of colourblindness.", fig.alt="Four colour palettes. One shows my pink/orange/green/blue/purple palette as is, the other three show how that palette appears to those with deuteranopia, protanopia and tritanopia. Under all those conditions, the five colours are distinguishable."}</span></span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"check-colourblindness.png"</span>)</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>Thankfully, for all three main types of colourblindess, the five colours in the palette are distinguishable, so no further adjustments are necessary.</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Approach 2: An R-based HCL alternative</span></span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>The above sections describe the processes, both thought and practical, that I went through to derive the colour palette for my syntax highlighting scheme, and I'm happy with what I came up with. As I was deriving my scheme, I was working in ColorSlurp and only had a cursory knowledge of the differences between the HSB, HSL and HCL colour spaces.</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>However, as I was writing up this blog post, I become increasingly curious about alternative approaches I might have taken. In particular, could I have come up with a scheme that met my criteria entirely in R? Given the incredible ecosystem that R is, it should be no surprise that the answer turned out to be yes! So, below is this alternative approach, using the <span class="co">[</span><span class="ot">{colorspace}</span><span class="co">](https://colorspace.r-forge.r-project.org)</span>, <span class="co">[</span><span class="ot">{coloratio}</span><span class="co">](https://matt-dray.github.io/coloratio/)</span> and <span class="co">[</span><span class="ot">{prismatic}</span><span class="co">](https://emilhvitfeldt.github.io/prismatic/)</span> packages. Also, whereas the previous approach is based on the HSB colour space, this one uses HCL.</span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a><span class="fu">### Building a palette based on my &lt;span style="color:#D4006A"&gt;pink&lt;/span&gt;, using colour theory</span></span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>The {colorspace} package uses the HCL color space, so the first task was to convert a hex code into its hue, chroma and luminance components, and make them available for future use, which can be done as follows:</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(colorspace)</span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>pink <span class="ot">&lt;-</span> <span class="fu">hex2RGB</span>(<span class="st">"#D4006A"</span>, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>pink_hcl <span class="ot">&lt;-</span> <span class="fu">as</span>(pink, <span class="st">"polarLUV"</span>)</span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>pink_h <span class="ot">&lt;-</span> pink_hcl<span class="sc">@</span>coords[<span class="dv">1</span>, <span class="st">"H"</span>]</span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>pink_c <span class="ot">&lt;-</span> pink_hcl<span class="sc">@</span>coords[<span class="dv">1</span>, <span class="st">"C"</span>]</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a>pink_l <span class="ot">&lt;-</span> pink_hcl<span class="sc">@</span>coords[<span class="dv">1</span>, <span class="st">"L"</span>]</span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>The function from {colorspace} that is going to do the hard work of building a palette with differing hues but constant chroma and luminance (or as close as it can in HCL space) is <span class="co">[</span><span class="ot">`qualitative_hcl()`</span><span class="co">](https://colorspace.r-forge.r-project.org/reference/hcl_palettes.html)</span>. By default, you give it the number of colours you want, and it works out equally spaced hues, starting at 0°. To override this default, you can give the <span class="in">`h`</span> argument a start and end value, <span class="in">`c(start, end)`</span>. Again, I'm going to choose six colours, 60° apart, and discard one of them.^<span class="co">[</span><span class="ot">Again, I want to stress that this 60° apart approach and discard one is NOT something you should do when building a five-colour palette for a data visualisation. There, where the colours mean something in relation to the data, it's important that the hues are evenly spaced. Even for qualitative data, the perceptual uniformity of five evenly-spaced colours is preferable. However, for a syntax highlighting scheme, where any of the colours can appear next to any of the others, and we want all pairs to look good together, and the colours convey no meaning, based on my current and still somewhat limited knowledge of colour theory, I think the six-at-sixty-degrees-discard-one approach is preferable (though I could probably be persuaded otherwise if anyone has a compelling case for an evenly-spaced 5 colours in this context too).</span><span class="co">]</span> The <span class="in">`start`</span> value should be in [0, 60) and the end value should be in [300, 360). Let the hue of our starting pink be <span class="in">`pink_h`</span>. Then all the colours in the palette are going to have a hue <span class="in">`pink_h + 60 * k`</span>  for some integer k. The following code picks the start and end values we need to pass to <span class="in">`h`</span>:</span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>seq_60 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">300</span>, <span class="at">to =</span> <span class="dv">300</span>, <span class="at">by =</span> <span class="dv">60</span>)</span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a>pink_60 <span class="ot">&lt;-</span> seq_60 <span class="sc">+</span> pink_h</span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a>pink_h_lower <span class="ot">&lt;-</span> pink_60[<span class="fu">which</span>((pink_60 <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> pink_60 <span class="sc">&lt;</span> <span class="dv">60</span>))]</span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>pink_h_upper <span class="ot">&lt;-</span> pink_60[<span class="fu">which</span>((pink_60 <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">&amp;</span> pink_60 <span class="sc">&lt;</span> <span class="dv">360</span>))]</span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>That's most of the hard work. Now we build the palette:</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a>hcl_six <span class="ot">&lt;-</span> <span class="fu">qualitative_hcl</span>(</span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>  <span class="dv">6</span>, </span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">c</span>(pink_h_lower, pink_h_upper), </span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> pink_c, </span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> pink_l</span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE, echo = FALSE}</span></span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>hcl_six</span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>brown <span class="ot">&lt;-</span> <span class="fu">hex2RGB</span>(<span class="st">"#A16000"</span>, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>brown_hcl <span class="ot">&lt;-</span> <span class="fu">as</span>(brown, <span class="st">"polarLUV"</span>)</span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>brown_hcl</span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>green1 <span class="ot">&lt;-</span> <span class="fu">hex2RGB</span>(<span class="st">"#008200"</span>, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a>green1_hcl <span class="ot">&lt;-</span> <span class="fu">as</span>(green1, <span class="st">"polarLUV"</span>)</span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>green1_hcl</span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>green2 <span class="ot">&lt;-</span> <span class="fu">hex2RGB</span>(<span class="st">"#00936E"</span>, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a>green2_hcl <span class="ot">&lt;-</span> <span class="fu">as</span>(green2, <span class="st">"polarLUV"</span>)</span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>green2_hcl</span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>blue <span class="ot">&lt;-</span> <span class="fu">hex2RGB</span>(<span class="st">"#0082DB"</span>, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>blue_hcl <span class="ot">&lt;-</span> <span class="fu">as</span>(blue, <span class="st">"polarLUV"</span>)</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>blue_hcl</span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a>purple <span class="ot">&lt;-</span> <span class="fu">hex2RGB</span>(<span class="st">"#BA00DF"</span>, <span class="at">gamma =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>purple_hcl <span class="ot">&lt;-</span> <span class="fu">as</span>(purple, <span class="st">"polarLUV"</span>)</span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>purple_hcl</span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-hcl-six, echo = FALSE, fig.cap = "Six colours, with hues approximately 60° apart and roughly equal luminance, based around my pink.", fig.alt="A swatch of six colours in the HCL space, a brown, two greens, a blue, magenta, and my pink"}</span></span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a><span class="co">#swatchplot(hcl_six, border = "transparent")</span></span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"hcl-six.png"</span>)</span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>The only personal decision I make in this section is which of these six colours to discard. Removing the first of the greens gives me the palette in @fig-hcl-five.</span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-hcl-five, fig.cap="As in the previous figure but minus a green and rearranged", fig.alt="A swatch of five colours in the HCL space, my pink, a brown, green, blue and magenta.", echo = FALSE}</span></span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>hcl_five <span class="ot">&lt;-</span> hcl_six[<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a><span class="co">#swatchplot(hcl_five, border = "transparent")</span></span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"hcl-five.png"</span>)</span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = FALSE, echo = FALSE}</span></span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>seq_72 <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">288</span>, <span class="at">to =</span> <span class="dv">288</span>, <span class="at">by =</span> <span class="dv">72</span>)</span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a>pink_72 <span class="ot">&lt;-</span> seq_72 <span class="sc">+</span> pink_h</span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a>pink_72_h_lower <span class="ot">&lt;-</span> pink_72[<span class="fu">which</span>((pink_72 <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> pink_72 <span class="sc">&lt;</span> <span class="dv">72</span>))]</span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a>pink_72_h_upper <span class="ot">&lt;-</span> pink_72[<span class="fu">which</span>((pink_72 <span class="sc">&gt;=</span> <span class="dv">288</span> <span class="sc">&amp;</span> pink_72 <span class="sc">&lt;</span> <span class="dv">360</span>))]</span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>hcl_even_five <span class="ot">&lt;-</span> <span class="fu">qualitative_hcl</span>(</span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>  <span class="dv">5</span>, </span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fu">c</span>(pink_72_h_lower, pink_72_h_upper), </span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> pink_c, </span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>  <span class="at">l =</span> pink_l</span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a><span class="fu">swatchplot</span>(hcl_even_five, <span class="at">border =</span> <span class="st">"transparent"</span>)</span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>:::{.callout-note collapse="false"}</span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a><span class="fu">## Update: May 27th 2021</span></span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>Since publishing this post, Achim Zeileis, the author of the {colorspace} package, got in touch with me on <span class="co">[</span><span class="ot">twitter</span><span class="co">](https://twitter.com/AchimZeileis/status/1397580619857682437)</span> to offer a bit more insight into what's going on with this palette. The <span class="in">`hcl_six`</span> palette does not, as I originally stated, have constant chroma. I have corrected the text above. Not all combinations of Hue/Chroma/Luminance exist in HCL space. At the luminance of my pink (~46) not many other hues can have such high chroma (~118), as demonstrated in @fig-hclplot. </span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r label=fig-hclplot, fig.cap="Hues and Chromas in HCL space at the Luminance of my pink", fig.alt="A partially filled colour wheel for a luminance of 47 in HCL space, showing hues of orange, red and purple with high chroma, but with no greens or yellows of high chroma.", eval=TRUE, echo=FALSE}</span></span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a><span class="fu">hclplot</span>(hcl_six)</span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a><span class="in">`qualitative_hcl()`</span> struggles in such circumstances, though does try to keep the luminance of the palette constant.</span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Adapting for web accessibility</span></span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a>When I was developing my scheme, I used my trusted ColorSlurp app to adjust colours to ensure they met WCAG standards of web accessibility. In writing up this post, I since learnt about web resources to do the same (e.g. <span class="co">[</span><span class="ot">WebAIM contrast checker</span><span class="co">](https://webaim.org/resources/contrastchecker/)</span>) and now, for this section, I've discovered the <span class="co">[</span><span class="ot">{coloratio}</span><span class="co">](https://github.com/matt-dray/coloratio)</span> by <span class="co">[</span><span class="ot">Matt Dray</span><span class="co">](https://www.matt-dray.com)</span> and <span class="co">[</span><span class="ot">{savonliquide}</span><span class="co">](https://github.com/feddelegrand7/savonliquide)</span> by <span class="co">[</span><span class="ot">Mohamed El Fodil Ihaddaden</span><span class="co">](https://ihaddadenfodil.com)</span> packages that can do this in R.</span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a>Both packages have much to recommend them. {savonliquide} has the advantage of being on CRAN, and provides a toolbox that allows the user to implement accessibility-related concepts, including, but not limited to, contrast checking. {coloratio} is GitHub only, and only for contrast checking, but it has some additional functionality in that area above {savonliquide}, such as quick plotting of the colours in contrast, and a function, <span class="in">`cr_choose_bw()`</span> that chooses which of black or white has the better contrast ratio with a user supplied colour (which, incidentally, I use to automatically choose the text colour when highlighting words with different background colours, e.g. <span class="in">`r bg_col("#D4006A")`</span> vs <span class="in">`r bg_col("#00D46A")`</span>).^<span class="co">[</span><span class="ot">Since switching my website to Quarto, I have found out about the [`best_contrast`](https://emilhvitfeldt.github.io/prismatic/reference/best_contrast.html) function from {prismatic} that I will use instead of `cr_choose_bw` in future, since it allows us to specify the colours to contrast against, useful for me now that I am using very dark gray and very pale gray instead of black and white.</span><span class="co">]</span></span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a>Below, I use the <span class="in">`cr_get_ratio`</span> function from <span class="in">`coloratio`</span> to check the colour contrasts of each colour in the palette. Because it's not vectorised, I use this in conjunction with <span class="in">`map2_dbl`</span> from <span class="co">[</span><span class="ot">{purrr}</span><span class="co">](https://purrr.tidyverse.org)</span> to get all the contrasts at once.</span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>If any of the contrasts are less than 4.5, I then call on the <span class="in">`darken()`</span> function from {colorspace}, which adjusts each colour in the palette to make it, you guessed it, a bit darker, therefore improving the contrast ratio. I loop over these checking and darkening iterations until all colours in the palette have a contrast ratio of at least 4.5:1 compared to white. Here is the code that achieves this:</span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning = FALSE}</span></span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coloratio)</span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">&lt;-</span> hcl_six[<span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a>contrasts <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(</span>
<span id="cb6-331"><a href="#cb6-331" aria-hidden="true" tabindex="-1"></a>    palette, </span>
<span id="cb6-332"><a href="#cb6-332" aria-hidden="true" tabindex="-1"></a>    <span class="st">"white"</span>, </span>
<span id="cb6-333"><a href="#cb6-333" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span><span class="fu">cr_get_ratio</span>(.x, .y, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-334"><a href="#cb6-334" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-335"><a href="#cb6-335" aria-hidden="true" tabindex="-1"></a>min_contrast <span class="ot">&lt;-</span> <span class="fl">4.5</span></span>
<span id="cb6-336"><a href="#cb6-336" aria-hidden="true" tabindex="-1"></a>any_too_light <span class="ot">&lt;-</span> <span class="fu">any</span>(contrasts <span class="sc">&lt;</span> min_contrast)</span>
<span id="cb6-337"><a href="#cb6-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-338"><a href="#cb6-338" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (any_too_light) {</span>
<span id="cb6-339"><a href="#cb6-339" aria-hidden="true" tabindex="-1"></a>  palette <span class="ot">&lt;-</span> <span class="fu">darken</span>(palette, <span class="at">amount =</span> <span class="fl">0.05</span>)</span>
<span id="cb6-340"><a href="#cb6-340" aria-hidden="true" tabindex="-1"></a>  contrasts <span class="ot">&lt;-</span> <span class="fu">map2_dbl</span>(</span>
<span id="cb6-341"><a href="#cb6-341" aria-hidden="true" tabindex="-1"></a>      palette, </span>
<span id="cb6-342"><a href="#cb6-342" aria-hidden="true" tabindex="-1"></a>      <span class="st">"white"</span>, </span>
<span id="cb6-343"><a href="#cb6-343" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">cr_get_ratio</span>(.x, .y, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-344"><a href="#cb6-344" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-345"><a href="#cb6-345" aria-hidden="true" tabindex="-1"></a>  any_too_light <span class="ot">&lt;-</span> <span class="fu">any</span>(contrasts <span class="sc">&lt;</span> min_contrast)</span>
<span id="cb6-346"><a href="#cb6-346" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-347"><a href="#cb6-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-348"><a href="#cb6-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-349"><a href="#cb6-349" aria-hidden="true" tabindex="-1"></a>At the end of the process, the palette looks like this:</span>
<span id="cb6-350"><a href="#cb6-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-351"><a href="#cb6-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-hcl-darkened, fig.cap="An HCL palette where all colours have a contrast ratio of 4.5:1 or better against white", fig.alt = "A swatch of five colours, pink, brown, green, blue, magenta, all slightly darker than in the previous figure.", echo = FALSE}</span></span>
<span id="cb6-352"><a href="#cb6-352" aria-hidden="true" tabindex="-1"></a><span class="co">#swatchplot(palette, border = "transparent")</span></span>
<span id="cb6-353"><a href="#cb6-353" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"hcl-darkened.png"</span>)</span>
<span id="cb6-354"><a href="#cb6-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-355"><a href="#cb6-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-356"><a href="#cb6-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking for colourblindness</span></span>
<span id="cb6-357"><a href="#cb6-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-358"><a href="#cb6-358" aria-hidden="true" tabindex="-1"></a>As before, we use {prismatic} to check how the palette appears to those with various types of colourblindess. Whilst R can help us visualise this, we still need to use our judgement as to whether the output is acceptable. I believe, in @fig-hcl-darkened-colourblind, it is.</span>
<span id="cb6-359"><a href="#cb6-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-360"><a href="#cb6-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-hcl-darkened-colourblind, echo = FALSE, fig.cap="Checking how the darkened HCL palette appears to those with various types of colourblindness.", fig.alt="Four colour palettes. One shows the darkened HCL palette from the previous post as is, the other three show how that palette appears to those with deuteranopia, protanopia and tritanopia. Under all those conditions, the five colours are distinguishable."}</span></span>
<span id="cb6-361"><a href="#cb6-361" aria-hidden="true" tabindex="-1"></a><span class="co">#library(prismatic)</span></span>
<span id="cb6-362"><a href="#cb6-362" aria-hidden="true" tabindex="-1"></a><span class="co">#check_color_blindness(palette)</span></span>
<span id="cb6-363"><a href="#cb6-363" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"hcl-darkened-colourblind.png"</span>)</span>
<span id="cb6-364"><a href="#cb6-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-365"><a href="#cb6-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-366"><a href="#cb6-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### But, do I like it?</span></span>
<span id="cb6-367"><a href="#cb6-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a>Going through the process of building a colour palette that meets my criteria purely in R, in as automated, reproducible and adaptable way as possible has been a great learning experience for me, and hopefully something that will be useful to others. I don't much like the palette it produced, though, especially in comparison to the one I came up with previously. Although the HCL-based palette probably has slightly better theoretical perceptual qualities, I prefer the vibrancy of the colours in the palette I came up with using my first approach, and that's the one I've adopted on this site. </span>
<span id="cb6-369"><a href="#cb6-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-370"><a href="#cb6-370" aria-hidden="true" tabindex="-1"></a><span class="fu">## Back to Part 1</span></span>
<span id="cb6-371"><a href="#cb6-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-372"><a href="#cb6-372" aria-hidden="true" tabindex="-1"></a>Now that I have chosen my colour palette, head back to <span class="co">[</span><span class="ot">Part 1</span><span class="co">](https://ellakaye.rbind.io/posts/2021-05-25-custom-syntax-highlighting-for-distill-part-1-modifying-the-default-theme/)</span> for details of how to modify the default {distill} syntax highlighting theme to incorporate them, and how to apply the custom theme to a {distill} site.</span>
<span id="cb6-373"><a href="#cb6-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-374"><a href="#cb6-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>



</div><script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>