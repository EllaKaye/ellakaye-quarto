<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ella Kaye">
<meta name="dcterms.date" content="2020-12-09">
<meta name="description" content="My attempts at Advent of Code, 2020">

<title>ELLA KAYE - Advent of Code 2020</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-101621242-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<script>
  
  function getGiscusTheme() {
  const quartoTheme = localStorage.getItem("quarto-color-scheme");
  const giscusTheme = quartoTheme === "alternate" ? "dark" : "light";
  return giscusTheme;
}

function setGiscusTheme() {
  function sendMessage(message) {
    const iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }
  sendMessage({
    setConfig: {
      theme: getGiscusTheme(),
    },
  });
}

document.addEventListener('DOMContentLoaded', function () {
  const giscusAttributes = {
    "src": "https://giscus.app/client.js",
    "data-repo": "EllaKaye/ellakaye-quarto",
    "data-repo-id": "R_kgDOHwJk_g",
    "data-category": "General",
    "data-category-id": "DIC_kwDOHwJk_s4CQr7D",
    "data-mapping": "title",
    "data-strict": "0",
    "data-reactions-enabled": "1",
    "data-emit-metadata": "0",
    "data-input-position": "top",
    "data-theme": getGiscusTheme(),
    "data-lang": "en",
    "crossorigin": "anonymous",
    "async": "",
  };

  // Dynamically create script tag
  const giscusScript = document.createElement("script");
  Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
  document.body.appendChild(giscusScript);

  // Update giscus theme when theme switcher is clicked
  const toggle = document.querySelector('.quarto-color-scheme-toggle');
  if (toggle) {
    toggle.addEventListener('click', setGiscusTheme);
  }
});
  
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../ek-styles.css">
<meta property="og:title" content="ELLA KAYE - Advent of Code 2020">
<meta property="og:description" content="My attempts at Advent of Code, 2020">
<meta property="og:image" content="https://ellakaye.co.uk/images/logo-white-background.png">
<meta property="og:site-name" content="ELLA KAYE">
<meta property="og:locale" content="en-GB">
<meta property="og:image:height" content="500">
<meta property="og:image:width" content="500">
<meta name="twitter:title" content="ELLA KAYE - Advent of Code 2020">
<meta name="twitter:description" content="My attempts at Advent of Code, 2020">
<meta name="twitter:image" content="https://ellakaye.co.uk/images/logo-white-background.png">
<meta name="twitter:creator" content="@ellamkaye">
<meta name="twitter:card" content="summary">
<meta name="twitter:image-height" content="500">
<meta name="twitter:image-width" content="500">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ELLA<span class="icon-line"></span>KAYE</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">about</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">posts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html">talks</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../packages.html">packages</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../community.html">community</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../contact.html">contact</a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Advent of Code 2020</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          <p>My attempts at Advent of Code, 2020</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Advent of Code</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Ella Kaye </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 9, 2020</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#day-1-report-repair" id="toc-day-1-report-repair" class="nav-link active" data-scroll-target="#day-1-report-repair">Day 1: Report Repair</a>
  <ul>
  <li><a href="#part-1-two-numbers" id="toc-part-1-two-numbers" class="nav-link" data-scroll-target="#part-1-two-numbers">Part 1: Two numbers</a></li>
  <li><a href="#part-2-three-numbers" id="toc-part-2-three-numbers" class="nav-link" data-scroll-target="#part-2-three-numbers">Part 2: Three numbers</a></li>
  </ul></li>
  <li><a href="#day-2-password-philosophy" id="toc-day-2-password-philosophy" class="nav-link" data-scroll-target="#day-2-password-philosophy">Day 2: Password Philosophy</a>
  <ul>
  <li><a href="#part-1-number-of-letters" id="toc-part-1-number-of-letters" class="nav-link" data-scroll-target="#part-1-number-of-letters">Part 1: Number of letters</a></li>
  <li><a href="#part-2-position-of-letters" id="toc-part-2-position-of-letters" class="nav-link" data-scroll-target="#part-2-position-of-letters">Part 2: Position of letters</a></li>
  </ul></li>
  <li><a href="#day-3-toboggan-trajectory" id="toc-day-3-toboggan-trajectory" class="nav-link" data-scroll-target="#day-3-toboggan-trajectory">Day 3: Toboggan Trajectory</a>
  <ul>
  <li><a href="#part-1-encountering-trees" id="toc-part-1-encountering-trees" class="nav-link" data-scroll-target="#part-1-encountering-trees">Part 1: Encountering trees</a></li>
  <li><a href="#part-2-checking-further-slopes" id="toc-part-2-checking-further-slopes" class="nav-link" data-scroll-target="#part-2-checking-further-slopes">Part 2: Checking further slopes</a></li>
  </ul></li>
  <li><a href="#day-4-passport-processing" id="toc-day-4-passport-processing" class="nav-link" data-scroll-target="#day-4-passport-processing">Day 4: Passport Processing</a>
  <ul>
  <li><a href="#part-1-complete-passports" id="toc-part-1-complete-passports" class="nav-link" data-scroll-target="#part-1-complete-passports">Part 1: Complete passports</a></li>
  <li><a href="#part-2-valid-passports" id="toc-part-2-valid-passports" class="nav-link" data-scroll-target="#part-2-valid-passports">Part 2: Valid passports</a></li>
  </ul></li>
  <li><a href="#day-5-binary-boarding" id="toc-day-5-binary-boarding" class="nav-link" data-scroll-target="#day-5-binary-boarding">Day 5: Binary Boarding</a>
  <ul>
  <li><a href="#part-1-finding-all-seat-ids" id="toc-part-1-finding-all-seat-ids" class="nav-link" data-scroll-target="#part-1-finding-all-seat-ids">Part 1: Finding all seat IDs</a></li>
  <li><a href="#part-2-finding-my-seat-id" id="toc-part-2-finding-my-seat-id" class="nav-link" data-scroll-target="#part-2-finding-my-seat-id">Part 2: Finding my seat ID</a></li>
  </ul></li>
  <li><a href="#day-6-custom-customs" id="toc-day-6-custom-customs" class="nav-link" data-scroll-target="#day-6-custom-customs">Day 6: Custom Customs</a>
  <ul>
  <li><a href="#part-1-anyone-answers" id="toc-part-1-anyone-answers" class="nav-link" data-scroll-target="#part-1-anyone-answers">Part 1: Anyone answers</a></li>
  <li><a href="#part-2-everyone-answers" id="toc-part-2-everyone-answers" class="nav-link" data-scroll-target="#part-2-everyone-answers">Part 2: Everyone answers</a></li>
  </ul></li>
  <li><a href="#day-7-handy-haverstocks" id="toc-day-7-handy-haverstocks" class="nav-link" data-scroll-target="#day-7-handy-haverstocks">Day 7: Handy Haverstocks</a>
  <ul>
  <li><a href="#part-1-number-of-colour-bags" id="toc-part-1-number-of-colour-bags" class="nav-link" data-scroll-target="#part-1-number-of-colour-bags">Part 1: Number of colour bags</a></li>
  <li><a href="#part-2-number-of-bags" id="toc-part-2-number-of-bags" class="nav-link" data-scroll-target="#part-2-number-of-bags">Part 2: Number of bags</a></li>
  </ul></li>
  <li><a href="#day-8-handheld-halting" id="toc-day-8-handheld-halting" class="nav-link" data-scroll-target="#day-8-handheld-halting">Day 8: Handheld Halting</a>
  <ul>
  <li><a href="#part-1-infinite-loop" id="toc-part-1-infinite-loop" class="nav-link" data-scroll-target="#part-1-infinite-loop">Part 1: Infinite Loop</a></li>
  <li><a href="#part-2-fixing-the-programme" id="toc-part-2-fixing-the-programme" class="nav-link" data-scroll-target="#part-2-fixing-the-programme">Part 2: Fixing the programme</a></li>
  </ul></li>
  <li><a href="#day-9-encoding-error" id="toc-day-9-encoding-error" class="nav-link" data-scroll-target="#day-9-encoding-error">Day 9: Encoding Error</a>
  <ul>
  <li><a href="#part-1-weak-link" id="toc-part-1-weak-link" class="nav-link" data-scroll-target="#part-1-weak-link">Part 1: Weak Link</a></li>
  <li><a href="#part-2-contiguous-set" id="toc-part-2-contiguous-set" class="nav-link" data-scroll-target="#part-2-contiguous-set">Part 2: Contiguous set</a></li>
  </ul></li>
  <li><a href="#day-10-adapter-array" id="toc-day-10-adapter-array" class="nav-link" data-scroll-target="#day-10-adapter-array">Day 10: Adapter Array</a>
  <ul>
  <li><a href="#part-1-adapter-distribution" id="toc-part-1-adapter-distribution" class="nav-link" data-scroll-target="#part-1-adapter-distribution">Part 1: Adapter Distribution</a></li>
  <li><a href="#part-2-adapter-combinations" id="toc-part-2-adapter-combinations" class="nav-link" data-scroll-target="#part-2-adapter-combinations">Part 2: Adapter combinations</a></li>
  </ul></li>
  <li><a href="#day-11-seating-system" id="toc-day-11-seating-system" class="nav-link" data-scroll-target="#day-11-seating-system">Day 11: Seating System</a>
  <ul>
  <li><a href="#part-1-changing-layout" id="toc-part-1-changing-layout" class="nav-link" data-scroll-target="#part-1-changing-layout">Part 1: Changing layout</a></li>
  <li><a href="#part-2-looking-further" id="toc-part-2-looking-further" class="nav-link" data-scroll-target="#part-2-looking-further">Part 2: Looking further</a></li>
  </ul></li>
  <li><a href="#next" id="toc-next" class="nav-link" data-scroll-target="#next">Next</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/EllaKaye/ellakaye-quarto/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><a href="https://adventofcode.com">Advent of Code</a> is a series of small programming challenges, released daily throughout December in the run-up to Christmas. Part 1 of the challenge is given first. On its successful completion, Part 2 is revealed. The challenges are designed to be solved in any programming language. I will be using R.</p>
<p>There will no doubt be a wide variety of ways to solve these problems. I’m going to go with the first thing I think of that gets the right answer. In most cases, I expect that there will be more concise and efficient solutions. Most of the time I’m working in R, it’s within the <a href="https://www.tidyverse.org">tidyverse</a>, so I imagine that framework will feature heavily below.</p>
<p>Each participant gets different input data, so my numerical solutions may be different from others. If you’re not signed up for Advent of Code yourself, but want to follow along with my data, you can download it at from the data links at the beginning of each day’s section. The links in the day section headers take you to challenge on the Advent of Code page.</p>
<section id="day-1-report-repair" class="level2">
<h2 class="anchored" data-anchor-id="day-1-report-repair">Day 1: <a href="https://adventofcode.com/2020/day/1">Report Repair</a></h2>
<p>
<a id="day1"></a>
</p>
<p><a href="data/AoC_day1.txt">My day 1 data</a></p>
<section id="part-1-two-numbers" class="level4">
<h4 class="anchored" data-anchor-id="part-1-two-numbers">Part 1: Two numbers</h4>
<p>The challenge is to find two numbers from a list that sum to 2020, then to report their product.</p>
<p><code>expand.grid()</code> creates a data frame from all combinations of the supplied vectors. Since the vectors are the same, each pair is duplicated. In this case the two numbers in the list that sum to 2020 are 704 and 1316, and we have one row with 704 as Var1 and one with 704 as Var2. <code>slice(1)</code> takes the first occurrence of the pair.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>expenses <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"data/AoC_day1.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">expand.grid</span>(expenses, expenses) <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> Var1 <span class="sc">+</span> Var2) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sum <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prod =</span> Var1 <span class="sc">*</span> Var2) <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 926464</code></pre>
</div>
</div>
</section>
<section id="part-2-three-numbers" class="level4">
<h4 class="anchored" data-anchor-id="part-2-three-numbers">Part 2: Three numbers</h4>
<p>The follow-up challenge is the same but with three numbers. I went with essentially the same code but it’s notably slower. There are a lot of repeated calculations here: each triplet appears six times in the table.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expand.grid</span>(expenses, expenses, expenses) <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> Var1 <span class="sc">+</span> Var2 <span class="sc">+</span> Var3) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sum <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prod =</span> Var1 <span class="sc">*</span> Var2 <span class="sc">*</span> Var3) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 65656536</code></pre>
</div>
</div>
</section>
</section>
<section id="day-2-password-philosophy" class="level2">
<h2 class="anchored" data-anchor-id="day-2-password-philosophy">Day 2: <a href="https://adventofcode.com/2020/day/2">Password Philosophy</a></h2>
<p><a href="data/AoC_day2.txt">My day 2 data</a></p>
<section id="part-1-number-of-letters" class="level4">
<h4 class="anchored" data-anchor-id="part-1-number-of-letters">Part 1: Number of letters</h4>
<p>We need to find how many passwords are valid according to their policy. The policies and passwords are given as follows:</p>
<pre><code>1-3 a: abcde
1-3 b: cdefg
2-9 c: ccccccccc</code></pre>
<p>Each line gives the password policy and then the password. The password policy indicates the lowest and highest number of times a given letter must appear for the password to be valid. For example, <code>1-3 a</code> means that the password must contain <code>a</code> at least 1 time and at most 3 times.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First load the libraries we’ll need. We then read in the data and use <code>tidyr</code> functions to separate out the parts of the policy and the password, making sure to convert the columns to numeric as appropriate:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>passwords <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/AoC_day2.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(X1, <span class="fu">c</span>(<span class="st">"policy"</span>, <span class="st">"password"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(policy, <span class="fu">c</span>(<span class="st">"count"</span>, <span class="st">"letter"</span>), <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(count, <span class="fu">c</span>(<span class="st">"min"</span>, <span class="st">"max"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">as.integer</span>(min),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">max =</span> <span class="fu">as.integer</span>(max))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we use the <code>stringr</code> function <code>str_count()</code> to count how many times the given letter appears in the password, and conditional logic to check whether it is repeated within the specified number of times. Because <code>TRUE</code> has a numeric value of 1 and <code>FALSE</code> has a numeric value of 0, we can sum the resulting column to get a count of how many passwords are valid according to their policies.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>passwords <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">str_count</span>(password, letter)) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">password_in_policy =</span> <span class="fu">if_else</span>(count <span class="sc">&gt;=</span> min <span class="sc">&amp;</span> count <span class="sc">&lt;=</span> max, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">correct =</span> <span class="fu">sum</span>(password_in_policy)) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(correct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 625</code></pre>
</div>
</div>
</section>
<section id="part-2-position-of-letters" class="level4">
<h4 class="anchored" data-anchor-id="part-2-position-of-letters">Part 2: Position of letters</h4>
<p>Now the policy is interpreted differently. Each policy actually describes two positions in the password, where 1 means the first character, 2 means the second character, and so on. Exactly one of these positions must contain the given letter. How many are valid now?</p>
<p>There were a couple of <em>gotchas</em> here. When I used <code>separate()</code> in the previous part, I had inadvertently left a leading whitespace in front of the password, something that was messing up my indexing with <code>str_sub</code>. Using <code>str_trim()</code> first cleared that up. Also, we need <em>exactly one</em> of the positions to match. <code>|</code> is an inclusive or. We need <code>xor()</code> for exclusive or instead.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>passwords <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">password =</span> <span class="fu">str_trim</span>(password)) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pos1_letter =</span> <span class="fu">str_sub</span>(password, min, min),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">pos2_letter =</span> <span class="fu">str_sub</span>(password, max, max)) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">match_one =</span> <span class="fu">xor</span>(pos1_letter <span class="sc">==</span> letter, pos2_letter <span class="sc">==</span> letter)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">correct =</span> <span class="fu">sum</span>(match_one)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(correct) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 391</code></pre>
</div>
</div>
</section>
</section>
<section id="day-3-toboggan-trajectory" class="level2">
<h2 class="anchored" data-anchor-id="day-3-toboggan-trajectory">Day 3: <a href="https://adventofcode.com/2020/day/3">Toboggan Trajectory</a></h2>
<p><a href="data/AoC_day3.txt">My day 3 data</a></p>
<section id="part-1-encountering-trees" class="level4">
<h4 class="anchored" data-anchor-id="part-1-encountering-trees">Part 1: Encountering trees</h4>
<p>Starting at the top left corner of the map, how many trees (“#”) do we encounter, going at a trajectory of 3 right and 1 down?</p>
<p>First, read in the data and save it into a matrix. My method here feels really hack-y. I’m sure there must be a better approach.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>tree_map <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/AoC_day3.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>num_col <span class="ot">&lt;-</span> tree_map <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">str_length</span>(X1)) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(length)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>tree_vec <span class="ot">&lt;-</span> tree_map <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">X1 =</span> <span class="fu">strsplit</span>(X1, <span class="at">split =</span> <span class="fu">character</span>(<span class="dv">0</span>), <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(X1) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>tree_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(tree_vec, <span class="at">ncol =</span> num_col, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now work my way across and down the matrix, using the <code>%%</code> modulo operator to loop round where necessary. The <code>-1</code> and <code>+1</code> in the line <code>((y + right - 1) %% num_col) + 1</code> is a hack to get round the fact that, for <code>num_col</code> columns, the modulo runs from <code>0</code> to <code>num_col - 1</code>, but the column indexes for our matrix run from <code>1</code> to <code>num_col</code>.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>right <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>down <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tree_mat)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>num_col <span class="ot">&lt;-</span> <span class="fu">ncol</span>(tree_mat)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># start counting trees encountered</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># start square</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (x <span class="sc">&lt;=</span> num_rows) {</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("row: ", x, "col: ", y, "\n")</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tree_mat[x,y] <span class="sc">==</span> <span class="st">"#"</span>) trees <span class="ot">&lt;-</span> trees <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> down</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> ((y <span class="sc">+</span> right <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> num_col) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>trees</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 299</code></pre>
</div>
</div>
</section>
<section id="part-2-checking-further-slopes" class="level4">
<h4 class="anchored" data-anchor-id="part-2-checking-further-slopes">Part 2: Checking further slopes</h4>
<p>We now need to check several other trajectories, and multiply together the number of trees we find, so we wrap the Part 1 code into a function.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>slope_check <span class="ot">&lt;-</span> <span class="cf">function</span>(tree_mat, right, down) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tree_mat)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  num_col <span class="ot">&lt;-</span> <span class="fu">ncol</span>(tree_mat)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># start counting trees encountered</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  trees <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># start square</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (x <span class="sc">&lt;=</span> num_rows) {</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tree_mat[x,y] <span class="sc">==</span> <span class="st">"#"</span>) trees <span class="ot">&lt;-</span> trees <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x <span class="sc">+</span> down</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> ((y <span class="sc">+</span> right <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> num_col) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  trees</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="fu">prod</span>(<span class="fu">slope_check</span>(tree_mat, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">7</span>, <span class="dv">1</span>),</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">1</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3621285278</code></pre>
</div>
</div>
</section>
</section>
<section id="day-4-passport-processing" class="level2">
<h2 class="anchored" data-anchor-id="day-4-passport-processing">Day 4: <a href="https://adventofcode.com/2020/day/4">Passport Processing</a></h2>
<p>
<a id="day4"></a>
</p>
<p><a href="data/AoC_day4.txt">My day 4 data</a></p>
<section id="part-1-complete-passports" class="level4">
<h4 class="anchored" data-anchor-id="part-1-complete-passports">Part 1: Complete passports</h4>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using <code>readr::read_tsv()</code> off the bat removes the blank lines, making it impossible to identify the different passports, but reading in the data via <code>readLines()</code> then converting <code>as_tibble()</code> preserves them, and then allows us to use <code>tidyverse</code> functions for the remaining tidying. <code>cumsum()</code> on a logical vectors takes advantage of <code>FALSE</code> having a numeric value of zero and <code>TRUE</code> having a numeric value of one.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>passports <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"data/AoC_day4.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(value, <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_passport =</span> value <span class="sc">==</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">cumsum</span>(new_passport) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>new_passport) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>new_passport) <span class="sc">%&gt;%</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(value, <span class="fu">c</span>(<span class="st">"key"</span>, <span class="st">"value"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our data is now in three columns, with ID, key and value, so now we need to find the number of passports with all seven fields once <code>cid</code> is excluded:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>passports <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(key <span class="sc">!=</span> <span class="st">"cid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 210</code></pre>
</div>
</div>
</section>
<section id="part-2-valid-passports" class="level4">
<h4 class="anchored" data-anchor-id="part-2-valid-passports">Part 2: Valid passports</h4>
<p>Now we need to add data validation checks:</p>
<ul>
<li>byr (Birth Year) - four digits; at least 1920 and at most 2002.</li>
<li>iyr (Issue Year) - four digits; at least 2010 and at most 2020.</li>
<li>eyr (Expiration Year) - four digits; at least 2020 and at most 2030.</li>
<li>hgt (Height) - a number followed by either cm or in:
<ul>
<li>If cm, the number must be at least 150 and at most 193.</li>
<li>If in, the number must be at least 59 and at most 76.</li>
</ul></li>
<li>hcl (Hair Color) - a # followed by exactly six characters 0-9 or a-f.</li>
<li>ecl (Eye Color) - exactly one of: amb blu brn gry grn hzl oth.</li>
<li>pid (Passport ID) - a nine-digit number, including leading zeroes.</li>
<li>cid (Country ID) - ignored, missing or not.</li>
</ul>
<p>Ignoring the <code>cid</code> field, we narrow down on passports that at least have the right number of fields, and extract the number from the <code>hgt</code> column:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>complete_passports <span class="ot">&lt;-</span> passports <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(key <span class="sc">!=</span> <span class="st">"cid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hgt_value =</span> <span class="fu">case_when</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hgt"</span> <span class="sc">~</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(value),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then we create a <code>check</code> column, which is <code>TRUE</code> when the value for each key meets the required conditions. Those with 7 <code>TRUE</code>s are valid. Note that with <code>case_when()</code> we’ve left the check column as <code>NA</code> when the condition is <code>FALSE</code>, requiring <code>na.rm = TRUE</code> in the call to <code>sum()</code>. We can get round that by adding a final line to the <code>case_when()</code> condition stating <code>TRUE ~ FALSE</code>. <code>TRUE</code> here is a catch-all for all remaining rows not covered by the conditions above, and then we set them to <code>FALSE</code>, but I find the line <code>TRUE ~ FALSE</code> unintuitive.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>complete_passports <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">check =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    (key <span class="sc">==</span> <span class="st">"byr"</span> <span class="sc">&amp;</span> value <span class="sc">&gt;=</span> <span class="dv">1920</span>) <span class="sc">&amp;</span> (key <span class="sc">==</span> <span class="st">"byr"</span> <span class="sc">&amp;</span> value <span class="sc">&lt;=</span> <span class="dv">2002</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    (key <span class="sc">==</span> <span class="st">"iyr"</span> <span class="sc">&amp;</span> value <span class="sc">&gt;=</span> <span class="dv">2010</span>) <span class="sc">&amp;</span> (key <span class="sc">==</span> <span class="st">"iyr"</span> <span class="sc">&amp;</span> value <span class="sc">&lt;=</span> <span class="dv">2020</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    (key <span class="sc">==</span> <span class="st">"eyr"</span> <span class="sc">&amp;</span> value <span class="sc">&gt;=</span> <span class="dv">2020</span>) <span class="sc">&amp;</span> (key <span class="sc">==</span> <span class="st">"eyr"</span> <span class="sc">&amp;</span> value <span class="sc">&lt;=</span> <span class="dv">2030</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hgt"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"cm"</span>) <span class="sc">&amp;</span> hgt_value <span class="sc">&gt;=</span> <span class="dv">150</span> <span class="sc">&amp;</span> hgt_value <span class="sc">&lt;=</span> <span class="dv">193</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hgt"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"in"</span>) <span class="sc">&amp;</span> hgt_value <span class="sc">&gt;=</span> <span class="dv">59</span> <span class="sc">&amp;</span> hgt_value <span class="sc">&lt;=</span> <span class="dv">76</span> <span class="sc">~</span> <span class="cn">TRUE</span>,  </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hcl"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"^#[a-f0-9]{6}$"</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"ecl"</span> <span class="sc">&amp;</span> value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"amb"</span>, <span class="st">"blu"</span>, <span class="st">"brn"</span>, <span class="st">"gry"</span>, <span class="st">"grn"</span>, <span class="st">"hzl"</span>, <span class="st">"oth"</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"pid"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"^[0-9]{9}$"</span>) <span class="sc">~</span> <span class="cn">TRUE</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">check_all =</span> <span class="fu">sum</span>(check, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(check_all <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 131</code></pre>
</div>
</div>
</section>
</section>
<section id="day-5-binary-boarding" class="level2">
<h2 class="anchored" data-anchor-id="day-5-binary-boarding">Day 5: <a href="https://adventofcode.com/2020/day/5">Binary Boarding</a></h2>
<p><a href="data/AoC_day5.txt">My day 5 data</a></p>
<section id="part-1-finding-all-seat-ids" class="level4">
<h4 class="anchored" data-anchor-id="part-1-finding-all-seat-ids">Part 1: Finding all seat IDs</h4>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The code below sets starts by setting each row number to 127 and each column number to 7, the maximum they can be, then, working along the string, lowering the maximum (or leaving it as is) one letter at a time:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>boarding <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/AoC_day5.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">binary =</span> X1)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="ot">&lt;-</span> boarding <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">127</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">64</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">32</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">3</span>, <span class="dv">3</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">16</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">4</span>, <span class="dv">4</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">8</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">5</span>, <span class="dv">5</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">4</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">6</span>, <span class="dv">6</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">2</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">7</span>, <span class="dv">7</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">1</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">8</span>, <span class="dv">8</span>) <span class="sc">==</span> <span class="st">"L"</span>, col <span class="sc">-</span> <span class="dv">4</span>, col)) <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">9</span>, <span class="dv">9</span>) <span class="sc">==</span> <span class="st">"L"</span>, col <span class="sc">-</span> <span class="dv">2</span>, col)) <span class="sc">%&gt;%</span>  </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">10</span>, <span class="dv">10</span>) <span class="sc">==</span> <span class="st">"L"</span>, col <span class="sc">-</span> <span class="dv">1</span>, col)) <span class="sc">%&gt;%</span>  </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> row <span class="sc">*</span> <span class="dv">8</span> <span class="sc">+</span> col) </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="sc">%&gt;%</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max =</span> <span class="fu">max</span>(ID)) <span class="sc">%&gt;%</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(max)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 963</code></pre>
</div>
</div>
<p>OK, I know I said in the introduction to this post that I would go with the first solution I think of that gets the right answer, and the above does work, but I’m <em>deeply</em> unhappy with the code. There’s too much repetition, I don’t like the use of subtraction when diving by 2 feels more appropriate in a binary context, and it doesn’t feel like I’ve taken full advantage of the mathematical structure of the problem. So, on further reflection, I realise that the way that ID is defined is essentially turning a binary number into a decimal, where we get the binary number as a string by replacing “B” and “R” by “1” and L” and “F” by “0”. Then, I just found, there is a base R function <code>strtoi()</code> that takes a string of digits in a given base and converts it to a base 10 integer, just what we need:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="ot">&lt;-</span> boarding <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">binary =</span> <span class="fu">str_replace_all</span>(binary, <span class="st">"L|F"</span>, <span class="st">"0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">binary =</span> <span class="fu">str_replace_all</span>(binary, <span class="st">"B|R"</span>, <span class="st">"1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">strtoi</span>(binary, <span class="at">base =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ID))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 963</code></pre>
</div>
</div>
<p>That’s better!</p>
</section>
<section id="part-2-finding-my-seat-id" class="level4">
<h4 class="anchored" data-anchor-id="part-2-finding-my-seat-id">Part 2: Finding my seat ID</h4>
<p>We need to find the missing number, so we arrange the IDs in ascending order and look at the gap between each ID and the preceding one. In most cases, that should be one. Where we have a gap of 2, we must have skipped the integer below:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">lag</span>(ID)) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gap =</span> ID <span class="sc">-</span> diff) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gap <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">my_seat =</span> ID <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(my_seat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 592</code></pre>
</div>
</div>
</section>
</section>
<section id="day-6-custom-customs" class="level2">
<h2 class="anchored" data-anchor-id="day-6-custom-customs">Day 6: <a href="https://adventofcode.com/2020/day/6">Custom Customs</a></h2>
<p><a href="data/AoC_day6.txt">My day 6 data</a></p>
<section id="part-1-anyone-answers" class="level4">
<h4 class="anchored" data-anchor-id="part-1-anyone-answers">Part 1: Anyone answers</h4>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Within each group, we need to find the number of unique letters within each group. We read in and separate the data using the tricks learnt for <a href="#day4">Day 4</a>, and take advantage of the <code>rowwise()</code> feature in <code>dplyr 1.0.0</code>.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>customs_groups <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"data/AoC_day6.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_group =</span> value <span class="sc">==</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_ID =</span> <span class="fu">cumsum</span>(new_group) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>new_group) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>new_group) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_ID) </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>customs_groups <span class="sc">%&gt;%</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">qs =</span> <span class="fu">str_c</span>(value, <span class="at">collapse =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qss =</span> <span class="fu">str_split</span>(qs, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qsu =</span> <span class="fu">list</span>(<span class="fu">unique</span>(qss))) <span class="sc">%&gt;%</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">length</span>(qsu)) <span class="sc">%&gt;%</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6585</code></pre>
</div>
</div>
</section>
<section id="part-2-everyone-answers" class="level4">
<h4 class="anchored" data-anchor-id="part-2-everyone-answers">Part 2: Everyone answers</h4>
<p>Now, instead of unique letters in a group, we need to find the number of letters which appear in all the answers for everyone in the same group. I first note how many people are in each group, then tabulate the number of occurrences of each letter in the group, then count (by summing a logical vector) the number of matches between occurrences of letter and the number in group. Finally, we sum across all groups.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>customs_groups <span class="sc">%&gt;%</span>  </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(group_ID, <span class="at">name =</span> <span class="st">"num_in_group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_ID, num_in_group) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">qs =</span> <span class="fu">str_c</span>(value, <span class="at">collapse =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qss =</span> <span class="fu">str_split</span>(qs, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">letter_table =</span> <span class="fu">list</span>(<span class="fu">table</span>(qss))) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_common =</span> <span class="fu">sum</span>(num_in_group <span class="sc">==</span> letter_table)) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(in_common)) <span class="sc">%&gt;%</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3276</code></pre>
</div>
</div>
</section>
</section>
<section id="day-7-handy-haverstocks" class="level2">
<h2 class="anchored" data-anchor-id="day-7-handy-haverstocks">Day 7: <a href="https://adventofcode.com/2020/day/7">Handy Haverstocks</a></h2>
<p><a href="data/AoC_day7.txt">My day 7 data</a></p>
<section id="part-1-number-of-colour-bags" class="level4">
<h4 class="anchored" data-anchor-id="part-1-number-of-colour-bags">Part 1: Number of colour bags</h4>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We have colour-coded bags that must contain a specific number of other colour-coded bags.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>bags <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"data/AoC_day7.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 1
  X1                                                                            
  &lt;chr&gt;                                                                         
1 wavy bronze bags contain 5 striped gold bags, 5 light tomato bags.            
2 drab indigo bags contain 4 pale bronze bags, 2 mirrored lavender bags.        
3 pale olive bags contain 3 faded bronze bags, 5 wavy orange bags, 3 clear blac…
4 faded white bags contain 5 vibrant violet bags, 4 light teal bags.            
5 mirrored magenta bags contain 2 muted cyan bags, 3 vibrant crimson bags.      
6 dull purple bags contain 1 striped fuchsia bag.                               </code></pre>
</div>
</div>
<p>Our first task is to parse the natural language and split the rules into one container/contains pair per line:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> bags <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rule =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(X1, <span class="fu">c</span>(<span class="st">"container"</span>, <span class="st">"contains"</span>), <span class="at">sep =</span> <span class="st">" bags contain "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(contains, <span class="at">sep =</span> <span class="st">","</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contains =</span> <span class="fu">str_remove</span>(contains, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contains =</span> <span class="fu">str_remove</span>(contains, <span class="st">"bags|bag"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(contains = str_replace(contains, "no other", "0 other")) %&gt;%</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract</span>(contains, <span class="fu">c</span>(<span class="st">'number'</span>, <span class="st">'contains'</span>), <span class="st">"(</span><span class="sc">\\</span><span class="st">d+) (.+)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(number)) <span class="sc">%&gt;%</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contains =</span> <span class="fu">str_trim</span>(contains)) <span class="sc">%&gt;%</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">number =</span> <span class="fu">as.integer</span>(number)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To find all bags that con eventually contain our <code>shiny gold</code> bag, we first find the bags that can contain it directly. We then find the bags that can contain those bags and take the union of the two levels. We repeat, stopping when going up a level adds no further bags to the vector of bag colours already found. We then subtract 1, because we don’t want to count the original shiny gold bag.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to find all colours that contain a vector of other colours:</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>contains_colours <span class="ot">&lt;-</span> <span class="cf">function</span>(colours) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  rules <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(contains <span class="sc">%in%</span> colours) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(container) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(container)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>bags <span class="ot">&lt;-</span> <span class="st">"shiny gold"</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>old_length <span class="ot">&lt;-</span> <span class="fu">length</span>(bags)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>new_length <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># keeping adding to the vector of bags, until no change</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(old_length <span class="sc">!=</span> new_length) {</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  old_length <span class="ot">=</span> <span class="fu">length</span>(bags)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  bags <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(bags, <span class="fu">contains_colours</span>(bags)) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  new_length <span class="ot">&lt;-</span> <span class="fu">length</span>(bags)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat(old_length, ", ", new_length, "\n")</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bags) <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 274</code></pre>
</div>
</div>
</section>
<section id="part-2-number-of-bags" class="level4">
<h4 class="anchored" data-anchor-id="part-2-number-of-bags">Part 2: Number of bags</h4>
<p>Now we need to discover the number of bags that a shiny gold bag must contain. I figured that lends itself to recursion, but struggled on the details. Hat tip to David Robinson for <a href="https://twitter.com/drob/status/1336003816395845632">this solution</a>. I’ve learnt a lot for myself by unpicking how it works.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>count_all_contained <span class="ot">&lt;-</span> <span class="cf">function</span>(colour) {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  relevant_rules <span class="ot">&lt;-</span> rules <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(container <span class="sc">%in%</span> colour)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(relevant_rules<span class="sc">$</span>number <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">map_dbl</span>(relevant_rules<span class="sc">$</span>contains, count_all_contained)))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="fu">count_all_contained</span>(<span class="st">"shiny gold"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 158730</code></pre>
</div>
</div>
</section>
</section>
<section id="day-8-handheld-halting" class="level2">
<h2 class="anchored" data-anchor-id="day-8-handheld-halting">Day 8: <a href="https://adventofcode.com/2020/day/8">Handheld Halting</a></h2>
<p><a href="data/AoC_day8.txt">My day 8 data</a></p>
<section id="part-1-infinite-loop" class="level4">
<h4 class="anchored" data-anchor-id="part-1-infinite-loop">Part 1: Infinite Loop</h4>
<p>Our programme gets stuck in an infinite loop. As well as keeping track of the accumulator, we need to keep track of where we’ve visited, and stop when we visit the same instruction twice. We use a <code>data.frame()</code> rather than a <code>tibble()</code> as the former is easier to index into.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>instructions <span class="ot">&lt;-</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.table</span>(<span class="st">"data/AoC_day8.txt"</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"instruction"</span>, <span class="st">"value"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We start with a pretty straight-forward loop, noting that at most it can run for one more than the number of instructions in the programme until it hits an instruction it’s already visited. We update row number to visit next and the accumulator as appropriate.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>instructions<span class="sc">$</span>visited <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>row <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>accumulator <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(instructions)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(num_rows<span class="sc">+</span><span class="dv">1</span>)) {</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (instructions[row, <span class="st">"visited"</span>] <span class="sc">!=</span> <span class="dv">0</span>) <span class="cf">break</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># +1 on number of times the row is visited</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  instructions[row, <span class="st">"visited"</span>] <span class="ot">&lt;-</span> instructions[row, <span class="st">"visited"</span>] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case when the instruction is "acc"</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"acc"</span>) {</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    accumulator <span class="ot">&lt;-</span> accumulator <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case when the instruction is "jmp"</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"jmp"</span>) {</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> row <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case when the instruction is "nop"</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"nop"</span>) {</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>accumulator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1915</code></pre>
</div>
</div>
</section>
<section id="part-2-fixing-the-programme" class="level4">
<h4 class="anchored" data-anchor-id="part-2-fixing-the-programme">Part 2: Fixing the programme</h4>
<p>To break the loop, one of the <code>nop</code> instructions in the programme should be a <code>jmp</code> or vice versa. The plan is to swap these out one by one and check if the programme completes. It’s not a sophisticated approach, but it works fast enough (about a second).</p>
<p>First we note that the broken instruction must be one that we visited in Part 1. Also, an instruction of <code>jmp</code> with a value of 0 will get us stuck in a one-line infinite loop, so we avoid that.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>rows_to_check <span class="ot">&lt;-</span> instructions <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(visited <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(instruction <span class="sc">!=</span> <span class="st">"acc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(instruction <span class="sc">==</span> <span class="st">"nop"</span> <span class="sc">&amp;</span> value <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(row_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We have 93 instruction to check. We modify our code from Part 1 slightly, converting it into a function and returning a list with values <code>completes</code> and <code>accumulator</code>. <code>completes</code> is <code>FALSE</code> as soon as we visit a row twice and <code>TRUE</code> if the number of our next row to visit is greater than the number of rows in the programme.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>programme_completes <span class="ot">&lt;-</span> <span class="cf">function</span>(instructions) {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  row <span class="ot">&lt;-</span> 1L</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  accumulator <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(instructions)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(num_rows<span class="sc">+</span><span class="dv">1</span>)) {</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (instructions[row, <span class="st">"visited"</span>] <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">completes =</span> <span class="cn">FALSE</span>, <span class="at">accumulator =</span> accumulator)) </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># +1 on number of times the row is visited</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    instructions[row, <span class="st">"visited"</span>] <span class="ot">&lt;-</span> instructions[row, <span class="st">"visited"</span>] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># case when the instruction is "acc"</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"acc"</span>) {</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>      accumulator <span class="ot">&lt;-</span> accumulator <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>      row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"jmp"</span>) {</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>      row <span class="ot">&lt;-</span> row <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"nop"</span>) {</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>      row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (row <span class="sc">&gt;</span> num_rows) {</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">completes =</span> <span class="cn">TRUE</span>, <span class="at">accumulator =</span> accumulator)) </span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>}  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We now loop over the rows we’ve identified to check, breaking the loop as soon as we find a programme that completes. Finally, we extract the accumulator value from the successful programme.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>instructions<span class="sc">$</span>visited <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (row <span class="cf">in</span> rows_to_check) {</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modify one row of the instructions,</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># copying data frame so we don't have to modify it back</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  modified_instructions <span class="ot">&lt;-</span> instructions</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(instructions[row, <span class="dv">1</span>] <span class="sc">==</span> <span class="st">"jmp"</span>, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>         modified_instructions[row, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"nop"</span>, </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>         modified_instructions[row, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"jmp"</span>) </span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if the modified programme completes</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  check_programme <span class="ot">&lt;-</span> <span class="fu">programme_completes</span>(modified_instructions)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (check_programme<span class="sc">$</span>completes) </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>check_programme<span class="sc">$</span>accumulator</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 944</code></pre>
</div>
</div>
</section>
</section>
<section id="day-9-encoding-error" class="level2">
<h2 class="anchored" data-anchor-id="day-9-encoding-error">Day 9: <a href="https://adventofcode.com/2020/day/9">Encoding Error</a></h2>
<p><a href="data/AoC_day9.txt">My day 9 data</a></p>
<section id="part-1-weak-link" class="level4">
<h4 class="anchored" data-anchor-id="part-1-weak-link">Part 1: Weak Link</h4>
<p>We have to find the first number in the list which is <em>not</em> the sum of a pair of different numbers in the preceding 25 numbers.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">as.double</span>(<span class="fu">readLines</span>(<span class="st">"data/AoC_day9.txt"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There’s a nice trick for finding the pair of numbers in a vector that sum to a target that was doing the rounds on twitter in response to the <a href="#day1">Day 1</a> challenge: <code>intersect(input, 2020 - input)</code>. For this challenge, we expand on that idea, writing it as a <code>check_sum</code> function. Where there’s more than one pair, it won’t say which pair together, and if the number that’s half the target appears in the addends, it will only appear once in the output. However, for this challenge, we only need to know when there are <em>no</em> pairs that sum to the target, which will be the case when the length of the output of <code>check_sum</code> is 0.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>check_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(target, addends) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">intersect</span>(addends, target<span class="sc">-</span>addends)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, it’s simply a case of iterating over windows of length 25, checking whether the following number is the sum of a distinct pair in that window, and returning the first one that isn’t.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>find_invalid_num <span class="ot">&lt;-</span> <span class="cf">function</span>(vec, <span class="at">win =</span> <span class="dv">25</span>) {</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> (win<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(vec)) {</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    check <span class="ot">&lt;-</span> <span class="fu">check_sum</span>(vec[i], vec[(i<span class="sc">-</span>win)<span class="sc">:</span>(i<span class="dv">-1</span>)])</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(check) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(vec[i])</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="fu">find_invalid_num</span>(input)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 507622668</code></pre>
</div>
</div>
</section>
<section id="part-2-contiguous-set" class="level4">
<h4 class="anchored" data-anchor-id="part-2-contiguous-set">Part 2: Contiguous set</h4>
<p>Find a contiguous set in the list that sums to the invalid number from Part 1, and add together the largest and smallest number in that range.</p>
<p>First, we note that after a certain point, all numbers in the input are larger than the target, so we don’t need to consider those. We reduce our input vector accordingly.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">find_invalid_num</span>(input)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>input_reduced <span class="ot">&lt;-</span> input[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">max</span>(<span class="fu">which</span>(input <span class="sc">&lt;=</span> target)))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To find the contiguous set in the list that sums to the target, we make use of <code>accumulate()</code> from the <code>purrr</code> package. Let the input list be <span class="math inline">\(x = (x_1, x_2,..., x_n)\)</span>. Then <code>accumulate(x, sum)</code> returns <span class="math inline">\(a = (x_1, x_1 + x_2,..., \sum_{j=1}^n x_j)\)</span>. We check whether any element of this vector is equal to the target. If so we index into the input vector appropriately, sum the min and max in the range and we’re done. If not, we consider the sums of all windows starting with the second element of the input list, and so on.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>contiguous_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(input, target) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  len <span class="ot">&lt;-</span> <span class="fu">length</span>(input)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>len) {</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">accumulate</span>(input[i<span class="sc">:</span>len], sum)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> a <span class="sc">==</span> target</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(b) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>      output_length <span class="ot">&lt;-</span> <span class="fu">which</span>(b)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>      contiguous_set <span class="ot">&lt;-</span> input[i<span class="sc">:</span>(i <span class="sc">+</span> output_length <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">range</span>(contiguous_set)))</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="fu">contiguous_sum</span>(input_reduced, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 76688505</code></pre>
</div>
</div>
<p>I appreciate that there’s some redundant calculation in this method. The vectors of accumulated sums can contain numbers larger than the target (if writing our own loop, we could break as soon as the accumulated sum got too big). Also, in retrospect, we could have only run <code>accumulate</code> once, then in the second iteration of the loop, subtracted <code>input[1]</code> from the result, in the third iteration subtracted <code>input[2]</code> from that result, etc. However, the function as written is concise and easy to understand, and gets our answer in around a second, so that will do!</p>
</section>
</section>
<section id="day-10-adapter-array" class="level2">
<h2 class="anchored" data-anchor-id="day-10-adapter-array">Day 10: <a href="https://adventofcode.com/2020/day/10">Adapter Array</a></h2>
<p><a href="data/AoC_day10.txt">My day 10 data</a></p>
<section id="part-1-adapter-distribution" class="level4">
<h4 class="anchored" data-anchor-id="part-1-adapter-distribution">Part 1: Adapter Distribution</h4>
<p>This is simply a case of ordering the adapters, prepending 0 and appending the the max in the list plus three, then finding the differences.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>adapters <span class="ot">&lt;-</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readLines</span>(<span class="st">"data/AoC_day10.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>adapter_diffs <span class="ot">&lt;-</span> <span class="fu">c</span>(adapters, <span class="dv">0</span>, <span class="fu">max</span>(adapters) <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>() <span class="sc">%&gt;%</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>()</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(adapter_diffs <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(adapter_diffs <span class="sc">==</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3034</code></pre>
</div>
</div>
</section>
<section id="part-2-adapter-combinations" class="level4">
<h4 class="anchored" data-anchor-id="part-2-adapter-combinations">Part 2: Adapter combinations</h4>
<p>Instead of building up sequences of adapters, we see what we can remove from the full list.</p>
<p>First, we check the diffs: are they just 1 and 3 or are there any 2s?</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(adapter_diffs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>adapter_diffs
 1  3 
74 41 </code></pre>
</div>
</div>
<p>We can’t remove an adapter if its difference with the previous adapter is 3, otherwise the difference between the adapters on either side of it will be too big.</p>
<p>What about diffs of 1? It depends how many ones there are around it. We can check this using the <code>rle()</code> (run length encoding) function</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">rle</span>(adapter_diffs)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>runs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Run Length Encoding
  lengths: int [1:48] 3 2 4 2 4 2 4 1 4 2 ...
  values : num [1:48] 1 3 1 3 1 3 1 3 1 3 ...</code></pre>
</div>
</div>
<p>What is the distribution of lengths of sequences of 1s?</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>runs_table <span class="ot">&lt;-</span> <span class="fu">table</span>(runs<span class="sc">$</span>lengths) </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>runs_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3  4 
13 14 10 11 </code></pre>
</div>
</div>
<p>We have at most four diffs of 1 in a row.</p>
<p>We need to check that if we remove an adapter, the new differences do not exceed 3. Example sequences really helped me figure out what’s going on here:</p>
<ul>
<li>If the diff sequence is …, 3, 1, 3,… (e.g.&nbsp;adapters 1, 4, 5, 8)
<ul>
<li>1 option to keep as is</li>
<li>We cannot remove any adapters</li>
<li><strong>1 option in total</strong></li>
</ul></li>
<li>If the diff sequence is …, 3, 1, 1, 3,… (e.g.&nbsp;adapters 1, 4, 5, 6, 9)
<ul>
<li>1 option to keep as is</li>
<li>1 option to remove one adapter (e.g.&nbsp;the 5)</li>
<li>we cannot remove two adapters</li>
<li><strong>2 options total</strong></li>
</ul></li>
<li>If the diff sequence is …, 3, 1, 1, 1, 3,… (e.g.&nbsp;adapters 1, 4, 5, 6, 7, 10)
<ul>
<li>1 option to keep as is</li>
<li>2 options to remove one adapter (e.g.&nbsp;the 5 or 6)</li>
<li>1 options to remove two adapters (e.g.&nbsp;the 5 and 6)</li>
<li>We cannot remove three adapters</li>
<li><strong>4 options total</strong></li>
</ul></li>
<li>If the diff sequence is …, 3, 1, 1, 1, 1, 3,… (e.g.&nbsp;adapters 1, 4, 5, 6, 7, 8, 11)
<ul>
<li>1 option to keep as is</li>
<li>3 options to remove one adapter (e.g.&nbsp;5, 6, or 7)</li>
<li>3 options to remove two adapters (e.g.&nbsp;any two of 5, 6, and 7)</li>
<li>We cannot remove three adapters</li>
<li><strong>7 options total</strong></li>
</ul></li>
</ul>
<p>Finally, we multiply each run length of difference of 1s with the number of options we have for removing adapters, then take the product of those products.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>runs_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lengths =</span> runs<span class="sc">$</span>lengths, <span class="at">values =</span> runs<span class="sc">$</span>values)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>options <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lengths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">options =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>))</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>runs_df <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(values <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(options, <span class="at">by =</span> <span class="st">"lengths"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prod_options =</span> <span class="fu">prod</span>(options)) <span class="sc">%&gt;%</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prod_options) <span class="sc">%&gt;%</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format</span>(<span class="at">scientific =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "259172170858496"</code></pre>
</div>
</div>
</section>
</section>
<section id="day-11-seating-system" class="level2">
<h2 class="anchored" data-anchor-id="day-11-seating-system">Day 11: <a href="https://adventofcode.com/2020/day/11">Seating System</a></h2>
<p><a href="data/AoC_day11.txt">My day 11 data</a></p>
<section id="part-1-changing-layout" class="level4">
<h4 class="anchored" data-anchor-id="part-1-changing-layout">Part 1: Changing layout</h4>
<p>My code for Day 11 runs a little slow (about 10 seconds for Part 1 and 80 seconds for Part 2), so for the sake of being able to rebuild this page quickly as I keep updating it working through the challenges, I will demonstrate this code with the test input provided as an example.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First we read in the data and convert it to a matrix (using the <a href="https://github.com/MilesMcBain/datapasta"><code>datapasta</code></a> package for the test input):</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># layout &lt;- readr::read_tsv("data/AoC_day11.txt", col_names = FALSE)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>X1,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LL.LL.LL"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LLLLLLL.LL"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.L.L..L.."</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LLLL.LL.LL"</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LL.LL.LL"</span>,</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LLLLL.LL"</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"..L.L....."</span>,</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LLLLLLLLLL"</span>,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LLLLLL.L"</span>,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LLLLL.LL"</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of columns for matrix</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>num_col <span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">str_length</span>(X1)) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(length)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># split layout into characters and turn to vector</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>layout_vec <span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">X1 =</span> <span class="fu">strsplit</span>(X1, <span class="at">split =</span> <span class="fu">character</span>(<span class="dv">0</span>), <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(X1) <span class="sc">%&gt;%</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co"># organise into matrix</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>initial_layout <span class="ot">&lt;-</span> <span class="fu">matrix</span>(layout_vec, <span class="at">ncol =</span> num_col, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we write a helper function that, given a matrix and row and column indices, returns a vector of the adjacent seats. We need to take care when indexing into the matrix, so we treat all corner and edge cases separately. Fiddly, but gets the job done.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>get_adj <span class="ot">&lt;-</span> <span class="cf">function</span>(mat, i,j) {</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  nr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mat)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  nc <span class="ot">&lt;-</span> <span class="fu">ncol</span>(mat)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># corner cases</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="dv">1</span>,<span class="dv">2</span>], mat[<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])}</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> j <span class="sc">==</span> nc) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="dv">1</span>,(nc<span class="dv">-1</span>)], mat[<span class="dv">2</span>,(nc<span class="dv">-1</span>)<span class="sc">:</span>nc])}</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[nr,<span class="dv">2</span>], mat[nr<span class="dv">-1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])}</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">&amp;</span> j <span class="sc">==</span> nc) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[nr<span class="dv">-1</span>, (nc<span class="dv">-1</span>)<span class="sc">:</span>nc], mat[nr, nc<span class="dv">-1</span>])}  </span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># edge cases</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="dv">1</span>, <span class="fu">c</span>(j<span class="dv">-1</span>,j<span class="sc">+</span><span class="dv">1</span>)], mat[<span class="dv">2</span>, (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)])}</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> nr) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[nr, <span class="fu">c</span>(j<span class="dv">-1</span>,j<span class="sc">+</span><span class="dv">1</span>)], mat[nr<span class="dv">-1</span>, (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)])}</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (j <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="fu">c</span>(i<span class="dv">-1</span>, i<span class="sc">+</span><span class="dv">1</span>), <span class="dv">1</span>], mat[(i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">1</span>), <span class="dv">2</span>])}</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (j <span class="sc">==</span> nc) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="fu">c</span>(i<span class="dv">-1</span>, i<span class="sc">+</span><span class="dv">1</span>), nc], mat[(i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">1</span>), nc<span class="dv">-1</span>])}</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inside cases</span></span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[i<span class="dv">-1</span>,(j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)], mat[i,<span class="fu">c</span>(j<span class="dv">-1</span>,j<span class="sc">+</span><span class="dv">1</span>)], mat[i<span class="sc">+</span><span class="dv">1</span>,(j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)])}</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  adj</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once we have a vector of surrounding seats, we can apply the rules in the problem to determine whether a given seat needs to change state. The <code>needs_changing</code> helper function does that. It’s overkill at this point to give options to specify the function for finding the vector of seats to check, and the maximum number of occupied seats people can tolerate around them, but (spolier alert) I put in these options when working on the challenge in Part 2.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>needs_changing <span class="ot">&lt;-</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(mat, i,j, <span class="at">get_surround =</span> get_adj, <span class="at">max_occupied =</span> <span class="dv">4</span>) {</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  surround <span class="ot">&lt;-</span> <span class="fu">get_surround</span>(mat, i,j)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  n_occupied <span class="ot">&lt;-</span> <span class="fu">sum</span>(surround <span class="sc">==</span> <span class="st">"#"</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((mat[i,j] <span class="sc">==</span> <span class="st">"L"</span>) <span class="sc">&amp;</span> (n_occupied <span class="sc">==</span> <span class="dv">0</span>)) <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> ((mat[i,j] <span class="sc">==</span> <span class="st">"#"</span>) <span class="sc">&amp;</span> (n_occupied <span class="sc">&gt;=</span> max_occupied)) {</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Since floor spaces don’t change, we only need to consider seats. We save the indices of the seats into a data frame, so we can vectorise over it using <code>tidyverse</code> functions. However, when we’ve determined the seats that need changing, using our <code>needs_changing</code> function, we need to convert those indices from a data.frame into a matrix, in order to index into the layout matrix appropriately and make the changes.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>seats <span class="ot">&lt;-</span> <span class="fu">which</span>(initial_layout <span class="sc">!=</span> <span class="st">"."</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>seats_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seats) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">i =</span> row, </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">j =</span> col)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> initial_layout</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>iters <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># loop until there are no further changes</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  seats_to_change <span class="ot">&lt;-</span> </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>    seats_df <span class="sc">%&gt;%</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">change_seat =</span> <span class="fu">needs_changing</span>(layout,i,j))   </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="fu">sum</span>(seats_to_change<span class="sc">$</span>change_seat)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (change <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">break</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  indices_to_change <span class="ot">&lt;-</span> </span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>    seats_to_change <span class="sc">%&gt;%</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(change_seat) <span class="sc">%&gt;%</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(i,j) <span class="sc">%&gt;%</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()  </span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  layout[indices_to_change] <span class="ot">&lt;-</span> </span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setdiff</span>(<span class="fu">c</span>(<span class="st">"L"</span>, <span class="st">"#"</span>),  layout[indices_to_change])</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>  iters <span class="ot">&lt;-</span> iters <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>part_1_iters <span class="ot">&lt;-</span> iters</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(layout<span class="sc">==</span> <span class="st">"#"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37</code></pre>
</div>
</div>
<p>On the test set, this takes 5 iterations. On the full data set, my answer is 2316, and it took 107 iterations.</p>
</section>
<section id="part-2-looking-further" class="level4">
<h4 class="anchored" data-anchor-id="part-2-looking-further">Part 2: Looking further</h4>
<p>Now, people look to the first seat they can see in each direction, and will change from occupied to unoccupied if five or more of them are occupied.</p>
<p>The plan is to write a function that extracts full vectors from a given seat to the edge of the layout matrix in each of the eight directions, then finds the first seat in each of those directions, and finally collects those into a vector of the seats under consideration when determining if a change is needed. Then I can reuse the loop from Part 1, just changing the arguments in the calls to <code>needs_changing</code>.</p>
<p>Here’s a helper function to get the first seat in a vector looking in one direction:</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>get_first_seat_from_vec <span class="ot">&lt;-</span> <span class="cf">function</span>(vec) {</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(vec <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"#"</span>, <span class="st">"L"</span>))) {</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(vec[<span class="fu">min</span>(<span class="fu">which</span>(vec <span class="sc">!=</span> <span class="st">"."</span>))])</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, if I thought getting adjacent seats to a given seat in Part 1 was fiddly, it’s nothing on getting a vector from a given seat to the edge of the matrix. There are many cases to consider to make we we don’t go out of bounds. In the diagonal directions, first we get a matrix of the indices of the matrix we need, then subset into the matrix accordingly.</p>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># takes a layout matrix (elements ".", "#", "L")</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># returns vector with first "L" or "#" encountered in each direction</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>get_first_seat <span class="ot">&lt;-</span> <span class="cf">function</span>(mat, i,j) {</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  nr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mat)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  nc <span class="ot">&lt;-</span> <span class="fu">ncol</span>(mat)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># North</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) N <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) N <span class="ot">&lt;-</span> mat[(i<span class="dv">-1</span>)<span class="sc">:</span><span class="dv">1</span>,j]</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># South</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> nr) S <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> nr) S <span class="ot">&lt;-</span> mat[(i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nr,j]</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># East</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">==</span> nc) E <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">&lt;</span> nc) E <span class="ot">&lt;-</span> mat[i, (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nc]</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># West</span></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">==</span> <span class="dv">1</span>) W <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">&gt;</span> <span class="dv">1</span>) W <span class="ot">&lt;-</span> mat[i, (j<span class="dv">-1</span>)<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># how far in each direction to edge of matrix</span></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>  to_N <span class="ot">&lt;-</span> i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>  to_S <span class="ot">&lt;-</span> nr <span class="sc">-</span> i</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>  to_E <span class="ot">&lt;-</span> nc <span class="sc">-</span> j</span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>  to_W <span class="ot">&lt;-</span> j <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># North-West</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>  NW_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_N, to_W)</span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> j <span class="sc">==</span> <span class="dv">1</span>) NW <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb78-35"><a href="#cb78-35" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb78-36"><a href="#cb78-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">-</span>NW_length), (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">-</span>NW_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb78-37"><a href="#cb78-37" aria-hidden="true" tabindex="-1"></a>    NW <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb78-38"><a href="#cb78-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-39"><a href="#cb78-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-40"><a href="#cb78-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># North-East</span></span>
<span id="cb78-41"><a href="#cb78-41" aria-hidden="true" tabindex="-1"></a>  NE_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_N, to_E)</span>
<span id="cb78-42"><a href="#cb78-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-43"><a href="#cb78-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> j <span class="sc">==</span> nc) NE <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-44"><a href="#cb78-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb78-45"><a href="#cb78-45" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb78-46"><a href="#cb78-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">-</span>NE_length), (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(j<span class="sc">+</span>NE_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb78-47"><a href="#cb78-47" aria-hidden="true" tabindex="-1"></a>    NE <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb78-48"><a href="#cb78-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-49"><a href="#cb78-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-50"><a href="#cb78-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># South-East</span></span>
<span id="cb78-51"><a href="#cb78-51" aria-hidden="true" tabindex="-1"></a>  SE_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_S, to_E)</span>
<span id="cb78-52"><a href="#cb78-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-53"><a href="#cb78-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">|</span> j <span class="sc">==</span> nc) SE <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-54"><a href="#cb78-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb78-55"><a href="#cb78-55" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb78-56"><a href="#cb78-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(i<span class="sc">+</span>SE_length), (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(j<span class="sc">+</span>SE_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb78-57"><a href="#cb78-57" aria-hidden="true" tabindex="-1"></a>    SE <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb78-58"><a href="#cb78-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-59"><a href="#cb78-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-60"><a href="#cb78-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># South-West</span></span>
<span id="cb78-61"><a href="#cb78-61" aria-hidden="true" tabindex="-1"></a>  SW_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_S, to_W)</span>
<span id="cb78-62"><a href="#cb78-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-63"><a href="#cb78-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">|</span> j <span class="sc">==</span> <span class="dv">1</span>) SW <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb78-64"><a href="#cb78-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb78-65"><a href="#cb78-65" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb78-66"><a href="#cb78-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(i<span class="sc">+</span>SW_length), (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">-</span>SW_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb78-67"><a href="#cb78-67" aria-hidden="true" tabindex="-1"></a>    SW <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb78-68"><a href="#cb78-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb78-69"><a href="#cb78-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-70"><a href="#cb78-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vectors from mat[i,j] to the edge in each direction </span></span>
<span id="cb78-71"><a href="#cb78-71" aria-hidden="true" tabindex="-1"></a>  all_vecs <span class="ot">&lt;-</span> </span>
<span id="cb78-72"><a href="#cb78-72" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">list</span>(<span class="at">N =</span> N, <span class="at">S =</span> S, <span class="at">E =</span> E, <span class="at">W =</span> W, <span class="at">NW =</span> NW, <span class="at">NE =</span> NE, <span class="at">SE =</span> SE, <span class="at">SW =</span> SW))</span>
<span id="cb78-73"><a href="#cb78-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-74"><a href="#cb78-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the first seat in each direction, collapsed to a vector</span></span>
<span id="cb78-75"><a href="#cb78-75" aria-hidden="true" tabindex="-1"></a>  first_seats <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(all_vecs, get_first_seat_from_vec)</span>
<span id="cb78-76"><a href="#cb78-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb78-77"><a href="#cb78-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove NAs from list and return</span></span>
<span id="cb78-78"><a href="#cb78-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (these occur either when starting on an edge, </span></span>
<span id="cb78-79"><a href="#cb78-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># or when there are no seats in a given direction)</span></span>
<span id="cb78-80"><a href="#cb78-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(first_seats[<span class="sc">!</span><span class="fu">is.na</span>(first_seats)])</span>
<span id="cb78-81"><a href="#cb78-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-82"><a href="#cb78-82" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="">
<summary>Toggle the code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> initial_layout</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>iters <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># loop until there are no further changes</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  seats_to_change <span class="ot">&lt;-</span> </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    seats_df <span class="sc">%&gt;%</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">change_seat =</span> <span class="fu">needs_changing</span>(layout,i,j, get_first_seat, <span class="dv">5</span>))   </span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="fu">sum</span>(seats_to_change<span class="sc">$</span>change_seat)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (change <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">break</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  indices_to_change <span class="ot">&lt;-</span> </span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>    seats_to_change <span class="sc">%&gt;%</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(change_seat) <span class="sc">%&gt;%</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(i,j) <span class="sc">%&gt;%</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()  </span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  layout[indices_to_change] <span class="ot">&lt;-</span> </span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setdiff</span>(<span class="fu">c</span>(<span class="st">"L"</span>, <span class="st">"#"</span>),  layout[indices_to_change])</span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  iters <span class="ot">&lt;-</span> iters <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>part_2_iters <span class="ot">&lt;-</span> iters</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(layout<span class="sc">==</span> <span class="st">"#"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 26</code></pre>
</div>
</div>
<p>On the test set, this takes 6 iterations. On the full data set, my answer is 2128, and it took 87 iterations. Given this is fewer iterations than in Part 1, it must be my code for getting the first seat that’s slowing things down.</p>
<p>I am unsatisfied both by how many lines of code this has taken as well as the time taken to run. The introduction to Advent of Code says that each challenge has a solution that will complete in at most 15 seconds on ten year old hardware. So clearly there’s a better way of doing this. Perhaps something to revisit in the future.</p>
</section>
</section>
<section id="next" class="level2">
<h2 class="anchored" data-anchor-id="next">Next</h2>
<p>I was late to the game, and that was as far as I managed to get in December 2020. I’m looking forward to taking on the challenge again in 2021!</p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">https://creativecommons.org/licenses/by-sa/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{kaye2020,
  author = {Ella Kaye},
  editor = {},
  title = {Advent of {Code} 2020},
  date = {2020-12-09},
  url = {https://ellakaye.co.uk/posts/2020-12-09_advent-of-code-2020},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-kaye2020" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Ella Kaye. 2020. <span>“Advent of Code 2020.”</span> December 9, 2020.
<a href="https://ellakaye.co.uk/posts/2020-12-09_advent-of-code-2020">https://ellakaye.co.uk/posts/2020-12-09_advent-of-code-2020</a>.
</div></div></section></div></main> <!-- /main -->
<div class="giscus">
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content --><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb81" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Advent of Code 2020"</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> |</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">  My attempts at Advent of Code, 2020</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Ella Kaye</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://twitter.com/ellamkaye</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2020-12-09</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="an">base_url:</span><span class="co"> https://ellakaye.rbind.io/</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> advent-of-code-2020.jpg</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - R</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - Advent of Code</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 4</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="an">twitter:</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co">  site: "@ellamkaye"</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co">  creator: "@ellamkaye"</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> false</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Advent of Code</span><span class="co">](https://adventofcode.com)</span> is a series of small programming challenges, released daily throughout December in the run-up to Christmas. Part 1 of the challenge is given first. On its successful completion, Part 2 is revealed. The challenges are designed to be solved in any programming language. I will be using R. </span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>There will no doubt be a wide variety of ways to solve these problems. I'm going to go with the first thing I think of that gets the right answer. In most cases, I expect that there will be more concise and efficient solutions. Most of the time I'm working in R, it's within the <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org)</span>, so I imagine that framework will feature heavily below.</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>Each participant gets different input data, so my numerical solutions may be different from others. If you're not signed up for Advent of Code yourself, but want to follow along with my data, you can download it at from the data links at the beginning of each day's section. The links in the day section headers take you to challenge on the Advent of Code page. </span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 1: [Report Repair](https://adventofcode.com/2020/day/1)</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;&lt;a</span> <span class="er">id</span><span class="ot">=</span><span class="st">'day1'</span><span class="kw">&gt;&lt;/a&gt;&lt;/p&gt;</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 1 data</span><span class="co">](data/AoC_day1.txt)</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Two numbers</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>The challenge is to find two numbers from a list that sum to 2020, then to report their product.</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a><span class="in">`expand.grid()`</span> creates a data frame from all combinations of the supplied vectors. Since the vectors are the same, each pair is duplicated. In this case the two numbers in the list that sum to 2020 are 704 and 1316, and we have one row with 704 as Var1 and one with 704 as Var2. <span class="in">`slice(1)`</span> takes the first occurrence of the pair.</span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>expenses <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"data/AoC_day1.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a><span class="fu">expand.grid</span>(expenses, expenses) <span class="sc">%&gt;%</span> </span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> Var1 <span class="sc">+</span> Var2) <span class="sc">%&gt;%</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sum <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prod =</span> Var1 <span class="sc">*</span> Var2) <span class="sc">%&gt;%</span></span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prod)</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Three numbers</span></span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a>The follow-up challenge is the same but with three numbers. I went with essentially the same code but it's notably slower. There are a lot of repeated calculations here: each triplet appears six times in the table.</span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a><span class="fu">expand.grid</span>(expenses, expenses, expenses) <span class="sc">%&gt;%</span> </span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> Var1 <span class="sc">+</span> Var2 <span class="sc">+</span> Var3) <span class="sc">%&gt;%</span></span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sum <span class="sc">==</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prod =</span> Var1 <span class="sc">*</span> Var2 <span class="sc">*</span> Var3) <span class="sc">%&gt;%</span></span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prod)</span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 2: [Password Philosophy](https://adventofcode.com/2020/day/2)</span></span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 2 data</span><span class="co">](data/AoC_day2.txt)</span></span>
<span id="cb81-72"><a href="#cb81-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-73"><a href="#cb81-73" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Number of letters</span></span>
<span id="cb81-74"><a href="#cb81-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-75"><a href="#cb81-75" aria-hidden="true" tabindex="-1"></a>We need to find how many passwords are valid according to their policy. The policies and passwords are given as follows:</span>
<span id="cb81-76"><a href="#cb81-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-77"><a href="#cb81-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-78"><a href="#cb81-78" aria-hidden="true" tabindex="-1"></a><span class="in">1-3 a: abcde</span></span>
<span id="cb81-79"><a href="#cb81-79" aria-hidden="true" tabindex="-1"></a><span class="in">1-3 b: cdefg</span></span>
<span id="cb81-80"><a href="#cb81-80" aria-hidden="true" tabindex="-1"></a><span class="in">2-9 c: ccccccccc</span></span>
<span id="cb81-81"><a href="#cb81-81" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-82"><a href="#cb81-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-83"><a href="#cb81-83" aria-hidden="true" tabindex="-1"></a>Each line gives the password policy and then the password. The password policy indicates the lowest and highest number of times a given letter must appear for the password to be valid. For example, <span class="in">`1-3 a`</span> means that the password must contain <span class="in">`a`</span> at least 1 time and at most 3 times.</span>
<span id="cb81-84"><a href="#cb81-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-87"><a href="#cb81-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-88"><a href="#cb81-88" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-89"><a href="#cb81-89" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb81-90"><a href="#cb81-90" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb81-91"><a href="#cb81-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-92"><a href="#cb81-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-93"><a href="#cb81-93" aria-hidden="true" tabindex="-1"></a>First load the libraries we'll need. We then read in the data and use <span class="in">`tidyr`</span> functions to separate out the parts of the policy and the password, making sure to convert the columns to numeric as appropriate:</span>
<span id="cb81-94"><a href="#cb81-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-95"><a href="#cb81-95" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb81-96"><a href="#cb81-96" aria-hidden="true" tabindex="-1"></a>passwords <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/AoC_day2.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-97"><a href="#cb81-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(X1, <span class="fu">c</span>(<span class="st">"policy"</span>, <span class="st">"password"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-98"><a href="#cb81-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(policy, <span class="fu">c</span>(<span class="st">"count"</span>, <span class="st">"letter"</span>), <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-99"><a href="#cb81-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(count, <span class="fu">c</span>(<span class="st">"min"</span>, <span class="st">"max"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-100"><a href="#cb81-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">as.integer</span>(min),</span>
<span id="cb81-101"><a href="#cb81-101" aria-hidden="true" tabindex="-1"></a>         <span class="at">max =</span> <span class="fu">as.integer</span>(max))</span>
<span id="cb81-102"><a href="#cb81-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-103"><a href="#cb81-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-104"><a href="#cb81-104" aria-hidden="true" tabindex="-1"></a>Next, we use the <span class="in">`stringr`</span> function <span class="in">`str_count()`</span> to count how many times the given letter appears in the password, and conditional logic to check whether it is repeated within the specified number of times. Because <span class="in">`TRUE`</span> has a numeric value of 1 and <span class="in">`FALSE`</span> has a numeric value of 0, we can sum the resulting column to get a count of how many passwords are valid according to their policies.</span>
<span id="cb81-105"><a href="#cb81-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-108"><a href="#cb81-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-109"><a href="#cb81-109" aria-hidden="true" tabindex="-1"></a>passwords <span class="sc">%&gt;%</span></span>
<span id="cb81-110"><a href="#cb81-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">str_count</span>(password, letter)) <span class="sc">%&gt;%</span></span>
<span id="cb81-111"><a href="#cb81-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">password_in_policy =</span> <span class="fu">if_else</span>(count <span class="sc">&gt;=</span> min <span class="sc">&amp;</span> count <span class="sc">&lt;=</span> max, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-112"><a href="#cb81-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">correct =</span> <span class="fu">sum</span>(password_in_policy)) <span class="sc">%&gt;%</span></span>
<span id="cb81-113"><a href="#cb81-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(correct)</span>
<span id="cb81-114"><a href="#cb81-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-115"><a href="#cb81-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-116"><a href="#cb81-116" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Position of letters</span></span>
<span id="cb81-117"><a href="#cb81-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-118"><a href="#cb81-118" aria-hidden="true" tabindex="-1"></a>Now the policy is interpreted differently. Each policy actually describes two positions in the password, where 1 means the first character, 2 means the second character, and so on. Exactly one of these positions must contain the given letter. How many are valid now?</span>
<span id="cb81-119"><a href="#cb81-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-120"><a href="#cb81-120" aria-hidden="true" tabindex="-1"></a>There were a couple of *gotchas* here. When I used `separate()` in the previous part, I had inadvertently left a leading whitespace in front of the password, something that was messing up my indexing with `str_sub`. Using `str_trim()` first cleared that up. Also, we need *exactly one* of the positions to match. <span class="in">`|`</span> is an inclusive or. We need <span class="in">`xor()`</span> for exclusive or instead.</span>
<span id="cb81-121"><a href="#cb81-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-124"><a href="#cb81-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-125"><a href="#cb81-125" aria-hidden="true" tabindex="-1"></a>passwords <span class="sc">%&gt;%</span></span>
<span id="cb81-126"><a href="#cb81-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">password =</span> <span class="fu">str_trim</span>(password)) <span class="sc">%&gt;%</span></span>
<span id="cb81-127"><a href="#cb81-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pos1_letter =</span> <span class="fu">str_sub</span>(password, min, min),</span>
<span id="cb81-128"><a href="#cb81-128" aria-hidden="true" tabindex="-1"></a>         <span class="at">pos2_letter =</span> <span class="fu">str_sub</span>(password, max, max)) <span class="sc">%&gt;%</span></span>
<span id="cb81-129"><a href="#cb81-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">match_one =</span> <span class="fu">xor</span>(pos1_letter <span class="sc">==</span> letter, pos2_letter <span class="sc">==</span> letter)) <span class="sc">%&gt;%</span></span>
<span id="cb81-130"><a href="#cb81-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">correct =</span> <span class="fu">sum</span>(match_one)) <span class="sc">%&gt;%</span></span>
<span id="cb81-131"><a href="#cb81-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(correct) </span>
<span id="cb81-132"><a href="#cb81-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-133"><a href="#cb81-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-134"><a href="#cb81-134" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 3: [Toboggan Trajectory](https://adventofcode.com/2020/day/3)</span></span>
<span id="cb81-135"><a href="#cb81-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-136"><a href="#cb81-136" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 3 data</span><span class="co">](data/AoC_day3.txt)</span></span>
<span id="cb81-137"><a href="#cb81-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-138"><a href="#cb81-138" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Encountering trees</span></span>
<span id="cb81-139"><a href="#cb81-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-140"><a href="#cb81-140" aria-hidden="true" tabindex="-1"></a>Starting at the top left corner of the map, how many trees ("#") do we encounter, going at a trajectory of 3 right and 1 down?</span>
<span id="cb81-141"><a href="#cb81-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-142"><a href="#cb81-142" aria-hidden="true" tabindex="-1"></a>First, read in the data and save it into a matrix. My method here feels really hack-y. I'm sure there must be a better approach. </span>
<span id="cb81-143"><a href="#cb81-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-144"><a href="#cb81-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb81-145"><a href="#cb81-145" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-146"><a href="#cb81-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-147"><a href="#cb81-147" aria-hidden="true" tabindex="-1"></a>tree_map <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/AoC_day3.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb81-148"><a href="#cb81-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-149"><a href="#cb81-149" aria-hidden="true" tabindex="-1"></a>num_col <span class="ot">&lt;-</span> tree_map <span class="sc">%&gt;%</span></span>
<span id="cb81-150"><a href="#cb81-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">str_length</span>(X1)) <span class="sc">%&gt;%</span></span>
<span id="cb81-151"><a href="#cb81-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-152"><a href="#cb81-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(length)</span>
<span id="cb81-153"><a href="#cb81-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-154"><a href="#cb81-154" aria-hidden="true" tabindex="-1"></a>tree_vec <span class="ot">&lt;-</span> tree_map <span class="sc">%&gt;%</span></span>
<span id="cb81-155"><a href="#cb81-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">X1 =</span> <span class="fu">strsplit</span>(X1, <span class="at">split =</span> <span class="fu">character</span>(<span class="dv">0</span>), <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-156"><a href="#cb81-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(X1) <span class="sc">%&gt;%</span></span>
<span id="cb81-157"><a href="#cb81-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb81-158"><a href="#cb81-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-159"><a href="#cb81-159" aria-hidden="true" tabindex="-1"></a>tree_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(tree_vec, <span class="at">ncol =</span> num_col, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-160"><a href="#cb81-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-161"><a href="#cb81-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-162"><a href="#cb81-162" aria-hidden="true" tabindex="-1"></a>Now work my way across and down the matrix, using the <span class="in">`%%`</span> modulo operator to loop round where necessary. The <span class="in">`-1`</span> and <span class="in">`+1`</span> in the line <span class="in">`((y + right - 1) %% num_col) + 1`</span> is a hack to get round the fact that, for <span class="in">`num_col`</span> columns, the modulo runs from <span class="in">`0`</span> to <span class="in">`num_col - 1`</span>, but the column indexes for our matrix run from <span class="in">`1`</span> to <span class="in">`num_col`</span>.  </span>
<span id="cb81-163"><a href="#cb81-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-164"><a href="#cb81-164" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb81-165"><a href="#cb81-165" aria-hidden="true" tabindex="-1"></a>right <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb81-166"><a href="#cb81-166" aria-hidden="true" tabindex="-1"></a>down <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb81-167"><a href="#cb81-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-168"><a href="#cb81-168" aria-hidden="true" tabindex="-1"></a>num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tree_mat)</span>
<span id="cb81-169"><a href="#cb81-169" aria-hidden="true" tabindex="-1"></a>num_col <span class="ot">&lt;-</span> <span class="fu">ncol</span>(tree_mat)</span>
<span id="cb81-170"><a href="#cb81-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-171"><a href="#cb81-171" aria-hidden="true" tabindex="-1"></a><span class="co"># start counting trees encountered</span></span>
<span id="cb81-172"><a href="#cb81-172" aria-hidden="true" tabindex="-1"></a>trees <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-173"><a href="#cb81-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-174"><a href="#cb81-174" aria-hidden="true" tabindex="-1"></a><span class="co"># start square</span></span>
<span id="cb81-175"><a href="#cb81-175" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb81-176"><a href="#cb81-176" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb81-177"><a href="#cb81-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-178"><a href="#cb81-178" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (x <span class="sc">&lt;=</span> num_rows) {</span>
<span id="cb81-179"><a href="#cb81-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-180"><a href="#cb81-180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cat("row: ", x, "col: ", y, "\n")</span></span>
<span id="cb81-181"><a href="#cb81-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-182"><a href="#cb81-182" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (tree_mat[x,y] <span class="sc">==</span> <span class="st">"#"</span>) trees <span class="ot">&lt;-</span> trees <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-183"><a href="#cb81-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-184"><a href="#cb81-184" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">+</span> down</span>
<span id="cb81-185"><a href="#cb81-185" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> ((y <span class="sc">+</span> right <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> num_col) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-186"><a href="#cb81-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-187"><a href="#cb81-187" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-188"><a href="#cb81-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-189"><a href="#cb81-189" aria-hidden="true" tabindex="-1"></a>trees</span>
<span id="cb81-190"><a href="#cb81-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-191"><a href="#cb81-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-192"><a href="#cb81-192" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Checking further slopes</span></span>
<span id="cb81-193"><a href="#cb81-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-194"><a href="#cb81-194" aria-hidden="true" tabindex="-1"></a>We now need to check several other trajectories, and multiply together the number of trees we find, so we wrap the Part 1 code into a function.</span>
<span id="cb81-195"><a href="#cb81-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-196"><a href="#cb81-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb81-197"><a href="#cb81-197" aria-hidden="true" tabindex="-1"></a>slope_check <span class="ot">&lt;-</span> <span class="cf">function</span>(tree_mat, right, down) {</span>
<span id="cb81-198"><a href="#cb81-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-199"><a href="#cb81-199" aria-hidden="true" tabindex="-1"></a>  num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tree_mat)</span>
<span id="cb81-200"><a href="#cb81-200" aria-hidden="true" tabindex="-1"></a>  num_col <span class="ot">&lt;-</span> <span class="fu">ncol</span>(tree_mat)</span>
<span id="cb81-201"><a href="#cb81-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-202"><a href="#cb81-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># start counting trees encountered</span></span>
<span id="cb81-203"><a href="#cb81-203" aria-hidden="true" tabindex="-1"></a>  trees <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-204"><a href="#cb81-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-205"><a href="#cb81-205" aria-hidden="true" tabindex="-1"></a>  <span class="co"># start square</span></span>
<span id="cb81-206"><a href="#cb81-206" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb81-207"><a href="#cb81-207" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb81-208"><a href="#cb81-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-209"><a href="#cb81-209" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (x <span class="sc">&lt;=</span> num_rows) {</span>
<span id="cb81-210"><a href="#cb81-210" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-211"><a href="#cb81-211" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (tree_mat[x,y] <span class="sc">==</span> <span class="st">"#"</span>) trees <span class="ot">&lt;-</span> trees <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-212"><a href="#cb81-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-213"><a href="#cb81-213" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x <span class="sc">+</span> down</span>
<span id="cb81-214"><a href="#cb81-214" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> ((y <span class="sc">+</span> right <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%%</span> num_col) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-215"><a href="#cb81-215" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-216"><a href="#cb81-216" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-217"><a href="#cb81-217" aria-hidden="true" tabindex="-1"></a>  trees</span>
<span id="cb81-218"><a href="#cb81-218" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-219"><a href="#cb81-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-220"><a href="#cb81-220" aria-hidden="true" tabindex="-1"></a><span class="fu">prod</span>(<span class="fu">slope_check</span>(tree_mat, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb81-221"><a href="#cb81-221" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb81-222"><a href="#cb81-222" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb81-223"><a href="#cb81-223" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">7</span>, <span class="dv">1</span>),</span>
<span id="cb81-224"><a href="#cb81-224" aria-hidden="true" tabindex="-1"></a>     <span class="fu">slope_check</span>(tree_mat, <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb81-225"><a href="#cb81-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-226"><a href="#cb81-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-227"><a href="#cb81-227" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 4: [Passport Processing](https://adventofcode.com/2020/day/4)</span></span>
<span id="cb81-228"><a href="#cb81-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-229"><a href="#cb81-229" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;&lt;a</span> <span class="er">id</span><span class="ot">=</span><span class="st">'day4'</span><span class="kw">&gt;&lt;/a&gt;&lt;/p&gt;</span></span>
<span id="cb81-230"><a href="#cb81-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-231"><a href="#cb81-231" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 4 data</span><span class="co">](data/AoC_day4.txt)</span></span>
<span id="cb81-232"><a href="#cb81-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-233"><a href="#cb81-233" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Complete passports</span></span>
<span id="cb81-234"><a href="#cb81-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-237"><a href="#cb81-237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-238"><a href="#cb81-238" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-239"><a href="#cb81-239" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb81-240"><a href="#cb81-240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-241"><a href="#cb81-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-242"><a href="#cb81-242" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`readr::read_tsv()`</span> off the bat removes the blank lines, making it impossible to identify the different passports, but reading in the data via <span class="in">`readLines()`</span> then converting <span class="in">`as_tibble()`</span> preserves them, and then allows us to use <span class="in">`tidyverse`</span> functions for the remaining tidying. <span class="in">`cumsum()`</span> on a logical vectors takes advantage of <span class="in">`FALSE`</span> having a numeric value of zero and <span class="in">`TRUE`</span> having a numeric value of one.</span>
<span id="cb81-243"><a href="#cb81-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-246"><a href="#cb81-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-247"><a href="#cb81-247" aria-hidden="true" tabindex="-1"></a>passports <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"data/AoC_day4.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-248"><a href="#cb81-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-249"><a href="#cb81-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(value, <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-250"><a href="#cb81-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_passport =</span> value <span class="sc">==</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-251"><a href="#cb81-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">cumsum</span>(new_passport) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-252"><a href="#cb81-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>new_passport) <span class="sc">%&gt;%</span></span>
<span id="cb81-253"><a href="#cb81-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>new_passport) <span class="sc">%&gt;%</span></span>
<span id="cb81-254"><a href="#cb81-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(value, <span class="fu">c</span>(<span class="st">"key"</span>, <span class="st">"value"</span>), <span class="at">sep =</span> <span class="st">":"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-255"><a href="#cb81-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(ID)</span>
<span id="cb81-256"><a href="#cb81-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-257"><a href="#cb81-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-258"><a href="#cb81-258" aria-hidden="true" tabindex="-1"></a>Our data is now in three columns, with ID, key and value, so now we need to find the number of passports with all seven fields once <span class="in">`cid`</span> is excluded:</span>
<span id="cb81-259"><a href="#cb81-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-262"><a href="#cb81-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-263"><a href="#cb81-263" aria-hidden="true" tabindex="-1"></a>passports <span class="sc">%&gt;%</span></span>
<span id="cb81-264"><a href="#cb81-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(key <span class="sc">!=</span> <span class="st">"cid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-265"><a href="#cb81-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb81-266"><a href="#cb81-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-267"><a href="#cb81-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb81-268"><a href="#cb81-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-269"><a href="#cb81-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-270"><a href="#cb81-270" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Valid passports</span></span>
<span id="cb81-271"><a href="#cb81-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-272"><a href="#cb81-272" aria-hidden="true" tabindex="-1"></a>Now we need to add data validation checks:</span>
<span id="cb81-273"><a href="#cb81-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-274"><a href="#cb81-274" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>byr (Birth Year) - four digits; at least 1920 and at most 2002.</span>
<span id="cb81-275"><a href="#cb81-275" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>iyr (Issue Year) - four digits; at least 2010 and at most 2020.</span>
<span id="cb81-276"><a href="#cb81-276" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>eyr (Expiration Year) - four digits; at least 2020 and at most 2030.</span>
<span id="cb81-277"><a href="#cb81-277" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>hgt (Height) - a number followed by either cm or in:</span>
<span id="cb81-278"><a href="#cb81-278" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>If cm, the number must be at least 150 and at most 193.</span>
<span id="cb81-279"><a href="#cb81-279" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>If in, the number must be at least 59 and at most 76.</span>
<span id="cb81-280"><a href="#cb81-280" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>hcl (Hair Color) - a # followed by exactly six characters 0-9 or a-f.</span>
<span id="cb81-281"><a href="#cb81-281" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ecl (Eye Color) - exactly one of: amb blu brn gry grn hzl oth.</span>
<span id="cb81-282"><a href="#cb81-282" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>pid (Passport ID) - a nine-digit number, including leading zeroes.</span>
<span id="cb81-283"><a href="#cb81-283" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>cid (Country ID) - ignored, missing or not.</span>
<span id="cb81-284"><a href="#cb81-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-285"><a href="#cb81-285" aria-hidden="true" tabindex="-1"></a>Ignoring the <span class="in">`cid`</span> field, we narrow down on passports that at least have the right number of fields, and extract the number from the <span class="in">`hgt`</span> column:</span>
<span id="cb81-286"><a href="#cb81-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-287"><a href="#cb81-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE, warning = FALSE}</span></span>
<span id="cb81-288"><a href="#cb81-288" aria-hidden="true" tabindex="-1"></a>complete_passports <span class="ot">&lt;-</span> passports <span class="sc">%&gt;%</span></span>
<span id="cb81-289"><a href="#cb81-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(key <span class="sc">!=</span> <span class="st">"cid"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-290"><a href="#cb81-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb81-291"><a href="#cb81-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-292"><a href="#cb81-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb81-293"><a href="#cb81-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hgt_value =</span> <span class="fu">case_when</span>(</span>
<span id="cb81-294"><a href="#cb81-294" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hgt"</span> <span class="sc">~</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(value),</span>
<span id="cb81-295"><a href="#cb81-295" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-296"><a href="#cb81-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb81-297"><a href="#cb81-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-298"><a href="#cb81-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-299"><a href="#cb81-299" aria-hidden="true" tabindex="-1"></a>Then we create a <span class="in">`check`</span> column, which is <span class="in">`TRUE`</span> when the value for each key meets the required conditions. Those with 7 <span class="in">`TRUE`</span>s are valid. Note that with <span class="in">`case_when()`</span> we've left the check column as <span class="in">`NA`</span> when the condition is <span class="in">`FALSE`</span>, requiring <span class="in">`na.rm = TRUE`</span> in the call to <span class="in">`sum()`</span>. We can get round that by adding a final line to the <span class="in">`case_when()`</span> condition stating <span class="in">`TRUE ~ FALSE`</span>. <span class="in">`TRUE`</span> here is a catch-all for all remaining rows not covered by the conditions above, and then we set them to <span class="in">`FALSE`</span>, but I find the line <span class="in">`TRUE ~ FALSE`</span> unintuitive. </span>
<span id="cb81-300"><a href="#cb81-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-301"><a href="#cb81-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb81-302"><a href="#cb81-302" aria-hidden="true" tabindex="-1"></a>complete_passports <span class="sc">%&gt;%</span></span>
<span id="cb81-303"><a href="#cb81-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">check =</span> <span class="fu">case_when</span>(</span>
<span id="cb81-304"><a href="#cb81-304" aria-hidden="true" tabindex="-1"></a>    (key <span class="sc">==</span> <span class="st">"byr"</span> <span class="sc">&amp;</span> value <span class="sc">&gt;=</span> <span class="dv">1920</span>) <span class="sc">&amp;</span> (key <span class="sc">==</span> <span class="st">"byr"</span> <span class="sc">&amp;</span> value <span class="sc">&lt;=</span> <span class="dv">2002</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-305"><a href="#cb81-305" aria-hidden="true" tabindex="-1"></a>    (key <span class="sc">==</span> <span class="st">"iyr"</span> <span class="sc">&amp;</span> value <span class="sc">&gt;=</span> <span class="dv">2010</span>) <span class="sc">&amp;</span> (key <span class="sc">==</span> <span class="st">"iyr"</span> <span class="sc">&amp;</span> value <span class="sc">&lt;=</span> <span class="dv">2020</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-306"><a href="#cb81-306" aria-hidden="true" tabindex="-1"></a>    (key <span class="sc">==</span> <span class="st">"eyr"</span> <span class="sc">&amp;</span> value <span class="sc">&gt;=</span> <span class="dv">2020</span>) <span class="sc">&amp;</span> (key <span class="sc">==</span> <span class="st">"eyr"</span> <span class="sc">&amp;</span> value <span class="sc">&lt;=</span> <span class="dv">2030</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-307"><a href="#cb81-307" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hgt"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"cm"</span>) <span class="sc">&amp;</span> hgt_value <span class="sc">&gt;=</span> <span class="dv">150</span> <span class="sc">&amp;</span> hgt_value <span class="sc">&lt;=</span> <span class="dv">193</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-308"><a href="#cb81-308" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hgt"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"in"</span>) <span class="sc">&amp;</span> hgt_value <span class="sc">&gt;=</span> <span class="dv">59</span> <span class="sc">&amp;</span> hgt_value <span class="sc">&lt;=</span> <span class="dv">76</span> <span class="sc">~</span> <span class="cn">TRUE</span>,  </span>
<span id="cb81-309"><a href="#cb81-309" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"hcl"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"^#[a-f0-9]{6}$"</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-310"><a href="#cb81-310" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"ecl"</span> <span class="sc">&amp;</span> value <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"amb"</span>, <span class="st">"blu"</span>, <span class="st">"brn"</span>, <span class="st">"gry"</span>, <span class="st">"grn"</span>, <span class="st">"hzl"</span>, <span class="st">"oth"</span>) <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-311"><a href="#cb81-311" aria-hidden="true" tabindex="-1"></a>    key <span class="sc">==</span> <span class="st">"pid"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(value, <span class="st">"^[0-9]{9}$"</span>) <span class="sc">~</span> <span class="cn">TRUE</span></span>
<span id="cb81-312"><a href="#cb81-312" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb81-313"><a href="#cb81-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb81-314"><a href="#cb81-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">check_all =</span> <span class="fu">sum</span>(check, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-315"><a href="#cb81-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(check_all <span class="sc">==</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-316"><a href="#cb81-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb81-317"><a href="#cb81-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-318"><a href="#cb81-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-319"><a href="#cb81-319" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 5: [Binary Boarding](https://adventofcode.com/2020/day/5)</span></span>
<span id="cb81-320"><a href="#cb81-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-321"><a href="#cb81-321" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 5 data</span><span class="co">](data/AoC_day5.txt)</span></span>
<span id="cb81-322"><a href="#cb81-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-323"><a href="#cb81-323" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Finding all seat IDs</span></span>
<span id="cb81-324"><a href="#cb81-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-325"><a href="#cb81-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-326"><a href="#cb81-326" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-327"><a href="#cb81-327" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb81-328"><a href="#cb81-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-329"><a href="#cb81-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-330"><a href="#cb81-330" aria-hidden="true" tabindex="-1"></a>The code below sets starts by setting each row number to 127 and each column number to 7, the maximum they can be, then, working along the string, lowering the maximum (or leaving it as is) one letter at a time:</span>
<span id="cb81-331"><a href="#cb81-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-332"><a href="#cb81-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb81-333"><a href="#cb81-333" aria-hidden="true" tabindex="-1"></a>boarding <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"data/AoC_day5.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-334"><a href="#cb81-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">binary =</span> X1)</span>
<span id="cb81-335"><a href="#cb81-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-336"><a href="#cb81-336" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="ot">&lt;-</span> boarding <span class="sc">%&gt;%</span></span>
<span id="cb81-337"><a href="#cb81-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">127</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-338"><a href="#cb81-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-339"><a href="#cb81-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">64</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb81-340"><a href="#cb81-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">32</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb81-341"><a href="#cb81-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">3</span>, <span class="dv">3</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">16</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb81-342"><a href="#cb81-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">4</span>, <span class="dv">4</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">8</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb81-343"><a href="#cb81-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">5</span>, <span class="dv">5</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">4</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb81-344"><a href="#cb81-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">6</span>, <span class="dv">6</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">2</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb81-345"><a href="#cb81-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">7</span>, <span class="dv">7</span>) <span class="sc">==</span> <span class="st">"F"</span>, row <span class="sc">-</span> <span class="dv">1</span>, row)) <span class="sc">%&gt;%</span></span>
<span id="cb81-346"><a href="#cb81-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">8</span>, <span class="dv">8</span>) <span class="sc">==</span> <span class="st">"L"</span>, col <span class="sc">-</span> <span class="dv">4</span>, col)) <span class="sc">%&gt;%</span></span>
<span id="cb81-347"><a href="#cb81-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">9</span>, <span class="dv">9</span>) <span class="sc">==</span> <span class="st">"L"</span>, col <span class="sc">-</span> <span class="dv">2</span>, col)) <span class="sc">%&gt;%</span>  </span>
<span id="cb81-348"><a href="#cb81-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">col =</span> <span class="fu">if_else</span>(<span class="fu">str_sub</span>(binary, <span class="dv">10</span>, <span class="dv">10</span>) <span class="sc">==</span> <span class="st">"L"</span>, col <span class="sc">-</span> <span class="dv">1</span>, col)) <span class="sc">%&gt;%</span>  </span>
<span id="cb81-349"><a href="#cb81-349" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> row <span class="sc">*</span> <span class="dv">8</span> <span class="sc">+</span> col) </span>
<span id="cb81-350"><a href="#cb81-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-351"><a href="#cb81-351" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="sc">%&gt;%</span></span>
<span id="cb81-352"><a href="#cb81-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">max =</span> <span class="fu">max</span>(ID)) <span class="sc">%&gt;%</span></span>
<span id="cb81-353"><a href="#cb81-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(max)</span>
<span id="cb81-354"><a href="#cb81-354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-355"><a href="#cb81-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-356"><a href="#cb81-356" aria-hidden="true" tabindex="-1"></a>OK, I know I said in the introduction to this post that I would go with the first solution I think of that gets the right answer, and the above does work, but I'm *deeply* unhappy with the code. There's too much repetition, I don't like the use of subtraction when diving by 2 feels more appropriate in a binary context, and it doesn't feel like I've taken full advantage of the mathematical structure of the problem. So, on further reflection, I realise that the way that ID is defined is essentially turning a binary number into a decimal, where we get the binary number as a string by replacing "B" and "R" by "1" and L" and "F" by "0". Then, I just found, there is a base R function <span class="in">`strtoi()`</span> that takes a string of digits in a given base and converts it to a base 10 integer, just what we need:</span>
<span id="cb81-357"><a href="#cb81-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-360"><a href="#cb81-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-361"><a href="#cb81-361" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="ot">&lt;-</span> boarding <span class="sc">%&gt;%</span></span>
<span id="cb81-362"><a href="#cb81-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">binary =</span> <span class="fu">str_replace_all</span>(binary, <span class="st">"L|F"</span>, <span class="st">"0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-363"><a href="#cb81-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">binary =</span> <span class="fu">str_replace_all</span>(binary, <span class="st">"B|R"</span>, <span class="st">"1"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-364"><a href="#cb81-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">strtoi</span>(binary, <span class="at">base =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-365"><a href="#cb81-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(ID))</span>
<span id="cb81-366"><a href="#cb81-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-367"><a href="#cb81-367" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="sc">%&gt;%</span></span>
<span id="cb81-368"><a href="#cb81-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-369"><a href="#cb81-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(ID)</span>
<span id="cb81-370"><a href="#cb81-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-371"><a href="#cb81-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-372"><a href="#cb81-372" aria-hidden="true" tabindex="-1"></a>That's better!</span>
<span id="cb81-373"><a href="#cb81-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-374"><a href="#cb81-374" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Finding my seat ID</span></span>
<span id="cb81-375"><a href="#cb81-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-376"><a href="#cb81-376" aria-hidden="true" tabindex="-1"></a>We need to find the missing number, so we arrange the IDs in ascending order and look at the gap between each ID and the preceding one. In most cases, that should be one. Where we have a gap of 2, we must have skipped the integer below:</span>
<span id="cb81-377"><a href="#cb81-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-380"><a href="#cb81-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-381"><a href="#cb81-381" aria-hidden="true" tabindex="-1"></a>seat_IDs <span class="sc">%&gt;%</span></span>
<span id="cb81-382"><a href="#cb81-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb81-383"><a href="#cb81-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">lag</span>(ID)) <span class="sc">%&gt;%</span></span>
<span id="cb81-384"><a href="#cb81-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gap =</span> ID <span class="sc">-</span> diff) <span class="sc">%&gt;%</span> </span>
<span id="cb81-385"><a href="#cb81-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gap <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-386"><a href="#cb81-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">my_seat =</span> ID <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-387"><a href="#cb81-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(my_seat)</span>
<span id="cb81-388"><a href="#cb81-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-389"><a href="#cb81-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-390"><a href="#cb81-390" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 6: [Custom Customs](https://adventofcode.com/2020/day/6)</span></span>
<span id="cb81-391"><a href="#cb81-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-392"><a href="#cb81-392" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 6 data</span><span class="co">](data/AoC_day6.txt)</span></span>
<span id="cb81-393"><a href="#cb81-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-394"><a href="#cb81-394" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Anyone answers</span></span>
<span id="cb81-395"><a href="#cb81-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-396"><a href="#cb81-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-397"><a href="#cb81-397" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-398"><a href="#cb81-398" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb81-399"><a href="#cb81-399" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb81-400"><a href="#cb81-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-401"><a href="#cb81-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-402"><a href="#cb81-402" aria-hidden="true" tabindex="-1"></a>Within each group, we need to find the number of unique letters within each group. We read in and separate the data using the tricks learnt for <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">"#day4"</span><span class="kw">&gt;</span>Day 4<span class="kw">&lt;/a&gt;</span>, and take advantage of the <span class="in">`rowwise()`</span> feature in <span class="in">`dplyr 1.0.0`</span>. </span>
<span id="cb81-403"><a href="#cb81-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-404"><a href="#cb81-404" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-405"><a href="#cb81-405" aria-hidden="true" tabindex="-1"></a>customs_groups <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"data/AoC_day6.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-406"><a href="#cb81-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-407"><a href="#cb81-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_group =</span> value <span class="sc">==</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-408"><a href="#cb81-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group_ID =</span> <span class="fu">cumsum</span>(new_group) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-409"><a href="#cb81-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>new_group) <span class="sc">%&gt;%</span></span>
<span id="cb81-410"><a href="#cb81-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>new_group) <span class="sc">%&gt;%</span></span>
<span id="cb81-411"><a href="#cb81-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_ID) </span>
<span id="cb81-412"><a href="#cb81-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-413"><a href="#cb81-413" aria-hidden="true" tabindex="-1"></a>customs_groups <span class="sc">%&gt;%</span></span>
<span id="cb81-414"><a href="#cb81-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">qs =</span> <span class="fu">str_c</span>(value, <span class="at">collapse =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-415"><a href="#cb81-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-416"><a href="#cb81-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qss =</span> <span class="fu">str_split</span>(qs, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-417"><a href="#cb81-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-418"><a href="#cb81-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qsu =</span> <span class="fu">list</span>(<span class="fu">unique</span>(qss))) <span class="sc">%&gt;%</span></span>
<span id="cb81-419"><a href="#cb81-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">count =</span> <span class="fu">length</span>(qsu)) <span class="sc">%&gt;%</span></span>
<span id="cb81-420"><a href="#cb81-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-421"><a href="#cb81-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb81-422"><a href="#cb81-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total)</span>
<span id="cb81-423"><a href="#cb81-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-424"><a href="#cb81-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-425"><a href="#cb81-425" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Everyone answers</span></span>
<span id="cb81-426"><a href="#cb81-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-427"><a href="#cb81-427" aria-hidden="true" tabindex="-1"></a>Now, instead of unique letters in a group, we need to find the number of letters which appear in all the answers for everyone in the same group. I first note how many people are in each group, then tabulate the number of occurrences of each letter in the group, then count (by summing a logical vector) the number of matches between occurrences of letter and the number in group. Finally, we sum across all groups.</span>
<span id="cb81-428"><a href="#cb81-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-429"><a href="#cb81-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-430"><a href="#cb81-430" aria-hidden="true" tabindex="-1"></a>customs_groups <span class="sc">%&gt;%</span>  </span>
<span id="cb81-431"><a href="#cb81-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(group_ID, <span class="at">name =</span> <span class="st">"num_in_group"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-432"><a href="#cb81-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group_ID, num_in_group) <span class="sc">%&gt;%</span></span>
<span id="cb81-433"><a href="#cb81-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">qs =</span> <span class="fu">str_c</span>(value, <span class="at">collapse =</span> <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-434"><a href="#cb81-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-435"><a href="#cb81-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">qss =</span> <span class="fu">str_split</span>(qs, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-436"><a href="#cb81-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-437"><a href="#cb81-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">letter_table =</span> <span class="fu">list</span>(<span class="fu">table</span>(qss))) <span class="sc">%&gt;%</span></span>
<span id="cb81-438"><a href="#cb81-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-439"><a href="#cb81-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">in_common =</span> <span class="fu">sum</span>(num_in_group <span class="sc">==</span> letter_table)) <span class="sc">%&gt;%</span></span>
<span id="cb81-440"><a href="#cb81-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-441"><a href="#cb81-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">sum</span>(in_common)) <span class="sc">%&gt;%</span></span>
<span id="cb81-442"><a href="#cb81-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total)</span>
<span id="cb81-443"><a href="#cb81-443" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-444"><a href="#cb81-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-445"><a href="#cb81-445" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 7: [Handy Haverstocks](https://adventofcode.com/2020/day/7)</span></span>
<span id="cb81-446"><a href="#cb81-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-447"><a href="#cb81-447" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 7 data</span><span class="co">](data/AoC_day7.txt)</span></span>
<span id="cb81-448"><a href="#cb81-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-449"><a href="#cb81-449" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Number of colour bags</span></span>
<span id="cb81-450"><a href="#cb81-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-451"><a href="#cb81-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-452"><a href="#cb81-452" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb81-453"><a href="#cb81-453" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-454"><a href="#cb81-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-455"><a href="#cb81-455" aria-hidden="true" tabindex="-1"></a>We have colour-coded bags that must contain a specific number of other colour-coded bags.</span>
<span id="cb81-456"><a href="#cb81-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-457"><a href="#cb81-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-458"><a href="#cb81-458" aria-hidden="true" tabindex="-1"></a>bags <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"data/AoC_day7.txt"</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb81-459"><a href="#cb81-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-460"><a href="#cb81-460" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bags)</span>
<span id="cb81-461"><a href="#cb81-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-462"><a href="#cb81-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-463"><a href="#cb81-463" aria-hidden="true" tabindex="-1"></a>Our first task is to parse the natural language and split the rules into one container/contains pair per line:</span>
<span id="cb81-464"><a href="#cb81-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-467"><a href="#cb81-467" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-468"><a href="#cb81-468" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> bags <span class="sc">%&gt;%</span></span>
<span id="cb81-469"><a href="#cb81-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rule =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb81-470"><a href="#cb81-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(X1, <span class="fu">c</span>(<span class="st">"container"</span>, <span class="st">"contains"</span>), <span class="at">sep =</span> <span class="st">" bags contain "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-471"><a href="#cb81-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(contains, <span class="at">sep =</span> <span class="st">","</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-472"><a href="#cb81-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contains =</span> <span class="fu">str_remove</span>(contains, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-473"><a href="#cb81-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contains =</span> <span class="fu">str_remove</span>(contains, <span class="st">"bags|bag"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-474"><a href="#cb81-474" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(contains = str_replace(contains, "no other", "0 other")) %&gt;%</span></span>
<span id="cb81-475"><a href="#cb81-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract</span>(contains, <span class="fu">c</span>(<span class="st">'number'</span>, <span class="st">'contains'</span>), <span class="st">"(</span><span class="sc">\\</span><span class="st">d+) (.+)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-476"><a href="#cb81-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(number)) <span class="sc">%&gt;%</span></span>
<span id="cb81-477"><a href="#cb81-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contains =</span> <span class="fu">str_trim</span>(contains)) <span class="sc">%&gt;%</span></span>
<span id="cb81-478"><a href="#cb81-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">number =</span> <span class="fu">as.integer</span>(number)) </span>
<span id="cb81-479"><a href="#cb81-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-480"><a href="#cb81-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-481"><a href="#cb81-481" aria-hidden="true" tabindex="-1"></a>To find all bags that con eventually contain our <span class="in">`shiny gold`</span> bag, we first find the bags that can contain it directly. We then find the bags that can contain those bags and take the union of the two levels. We repeat, stopping when going up a level adds no further bags to the vector of bag colours already found. We then subtract 1, because we don't want to count the original shiny gold bag.</span>
<span id="cb81-482"><a href="#cb81-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-485"><a href="#cb81-485" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-486"><a href="#cb81-486" aria-hidden="true" tabindex="-1"></a><span class="co"># function to find all colours that contain a vector of other colours:</span></span>
<span id="cb81-487"><a href="#cb81-487" aria-hidden="true" tabindex="-1"></a>contains_colours <span class="ot">&lt;-</span> <span class="cf">function</span>(colours) {</span>
<span id="cb81-488"><a href="#cb81-488" aria-hidden="true" tabindex="-1"></a>  rules <span class="sc">%&gt;%</span></span>
<span id="cb81-489"><a href="#cb81-489" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(contains <span class="sc">%in%</span> colours) <span class="sc">%&gt;%</span></span>
<span id="cb81-490"><a href="#cb81-490" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(container) <span class="sc">%&gt;%</span></span>
<span id="cb81-491"><a href="#cb81-491" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(container)</span>
<span id="cb81-492"><a href="#cb81-492" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-493"><a href="#cb81-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-494"><a href="#cb81-494" aria-hidden="true" tabindex="-1"></a>bags <span class="ot">&lt;-</span> <span class="st">"shiny gold"</span></span>
<span id="cb81-495"><a href="#cb81-495" aria-hidden="true" tabindex="-1"></a>old_length <span class="ot">&lt;-</span> <span class="fu">length</span>(bags)</span>
<span id="cb81-496"><a href="#cb81-496" aria-hidden="true" tabindex="-1"></a>new_length <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-497"><a href="#cb81-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-498"><a href="#cb81-498" aria-hidden="true" tabindex="-1"></a><span class="co"># keeping adding to the vector of bags, until no change</span></span>
<span id="cb81-499"><a href="#cb81-499" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span>(old_length <span class="sc">!=</span> new_length) {</span>
<span id="cb81-500"><a href="#cb81-500" aria-hidden="true" tabindex="-1"></a>  old_length <span class="ot">=</span> <span class="fu">length</span>(bags)</span>
<span id="cb81-501"><a href="#cb81-501" aria-hidden="true" tabindex="-1"></a>  bags <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">union</span>(bags, <span class="fu">contains_colours</span>(bags)) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb81-502"><a href="#cb81-502" aria-hidden="true" tabindex="-1"></a>  new_length <span class="ot">&lt;-</span> <span class="fu">length</span>(bags)</span>
<span id="cb81-503"><a href="#cb81-503" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat(old_length, ", ", new_length, "\n")</span></span>
<span id="cb81-504"><a href="#cb81-504" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-505"><a href="#cb81-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-506"><a href="#cb81-506" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bags) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb81-507"><a href="#cb81-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-508"><a href="#cb81-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-509"><a href="#cb81-509" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Number of bags</span></span>
<span id="cb81-510"><a href="#cb81-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-511"><a href="#cb81-511" aria-hidden="true" tabindex="-1"></a>Now we need to discover the number of bags that a shiny gold bag must contain. I figured that lends itself to recursion, but struggled on the details. Hat tip to David Robinson for <span class="co">[</span><span class="ot">this solution</span><span class="co">](https://twitter.com/drob/status/1336003816395845632)</span>. I've learnt a lot for myself by unpicking how it works.</span>
<span id="cb81-512"><a href="#cb81-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-515"><a href="#cb81-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-516"><a href="#cb81-516" aria-hidden="true" tabindex="-1"></a>count_all_contained <span class="ot">&lt;-</span> <span class="cf">function</span>(colour) {</span>
<span id="cb81-517"><a href="#cb81-517" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-518"><a href="#cb81-518" aria-hidden="true" tabindex="-1"></a>  relevant_rules <span class="ot">&lt;-</span> rules <span class="sc">%&gt;%</span></span>
<span id="cb81-519"><a href="#cb81-519" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(container <span class="sc">%in%</span> colour)</span>
<span id="cb81-520"><a href="#cb81-520" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-521"><a href="#cb81-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(relevant_rules<span class="sc">$</span>number <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">map_dbl</span>(relevant_rules<span class="sc">$</span>contains, count_all_contained)))</span>
<span id="cb81-522"><a href="#cb81-522" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-523"><a href="#cb81-523" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-524"><a href="#cb81-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-525"><a href="#cb81-525" aria-hidden="true" tabindex="-1"></a><span class="fu">count_all_contained</span>(<span class="st">"shiny gold"</span>)</span>
<span id="cb81-526"><a href="#cb81-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-527"><a href="#cb81-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-528"><a href="#cb81-528" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 8: [Handheld Halting](https://adventofcode.com/2020/day/8)</span></span>
<span id="cb81-529"><a href="#cb81-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-530"><a href="#cb81-530" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 8 data</span><span class="co">](data/AoC_day8.txt)</span></span>
<span id="cb81-531"><a href="#cb81-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-532"><a href="#cb81-532" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Infinite Loop</span></span>
<span id="cb81-533"><a href="#cb81-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-534"><a href="#cb81-534" aria-hidden="true" tabindex="-1"></a>Our programme gets stuck in an infinite loop. As well as keeping track of the accumulator, we need to keep track of where we've visited, and stop when we visit the same instruction twice. We use a <span class="in">`data.frame()`</span> rather than a <span class="in">`tibble()`</span> as the former is easier to index into.</span>
<span id="cb81-535"><a href="#cb81-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-536"><a href="#cb81-536" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message = FALSE}</span></span>
<span id="cb81-537"><a href="#cb81-537" aria-hidden="true" tabindex="-1"></a>instructions <span class="ot">&lt;-</span> </span>
<span id="cb81-538"><a href="#cb81-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.table</span>(<span class="st">"data/AoC_day8.txt"</span>, <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"instruction"</span>, <span class="st">"value"</span>))</span>
<span id="cb81-539"><a href="#cb81-539" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-540"><a href="#cb81-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-541"><a href="#cb81-541" aria-hidden="true" tabindex="-1"></a>We start with a pretty straight-forward loop, noting that at most it can run for one more than the number of instructions in the programme until it hits an instruction it's already visited. We update row number to visit next and the accumulator as appropriate.</span>
<span id="cb81-542"><a href="#cb81-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-545"><a href="#cb81-545" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-546"><a href="#cb81-546" aria-hidden="true" tabindex="-1"></a>instructions<span class="sc">$</span>visited <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-547"><a href="#cb81-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-548"><a href="#cb81-548" aria-hidden="true" tabindex="-1"></a>row <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb81-549"><a href="#cb81-549" aria-hidden="true" tabindex="-1"></a>accumulator <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-550"><a href="#cb81-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-551"><a href="#cb81-551" aria-hidden="true" tabindex="-1"></a>num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(instructions)</span>
<span id="cb81-552"><a href="#cb81-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-553"><a href="#cb81-553" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(num_rows<span class="sc">+</span><span class="dv">1</span>)) {</span>
<span id="cb81-554"><a href="#cb81-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-555"><a href="#cb81-555" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (instructions[row, <span class="st">"visited"</span>] <span class="sc">!=</span> <span class="dv">0</span>) <span class="cf">break</span></span>
<span id="cb81-556"><a href="#cb81-556" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-557"><a href="#cb81-557" aria-hidden="true" tabindex="-1"></a>  <span class="co"># +1 on number of times the row is visited</span></span>
<span id="cb81-558"><a href="#cb81-558" aria-hidden="true" tabindex="-1"></a>  instructions[row, <span class="st">"visited"</span>] <span class="ot">&lt;-</span> instructions[row, <span class="st">"visited"</span>] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-559"><a href="#cb81-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-560"><a href="#cb81-560" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case when the instruction is "acc"</span></span>
<span id="cb81-561"><a href="#cb81-561" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"acc"</span>) {</span>
<span id="cb81-562"><a href="#cb81-562" aria-hidden="true" tabindex="-1"></a>    accumulator <span class="ot">&lt;-</span> accumulator <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb81-563"><a href="#cb81-563" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-564"><a href="#cb81-564" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-565"><a href="#cb81-565" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-566"><a href="#cb81-566" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case when the instruction is "jmp"</span></span>
<span id="cb81-567"><a href="#cb81-567" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"jmp"</span>) {</span>
<span id="cb81-568"><a href="#cb81-568" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> row <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb81-569"><a href="#cb81-569" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-570"><a href="#cb81-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-571"><a href="#cb81-571" aria-hidden="true" tabindex="-1"></a>  <span class="co"># case when the instruction is "nop"</span></span>
<span id="cb81-572"><a href="#cb81-572" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"nop"</span>) {</span>
<span id="cb81-573"><a href="#cb81-573" aria-hidden="true" tabindex="-1"></a>    row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-574"><a href="#cb81-574" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-575"><a href="#cb81-575" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-576"><a href="#cb81-576" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-577"><a href="#cb81-577" aria-hidden="true" tabindex="-1"></a>accumulator</span>
<span id="cb81-578"><a href="#cb81-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-579"><a href="#cb81-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-580"><a href="#cb81-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-581"><a href="#cb81-581" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Fixing the programme</span></span>
<span id="cb81-582"><a href="#cb81-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-583"><a href="#cb81-583" aria-hidden="true" tabindex="-1"></a>To break the loop, one of the <span class="in">`nop`</span> instructions in the programme should be a <span class="in">`jmp`</span> or vice versa. The plan is to swap these out one by one and check if the programme completes. It's not a sophisticated approach, but it works fast enough (about a second).</span>
<span id="cb81-584"><a href="#cb81-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-585"><a href="#cb81-585" aria-hidden="true" tabindex="-1"></a>First we note that the broken instruction must be one that we visited in Part 1. Also, an instruction of <span class="in">`jmp`</span> with a value of 0 will get us stuck in a one-line infinite loop, so we avoid that.</span>
<span id="cb81-586"><a href="#cb81-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-587"><a href="#cb81-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-588"><a href="#cb81-588" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-589"><a href="#cb81-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-590"><a href="#cb81-590" aria-hidden="true" tabindex="-1"></a>rows_to_check <span class="ot">&lt;-</span> instructions <span class="sc">%&gt;%</span></span>
<span id="cb81-591"><a href="#cb81-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb81-592"><a href="#cb81-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(visited <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-593"><a href="#cb81-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(instruction <span class="sc">!=</span> <span class="st">"acc"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-594"><a href="#cb81-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(instruction <span class="sc">==</span> <span class="st">"nop"</span> <span class="sc">&amp;</span> value <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-595"><a href="#cb81-595" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(row_id)</span>
<span id="cb81-596"><a href="#cb81-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-597"><a href="#cb81-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-598"><a href="#cb81-598" aria-hidden="true" tabindex="-1"></a>We have <span class="in">`r length(rows_to_check)`</span> instruction to check. We modify our code from Part 1 slightly, converting it into a function and returning a list with values <span class="in">`completes`</span> and <span class="in">`accumulator`</span>. <span class="in">`completes`</span> is <span class="in">`FALSE`</span> as soon as we visit a row twice and <span class="in">`TRUE`</span> if the number of our next row to visit is greater than the number of rows in the programme.</span>
<span id="cb81-599"><a href="#cb81-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-602"><a href="#cb81-602" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-603"><a href="#cb81-603" aria-hidden="true" tabindex="-1"></a>programme_completes <span class="ot">&lt;-</span> <span class="cf">function</span>(instructions) {</span>
<span id="cb81-604"><a href="#cb81-604" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-605"><a href="#cb81-605" aria-hidden="true" tabindex="-1"></a>  row <span class="ot">&lt;-</span> 1L</span>
<span id="cb81-606"><a href="#cb81-606" aria-hidden="true" tabindex="-1"></a>  accumulator <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-607"><a href="#cb81-607" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-608"><a href="#cb81-608" aria-hidden="true" tabindex="-1"></a>  num_rows <span class="ot">&lt;-</span> <span class="fu">nrow</span>(instructions)</span>
<span id="cb81-609"><a href="#cb81-609" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-610"><a href="#cb81-610" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(num_rows<span class="sc">+</span><span class="dv">1</span>)) {</span>
<span id="cb81-611"><a href="#cb81-611" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-612"><a href="#cb81-612" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (instructions[row, <span class="st">"visited"</span>] <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb81-613"><a href="#cb81-613" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">completes =</span> <span class="cn">FALSE</span>, <span class="at">accumulator =</span> accumulator)) </span>
<span id="cb81-614"><a href="#cb81-614" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-615"><a href="#cb81-615" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-616"><a href="#cb81-616" aria-hidden="true" tabindex="-1"></a>    <span class="co"># +1 on number of times the row is visited</span></span>
<span id="cb81-617"><a href="#cb81-617" aria-hidden="true" tabindex="-1"></a>    instructions[row, <span class="st">"visited"</span>] <span class="ot">&lt;-</span> instructions[row, <span class="st">"visited"</span>] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-618"><a href="#cb81-618" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-619"><a href="#cb81-619" aria-hidden="true" tabindex="-1"></a>    <span class="co"># case when the instruction is "acc"</span></span>
<span id="cb81-620"><a href="#cb81-620" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"acc"</span>) {</span>
<span id="cb81-621"><a href="#cb81-621" aria-hidden="true" tabindex="-1"></a>      accumulator <span class="ot">&lt;-</span> accumulator <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb81-622"><a href="#cb81-622" aria-hidden="true" tabindex="-1"></a>      row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-623"><a href="#cb81-623" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-624"><a href="#cb81-624" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-625"><a href="#cb81-625" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"jmp"</span>) {</span>
<span id="cb81-626"><a href="#cb81-626" aria-hidden="true" tabindex="-1"></a>      row <span class="ot">&lt;-</span> row <span class="sc">+</span> instructions[row, <span class="st">"value"</span>]</span>
<span id="cb81-627"><a href="#cb81-627" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-628"><a href="#cb81-628" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-629"><a href="#cb81-629" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (instructions[row, <span class="st">"instruction"</span>] <span class="sc">==</span> <span class="st">"nop"</span>) {</span>
<span id="cb81-630"><a href="#cb81-630" aria-hidden="true" tabindex="-1"></a>      row <span class="ot">&lt;-</span> row <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-631"><a href="#cb81-631" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-632"><a href="#cb81-632" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-633"><a href="#cb81-633" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (row <span class="sc">&gt;</span> num_rows) {</span>
<span id="cb81-634"><a href="#cb81-634" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">completes =</span> <span class="cn">TRUE</span>, <span class="at">accumulator =</span> accumulator)) </span>
<span id="cb81-635"><a href="#cb81-635" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-636"><a href="#cb81-636" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-637"><a href="#cb81-637" aria-hidden="true" tabindex="-1"></a>}  </span>
<span id="cb81-638"><a href="#cb81-638" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-639"><a href="#cb81-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-640"><a href="#cb81-640" aria-hidden="true" tabindex="-1"></a>We now loop over the rows we've identified to check, breaking the loop as soon as we find a programme that completes. Finally, we extract the accumulator value from the successful programme.</span>
<span id="cb81-641"><a href="#cb81-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-644"><a href="#cb81-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-645"><a href="#cb81-645" aria-hidden="true" tabindex="-1"></a>instructions<span class="sc">$</span>visited <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-646"><a href="#cb81-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-647"><a href="#cb81-647" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (row <span class="cf">in</span> rows_to_check) {</span>
<span id="cb81-648"><a href="#cb81-648" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-649"><a href="#cb81-649" aria-hidden="true" tabindex="-1"></a>  <span class="co"># modify one row of the instructions,</span></span>
<span id="cb81-650"><a href="#cb81-650" aria-hidden="true" tabindex="-1"></a>  <span class="co"># copying data frame so we don't have to modify it back</span></span>
<span id="cb81-651"><a href="#cb81-651" aria-hidden="true" tabindex="-1"></a>  modified_instructions <span class="ot">&lt;-</span> instructions</span>
<span id="cb81-652"><a href="#cb81-652" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-653"><a href="#cb81-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(instructions[row, <span class="dv">1</span>] <span class="sc">==</span> <span class="st">"jmp"</span>, </span>
<span id="cb81-654"><a href="#cb81-654" aria-hidden="true" tabindex="-1"></a>         modified_instructions[row, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"nop"</span>, </span>
<span id="cb81-655"><a href="#cb81-655" aria-hidden="true" tabindex="-1"></a>         modified_instructions[row, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"jmp"</span>) </span>
<span id="cb81-656"><a href="#cb81-656" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-657"><a href="#cb81-657" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if the modified programme completes</span></span>
<span id="cb81-658"><a href="#cb81-658" aria-hidden="true" tabindex="-1"></a>  check_programme <span class="ot">&lt;-</span> <span class="fu">programme_completes</span>(modified_instructions)</span>
<span id="cb81-659"><a href="#cb81-659" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-660"><a href="#cb81-660" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (check_programme<span class="sc">$</span>completes) </span>
<span id="cb81-661"><a href="#cb81-661" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb81-662"><a href="#cb81-662" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-663"><a href="#cb81-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-664"><a href="#cb81-664" aria-hidden="true" tabindex="-1"></a>check_programme<span class="sc">$</span>accumulator</span>
<span id="cb81-665"><a href="#cb81-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-666"><a href="#cb81-666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-667"><a href="#cb81-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-668"><a href="#cb81-668" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 9: [Encoding Error](https://adventofcode.com/2020/day/9)</span></span>
<span id="cb81-669"><a href="#cb81-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-670"><a href="#cb81-670" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 9 data</span><span class="co">](data/AoC_day9.txt)</span></span>
<span id="cb81-671"><a href="#cb81-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-672"><a href="#cb81-672" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Weak Link</span></span>
<span id="cb81-673"><a href="#cb81-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-674"><a href="#cb81-674" aria-hidden="true" tabindex="-1"></a>We have to find the first number in the list which is *not* the sum of a pair of different numbers in the preceding 25 numbers.</span>
<span id="cb81-675"><a href="#cb81-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-678"><a href="#cb81-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-679"><a href="#cb81-679" aria-hidden="true" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">as.double</span>(<span class="fu">readLines</span>(<span class="st">"data/AoC_day9.txt"</span>)) </span>
<span id="cb81-680"><a href="#cb81-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-681"><a href="#cb81-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-682"><a href="#cb81-682" aria-hidden="true" tabindex="-1"></a>There's a nice trick for finding the pair of numbers in a vector that sum to a target that was doing the rounds on twitter in response to the <span class="kw">&lt;a</span> <span class="er">href</span><span class="ot">=</span><span class="st">"#day1"</span><span class="kw">&gt;</span>Day 1<span class="kw">&lt;/a&gt;</span> challenge: <span class="in">`intersect(input, 2020 - input)`</span>. For this challenge, we expand on that idea, writing it as a <span class="in">`check_sum`</span> function. Where there's more than one pair, it won't say which pair together, and if the number that's half the target appears in the addends, it will only appear once in the output. However, for this challenge, we only need to know when there are *no* pairs that sum to the target, which will be the case when the length of the output of <span class="in">`check_sum`</span> is 0.</span>
<span id="cb81-683"><a href="#cb81-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-686"><a href="#cb81-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-687"><a href="#cb81-687" aria-hidden="true" tabindex="-1"></a>check_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(target, addends) {</span>
<span id="cb81-688"><a href="#cb81-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">intersect</span>(addends, target<span class="sc">-</span>addends)</span>
<span id="cb81-689"><a href="#cb81-689" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-690"><a href="#cb81-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-691"><a href="#cb81-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-692"><a href="#cb81-692" aria-hidden="true" tabindex="-1"></a>Then, it's simply a case of iterating over windows of length 25, checking whether the following number is the sum of a distinct pair in that window, and returning the first one that isn't.</span>
<span id="cb81-693"><a href="#cb81-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-696"><a href="#cb81-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-697"><a href="#cb81-697" aria-hidden="true" tabindex="-1"></a>find_invalid_num <span class="ot">&lt;-</span> <span class="cf">function</span>(vec, <span class="at">win =</span> <span class="dv">25</span>) {</span>
<span id="cb81-698"><a href="#cb81-698" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-699"><a href="#cb81-699" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> (win<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(vec)) {</span>
<span id="cb81-700"><a href="#cb81-700" aria-hidden="true" tabindex="-1"></a>    check <span class="ot">&lt;-</span> <span class="fu">check_sum</span>(vec[i], vec[(i<span class="sc">-</span>win)<span class="sc">:</span>(i<span class="dv">-1</span>)])</span>
<span id="cb81-701"><a href="#cb81-701" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-702"><a href="#cb81-702" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(check) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">return</span>(vec[i])</span>
<span id="cb81-703"><a href="#cb81-703" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-704"><a href="#cb81-704" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-705"><a href="#cb81-705" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-706"><a href="#cb81-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-707"><a href="#cb81-707" aria-hidden="true" tabindex="-1"></a><span class="fu">find_invalid_num</span>(input)</span>
<span id="cb81-708"><a href="#cb81-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-709"><a href="#cb81-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-710"><a href="#cb81-710" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Contiguous set</span></span>
<span id="cb81-711"><a href="#cb81-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-712"><a href="#cb81-712" aria-hidden="true" tabindex="-1"></a>Find a contiguous set in the list that sums to the invalid number from Part 1, and add together the largest and smallest number in that range.</span>
<span id="cb81-713"><a href="#cb81-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-714"><a href="#cb81-714" aria-hidden="true" tabindex="-1"></a>First, we note that after a certain point, all numbers in the input are larger than the target, so we don't need to consider those. We reduce our input vector accordingly.</span>
<span id="cb81-715"><a href="#cb81-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-718"><a href="#cb81-718" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-719"><a href="#cb81-719" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">find_invalid_num</span>(input)</span>
<span id="cb81-720"><a href="#cb81-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-721"><a href="#cb81-721" aria-hidden="true" tabindex="-1"></a>input_reduced <span class="ot">&lt;-</span> input[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">max</span>(<span class="fu">which</span>(input <span class="sc">&lt;=</span> target)))]</span>
<span id="cb81-722"><a href="#cb81-722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-723"><a href="#cb81-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-724"><a href="#cb81-724" aria-hidden="true" tabindex="-1"></a>To find the contiguous set in the list that sums to the target, we make use of <span class="in">`accumulate()`</span> from the <span class="in">`purrr`</span> package. Let the input list be $x = (x_1, x_2,..., x_n)$. Then <span class="in">`accumulate(x, sum)`</span> returns $a = (x_1, x_1 + x_2,..., \sum_{j=1}^n x_j)$. We check whether any element of this vector is equal to the target. If so we index into the input vector appropriately, sum the min and max in the range and we're done. If not, we consider the sums of all windows starting with the second element of the input list, and so on.</span>
<span id="cb81-725"><a href="#cb81-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-728"><a href="#cb81-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-729"><a href="#cb81-729" aria-hidden="true" tabindex="-1"></a>contiguous_sum <span class="ot">&lt;-</span> <span class="cf">function</span>(input, target) {</span>
<span id="cb81-730"><a href="#cb81-730" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-731"><a href="#cb81-731" aria-hidden="true" tabindex="-1"></a>  len <span class="ot">&lt;-</span> <span class="fu">length</span>(input)</span>
<span id="cb81-732"><a href="#cb81-732" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-733"><a href="#cb81-733" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>len) {</span>
<span id="cb81-734"><a href="#cb81-734" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">accumulate</span>(input[i<span class="sc">:</span>len], sum)</span>
<span id="cb81-735"><a href="#cb81-735" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">&lt;-</span> a <span class="sc">==</span> target</span>
<span id="cb81-736"><a href="#cb81-736" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-737"><a href="#cb81-737" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(b) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb81-738"><a href="#cb81-738" aria-hidden="true" tabindex="-1"></a>      output_length <span class="ot">&lt;-</span> <span class="fu">which</span>(b)</span>
<span id="cb81-739"><a href="#cb81-739" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb81-740"><a href="#cb81-740" aria-hidden="true" tabindex="-1"></a>      contiguous_set <span class="ot">&lt;-</span> input[i<span class="sc">:</span>(i <span class="sc">+</span> output_length <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb81-741"><a href="#cb81-741" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb81-742"><a href="#cb81-742" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">range</span>(contiguous_set)))</span>
<span id="cb81-743"><a href="#cb81-743" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb81-744"><a href="#cb81-744" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-745"><a href="#cb81-745" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-746"><a href="#cb81-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-747"><a href="#cb81-747" aria-hidden="true" tabindex="-1"></a><span class="fu">contiguous_sum</span>(input_reduced, target)</span>
<span id="cb81-748"><a href="#cb81-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-749"><a href="#cb81-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-750"><a href="#cb81-750" aria-hidden="true" tabindex="-1"></a>I appreciate that there's some redundant calculation in this method. The vectors of accumulated sums can contain numbers larger than the target (if writing our own loop, we could break as soon as the accumulated sum got too big). Also, in retrospect, we could have only run <span class="in">`accumulate`</span> once, then in the second iteration of the loop, subtracted <span class="in">`input[1]`</span> from the result, in the third iteration subtracted <span class="in">`input[2]`</span> from that result, etc. However, the function as written is concise and easy to understand, and gets our answer in around a second, so that will do!</span>
<span id="cb81-751"><a href="#cb81-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-752"><a href="#cb81-752" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 10: [Adapter Array](https://adventofcode.com/2020/day/10)</span></span>
<span id="cb81-753"><a href="#cb81-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-754"><a href="#cb81-754" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 10 data</span><span class="co">](data/AoC_day10.txt)</span></span>
<span id="cb81-755"><a href="#cb81-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-756"><a href="#cb81-756" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Adapter Distribution</span></span>
<span id="cb81-757"><a href="#cb81-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-758"><a href="#cb81-758" aria-hidden="true" tabindex="-1"></a>This is simply a case of ordering the adapters, prepending 0 and appending the the max in the list plus three, then finding the differences.</span>
<span id="cb81-759"><a href="#cb81-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-760"><a href="#cb81-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-761"><a href="#cb81-761" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-762"><a href="#cb81-762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-763"><a href="#cb81-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-764"><a href="#cb81-764" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-765"><a href="#cb81-765" aria-hidden="true" tabindex="-1"></a>adapters <span class="ot">&lt;-</span> </span>
<span id="cb81-766"><a href="#cb81-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">readLines</span>(<span class="st">"data/AoC_day10.txt"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-767"><a href="#cb81-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb81-768"><a href="#cb81-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-769"><a href="#cb81-769" aria-hidden="true" tabindex="-1"></a>adapter_diffs <span class="ot">&lt;-</span> <span class="fu">c</span>(adapters, <span class="dv">0</span>, <span class="fu">max</span>(adapters) <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-770"><a href="#cb81-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-771"><a href="#cb81-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diff</span>()</span>
<span id="cb81-772"><a href="#cb81-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-773"><a href="#cb81-773" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(adapter_diffs <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">sum</span>(adapter_diffs <span class="sc">==</span> <span class="dv">3</span>)</span>
<span id="cb81-774"><a href="#cb81-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-775"><a href="#cb81-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-776"><a href="#cb81-776" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Adapter combinations</span></span>
<span id="cb81-777"><a href="#cb81-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-778"><a href="#cb81-778" aria-hidden="true" tabindex="-1"></a>Instead of building up sequences of adapters, we see what we can remove from the full list. </span>
<span id="cb81-779"><a href="#cb81-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-780"><a href="#cb81-780" aria-hidden="true" tabindex="-1"></a>First, we check the diffs: are they just 1 and 3 or are there any 2s?</span>
<span id="cb81-781"><a href="#cb81-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-784"><a href="#cb81-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-785"><a href="#cb81-785" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(adapter_diffs)</span>
<span id="cb81-786"><a href="#cb81-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-787"><a href="#cb81-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-788"><a href="#cb81-788" aria-hidden="true" tabindex="-1"></a>We can't remove an adapter if its difference with the previous adapter is 3, otherwise the difference between the adapters on either side of it will be too big.</span>
<span id="cb81-789"><a href="#cb81-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-790"><a href="#cb81-790" aria-hidden="true" tabindex="-1"></a>What about diffs of 1? It depends how many ones there are around it. We can check this using the <span class="in">`rle()`</span> (run length encoding) function</span>
<span id="cb81-791"><a href="#cb81-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-794"><a href="#cb81-794" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-795"><a href="#cb81-795" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">rle</span>(adapter_diffs)</span>
<span id="cb81-796"><a href="#cb81-796" aria-hidden="true" tabindex="-1"></a>runs</span>
<span id="cb81-797"><a href="#cb81-797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-798"><a href="#cb81-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-799"><a href="#cb81-799" aria-hidden="true" tabindex="-1"></a>What is the distribution of lengths of sequences of 1s?</span>
<span id="cb81-800"><a href="#cb81-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-803"><a href="#cb81-803" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-804"><a href="#cb81-804" aria-hidden="true" tabindex="-1"></a>runs_table <span class="ot">&lt;-</span> <span class="fu">table</span>(runs<span class="sc">$</span>lengths) </span>
<span id="cb81-805"><a href="#cb81-805" aria-hidden="true" tabindex="-1"></a>runs_table</span>
<span id="cb81-806"><a href="#cb81-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-807"><a href="#cb81-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-808"><a href="#cb81-808" aria-hidden="true" tabindex="-1"></a>We have at most four diffs of 1 in a row.</span>
<span id="cb81-809"><a href="#cb81-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-810"><a href="#cb81-810" aria-hidden="true" tabindex="-1"></a>We need to check that if we remove an adapter, the new differences do not exceed 3. Example sequences really helped me figure out what's going on here:</span>
<span id="cb81-811"><a href="#cb81-811" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-812"><a href="#cb81-812" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the diff sequence is ..., 3, 1, 3,... (e.g. adapters 1, 4, 5, 8)</span>
<span id="cb81-813"><a href="#cb81-813" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>1 option to keep as is</span>
<span id="cb81-814"><a href="#cb81-814" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>We cannot remove any adapters</span>
<span id="cb81-815"><a href="#cb81-815" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**1 option in total**</span>
<span id="cb81-816"><a href="#cb81-816" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the diff sequence is ..., 3, 1, 1, 3,... (e.g. adapters 1, 4, 5, 6, 9)</span>
<span id="cb81-817"><a href="#cb81-817" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>1 option to keep as is</span>
<span id="cb81-818"><a href="#cb81-818" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>1 option to remove one adapter (e.g. the 5)</span>
<span id="cb81-819"><a href="#cb81-819" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>we cannot remove two adapters</span>
<span id="cb81-820"><a href="#cb81-820" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**2 options total**</span>
<span id="cb81-821"><a href="#cb81-821" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the diff sequence is ..., 3, 1, 1, 1, 3,... (e.g. adapters 1, 4, 5, 6, 7, 10)</span>
<span id="cb81-822"><a href="#cb81-822" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>1 option to keep as is</span>
<span id="cb81-823"><a href="#cb81-823" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>2 options to remove one adapter (e.g. the 5 or 6)</span>
<span id="cb81-824"><a href="#cb81-824" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>1 options to remove two adapters (e.g. the 5 and 6)</span>
<span id="cb81-825"><a href="#cb81-825" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>We cannot remove three adapters </span>
<span id="cb81-826"><a href="#cb81-826" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**4 options total**</span>
<span id="cb81-827"><a href="#cb81-827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If the diff sequence is ..., 3, 1, 1, 1, 1, 3,... (e.g. adapters 1, 4, 5, 6, 7, 8, 11)</span>
<span id="cb81-828"><a href="#cb81-828" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>1 option to keep as is</span>
<span id="cb81-829"><a href="#cb81-829" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>3 options to remove one adapter (e.g. 5, 6, or 7) </span>
<span id="cb81-830"><a href="#cb81-830" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>3 options to remove two adapters (e.g. any two of 5, 6, and 7) </span>
<span id="cb81-831"><a href="#cb81-831" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>We cannot remove three adapters</span>
<span id="cb81-832"><a href="#cb81-832" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>**7 options total**</span>
<span id="cb81-833"><a href="#cb81-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-834"><a href="#cb81-834" aria-hidden="true" tabindex="-1"></a>Finally, we multiply each run length of difference of 1s with the number of options we have for removing adapters, then take the product of those products.</span>
<span id="cb81-835"><a href="#cb81-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-838"><a href="#cb81-838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-839"><a href="#cb81-839" aria-hidden="true" tabindex="-1"></a>runs_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lengths =</span> runs<span class="sc">$</span>lengths, <span class="at">values =</span> runs<span class="sc">$</span>values)</span>
<span id="cb81-840"><a href="#cb81-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-841"><a href="#cb81-841" aria-hidden="true" tabindex="-1"></a>options <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lengths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="at">options =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>))</span>
<span id="cb81-842"><a href="#cb81-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-843"><a href="#cb81-843" aria-hidden="true" tabindex="-1"></a>runs_df <span class="sc">%&gt;%</span></span>
<span id="cb81-844"><a href="#cb81-844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(values <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-845"><a href="#cb81-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(options, <span class="at">by =</span> <span class="st">"lengths"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-846"><a href="#cb81-846" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prod_options =</span> <span class="fu">prod</span>(options)) <span class="sc">%&gt;%</span></span>
<span id="cb81-847"><a href="#cb81-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(prod_options) <span class="sc">%&gt;%</span></span>
<span id="cb81-848"><a href="#cb81-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">format</span>(<span class="at">scientific =</span> <span class="cn">FALSE</span>) </span>
<span id="cb81-849"><a href="#cb81-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-850"><a href="#cb81-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-851"><a href="#cb81-851" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day 11: [Seating System](https://adventofcode.com/2020/day/11)</span></span>
<span id="cb81-852"><a href="#cb81-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-853"><a href="#cb81-853" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">My day 11 data</span><span class="co">](data/AoC_day11.txt)</span></span>
<span id="cb81-854"><a href="#cb81-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-855"><a href="#cb81-855" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 1: Changing layout</span></span>
<span id="cb81-856"><a href="#cb81-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-857"><a href="#cb81-857" aria-hidden="true" tabindex="-1"></a>My code for Day 11 runs a little slow (about 10 seconds for Part 1 and 80 seconds for Part 2), so for the sake of being able to rebuild this page quickly as I keep updating it working through the challenges, I will demonstrate this code with the test input provided as an example.</span>
<span id="cb81-858"><a href="#cb81-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-859"><a href="#cb81-859" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message = FALSE}</span></span>
<span id="cb81-860"><a href="#cb81-860" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb81-861"><a href="#cb81-861" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb81-862"><a href="#cb81-862" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb81-863"><a href="#cb81-863" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-864"><a href="#cb81-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-865"><a href="#cb81-865" aria-hidden="true" tabindex="-1"></a>First we read in the data and convert it to a matrix (using the <span class="co">[</span><span class="ot">`datapasta`</span><span class="co">](https://github.com/MilesMcBain/datapasta)</span> package for the test input):</span>
<span id="cb81-866"><a href="#cb81-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-867"><a href="#cb81-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eval = TRUE, message = FALSE}</span></span>
<span id="cb81-868"><a href="#cb81-868" aria-hidden="true" tabindex="-1"></a><span class="co"># layout &lt;- readr::read_tsv("data/AoC_day11.txt", col_names = FALSE)</span></span>
<span id="cb81-869"><a href="#cb81-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-870"><a href="#cb81-870" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb81-871"><a href="#cb81-871" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>X1,</span>
<span id="cb81-872"><a href="#cb81-872" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LL.LL.LL"</span>,</span>
<span id="cb81-873"><a href="#cb81-873" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LLLLLLL.LL"</span>,</span>
<span id="cb81-874"><a href="#cb81-874" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.L.L..L.."</span>,</span>
<span id="cb81-875"><a href="#cb81-875" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LLLL.LL.LL"</span>,</span>
<span id="cb81-876"><a href="#cb81-876" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LL.LL.LL"</span>,</span>
<span id="cb81-877"><a href="#cb81-877" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LLLLL.LL"</span>,</span>
<span id="cb81-878"><a href="#cb81-878" aria-hidden="true" tabindex="-1"></a>  <span class="st">"..L.L....."</span>,</span>
<span id="cb81-879"><a href="#cb81-879" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LLLLLLLLLL"</span>,</span>
<span id="cb81-880"><a href="#cb81-880" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LLLLLL.L"</span>,</span>
<span id="cb81-881"><a href="#cb81-881" aria-hidden="true" tabindex="-1"></a>  <span class="st">"L.LLLLL.LL"</span></span>
<span id="cb81-882"><a href="#cb81-882" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-883"><a href="#cb81-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-884"><a href="#cb81-884" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-885"><a href="#cb81-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-888"><a href="#cb81-888" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-889"><a href="#cb81-889" aria-hidden="true" tabindex="-1"></a><span class="co"># get number of columns for matrix</span></span>
<span id="cb81-890"><a href="#cb81-890" aria-hidden="true" tabindex="-1"></a>num_col <span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span></span>
<span id="cb81-891"><a href="#cb81-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">length =</span> <span class="fu">str_length</span>(X1)) <span class="sc">%&gt;%</span></span>
<span id="cb81-892"><a href="#cb81-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb81-893"><a href="#cb81-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(length)</span>
<span id="cb81-894"><a href="#cb81-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-895"><a href="#cb81-895" aria-hidden="true" tabindex="-1"></a><span class="co"># split layout into characters and turn to vector</span></span>
<span id="cb81-896"><a href="#cb81-896" aria-hidden="true" tabindex="-1"></a>layout_vec <span class="ot">&lt;-</span> layout <span class="sc">%&gt;%</span></span>
<span id="cb81-897"><a href="#cb81-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">X1 =</span> <span class="fu">strsplit</span>(X1, <span class="at">split =</span> <span class="fu">character</span>(<span class="dv">0</span>), <span class="at">fixed =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb81-898"><a href="#cb81-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(X1) <span class="sc">%&gt;%</span></span>
<span id="cb81-899"><a href="#cb81-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb81-900"><a href="#cb81-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-901"><a href="#cb81-901" aria-hidden="true" tabindex="-1"></a><span class="co"># organise into matrix</span></span>
<span id="cb81-902"><a href="#cb81-902" aria-hidden="true" tabindex="-1"></a>initial_layout <span class="ot">&lt;-</span> <span class="fu">matrix</span>(layout_vec, <span class="at">ncol =</span> num_col, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-903"><a href="#cb81-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-904"><a href="#cb81-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-905"><a href="#cb81-905" aria-hidden="true" tabindex="-1"></a>Next, we write a helper function that, given a matrix and row and column indices, returns a vector of the adjacent seats. We need to take care when indexing into the matrix, so we treat all corner and edge cases separately. Fiddly, but gets the job done.</span>
<span id="cb81-906"><a href="#cb81-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-909"><a href="#cb81-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-910"><a href="#cb81-910" aria-hidden="true" tabindex="-1"></a>get_adj <span class="ot">&lt;-</span> <span class="cf">function</span>(mat, i,j) {</span>
<span id="cb81-911"><a href="#cb81-911" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-912"><a href="#cb81-912" aria-hidden="true" tabindex="-1"></a>  nr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mat)</span>
<span id="cb81-913"><a href="#cb81-913" aria-hidden="true" tabindex="-1"></a>  nc <span class="ot">&lt;-</span> <span class="fu">ncol</span>(mat)</span>
<span id="cb81-914"><a href="#cb81-914" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-915"><a href="#cb81-915" aria-hidden="true" tabindex="-1"></a>  <span class="co"># corner cases</span></span>
<span id="cb81-916"><a href="#cb81-916" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="dv">1</span>,<span class="dv">2</span>], mat[<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])}</span>
<span id="cb81-917"><a href="#cb81-917" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> j <span class="sc">==</span> nc) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="dv">1</span>,(nc<span class="dv">-1</span>)], mat[<span class="dv">2</span>,(nc<span class="dv">-1</span>)<span class="sc">:</span>nc])}</span>
<span id="cb81-918"><a href="#cb81-918" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">&amp;</span> j <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[nr,<span class="dv">2</span>], mat[nr<span class="dv">-1</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])}</span>
<span id="cb81-919"><a href="#cb81-919" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">&amp;</span> j <span class="sc">==</span> nc) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[nr<span class="dv">-1</span>, (nc<span class="dv">-1</span>)<span class="sc">:</span>nc], mat[nr, nc<span class="dv">-1</span>])}  </span>
<span id="cb81-920"><a href="#cb81-920" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-921"><a href="#cb81-921" aria-hidden="true" tabindex="-1"></a>  <span class="co"># edge cases</span></span>
<span id="cb81-922"><a href="#cb81-922" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="dv">1</span>, <span class="fu">c</span>(j<span class="dv">-1</span>,j<span class="sc">+</span><span class="dv">1</span>)], mat[<span class="dv">2</span>, (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)])}</span>
<span id="cb81-923"><a href="#cb81-923" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (i <span class="sc">==</span> nr) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[nr, <span class="fu">c</span>(j<span class="dv">-1</span>,j<span class="sc">+</span><span class="dv">1</span>)], mat[nr<span class="dv">-1</span>, (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)])}</span>
<span id="cb81-924"><a href="#cb81-924" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (j <span class="sc">==</span> <span class="dv">1</span>) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="fu">c</span>(i<span class="dv">-1</span>, i<span class="sc">+</span><span class="dv">1</span>), <span class="dv">1</span>], mat[(i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">1</span>), <span class="dv">2</span>])}</span>
<span id="cb81-925"><a href="#cb81-925" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (j <span class="sc">==</span> nc) {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[<span class="fu">c</span>(i<span class="dv">-1</span>, i<span class="sc">+</span><span class="dv">1</span>), nc], mat[(i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">+</span><span class="dv">1</span>), nc<span class="dv">-1</span>])}</span>
<span id="cb81-926"><a href="#cb81-926" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-927"><a href="#cb81-927" aria-hidden="true" tabindex="-1"></a>  <span class="co"># inside cases</span></span>
<span id="cb81-928"><a href="#cb81-928" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {adj <span class="ot">&lt;-</span> <span class="fu">c</span>(mat[i<span class="dv">-1</span>,(j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)], mat[i,<span class="fu">c</span>(j<span class="dv">-1</span>,j<span class="sc">+</span><span class="dv">1</span>)], mat[i<span class="sc">+</span><span class="dv">1</span>,(j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>)])}</span>
<span id="cb81-929"><a href="#cb81-929" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-930"><a href="#cb81-930" aria-hidden="true" tabindex="-1"></a>  adj</span>
<span id="cb81-931"><a href="#cb81-931" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-932"><a href="#cb81-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-933"><a href="#cb81-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-934"><a href="#cb81-934" aria-hidden="true" tabindex="-1"></a>Once we have a vector of surrounding seats, we can apply the rules in the problem to determine whether a given seat needs to change state. The <span class="in">`needs_changing`</span> helper function does that. It's overkill at this point to give options to specify the function for finding the vector of seats to check, and the maximum number of occupied seats people can tolerate around them, but (spolier alert) I put in these options when working on the challenge in Part 2.</span>
<span id="cb81-935"><a href="#cb81-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-938"><a href="#cb81-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-939"><a href="#cb81-939" aria-hidden="true" tabindex="-1"></a>needs_changing <span class="ot">&lt;-</span> </span>
<span id="cb81-940"><a href="#cb81-940" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(mat, i,j, <span class="at">get_surround =</span> get_adj, <span class="at">max_occupied =</span> <span class="dv">4</span>) {</span>
<span id="cb81-941"><a href="#cb81-941" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-942"><a href="#cb81-942" aria-hidden="true" tabindex="-1"></a>  surround <span class="ot">&lt;-</span> <span class="fu">get_surround</span>(mat, i,j)</span>
<span id="cb81-943"><a href="#cb81-943" aria-hidden="true" tabindex="-1"></a>  n_occupied <span class="ot">&lt;-</span> <span class="fu">sum</span>(surround <span class="sc">==</span> <span class="st">"#"</span>)</span>
<span id="cb81-944"><a href="#cb81-944" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-945"><a href="#cb81-945" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((mat[i,j] <span class="sc">==</span> <span class="st">"L"</span>) <span class="sc">&amp;</span> (n_occupied <span class="sc">==</span> <span class="dv">0</span>)) <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb81-946"><a href="#cb81-946" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-947"><a href="#cb81-947" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> ((mat[i,j] <span class="sc">==</span> <span class="st">"#"</span>) <span class="sc">&amp;</span> (n_occupied <span class="sc">&gt;=</span> max_occupied)) {</span>
<span id="cb81-948"><a href="#cb81-948" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb81-949"><a href="#cb81-949" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-950"><a href="#cb81-950" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-951"><a href="#cb81-951" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb81-952"><a href="#cb81-952" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-953"><a href="#cb81-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-954"><a href="#cb81-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-955"><a href="#cb81-955" aria-hidden="true" tabindex="-1"></a>Since floor spaces don't change, we only need to consider seats. We save the indices of the seats into a data frame, so we can vectorise over it using <span class="in">`tidyverse`</span> functions. However, when we've determined the seats that need changing, using our <span class="in">`needs_changing`</span> function, we need to convert those indices from a data.frame into a matrix, in order to index into the layout matrix appropriately and make the changes. </span>
<span id="cb81-956"><a href="#cb81-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-959"><a href="#cb81-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-960"><a href="#cb81-960" aria-hidden="true" tabindex="-1"></a>seats <span class="ot">&lt;-</span> <span class="fu">which</span>(initial_layout <span class="sc">!=</span> <span class="st">"."</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-961"><a href="#cb81-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-962"><a href="#cb81-962" aria-hidden="true" tabindex="-1"></a>seats_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seats) <span class="sc">%&gt;%</span></span>
<span id="cb81-963"><a href="#cb81-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">i =</span> row, </span>
<span id="cb81-964"><a href="#cb81-964" aria-hidden="true" tabindex="-1"></a>         <span class="at">j =</span> col)</span>
<span id="cb81-965"><a href="#cb81-965" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-966"><a href="#cb81-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-967"><a href="#cb81-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-970"><a href="#cb81-970" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-971"><a href="#cb81-971" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> initial_layout</span>
<span id="cb81-972"><a href="#cb81-972" aria-hidden="true" tabindex="-1"></a>iters <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-973"><a href="#cb81-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-974"><a href="#cb81-974" aria-hidden="true" tabindex="-1"></a><span class="co"># loop until there are no further changes</span></span>
<span id="cb81-975"><a href="#cb81-975" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb81-976"><a href="#cb81-976" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-977"><a href="#cb81-977" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-978"><a href="#cb81-978" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-979"><a href="#cb81-979" aria-hidden="true" tabindex="-1"></a>  seats_to_change <span class="ot">&lt;-</span> </span>
<span id="cb81-980"><a href="#cb81-980" aria-hidden="true" tabindex="-1"></a>    seats_df <span class="sc">%&gt;%</span></span>
<span id="cb81-981"><a href="#cb81-981" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-982"><a href="#cb81-982" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">change_seat =</span> <span class="fu">needs_changing</span>(layout,i,j))   </span>
<span id="cb81-983"><a href="#cb81-983" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-984"><a href="#cb81-984" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="fu">sum</span>(seats_to_change<span class="sc">$</span>change_seat)</span>
<span id="cb81-985"><a href="#cb81-985" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-986"><a href="#cb81-986" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (change <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">break</span></span>
<span id="cb81-987"><a href="#cb81-987" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-988"><a href="#cb81-988" aria-hidden="true" tabindex="-1"></a>  indices_to_change <span class="ot">&lt;-</span> </span>
<span id="cb81-989"><a href="#cb81-989" aria-hidden="true" tabindex="-1"></a>    seats_to_change <span class="sc">%&gt;%</span></span>
<span id="cb81-990"><a href="#cb81-990" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(change_seat) <span class="sc">%&gt;%</span></span>
<span id="cb81-991"><a href="#cb81-991" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(i,j) <span class="sc">%&gt;%</span></span>
<span id="cb81-992"><a href="#cb81-992" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()  </span>
<span id="cb81-993"><a href="#cb81-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-994"><a href="#cb81-994" aria-hidden="true" tabindex="-1"></a>  layout[indices_to_change] <span class="ot">&lt;-</span> </span>
<span id="cb81-995"><a href="#cb81-995" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setdiff</span>(<span class="fu">c</span>(<span class="st">"L"</span>, <span class="st">"#"</span>),  layout[indices_to_change])</span>
<span id="cb81-996"><a href="#cb81-996" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-997"><a href="#cb81-997" aria-hidden="true" tabindex="-1"></a>  iters <span class="ot">&lt;-</span> iters <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-998"><a href="#cb81-998" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-999"><a href="#cb81-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1000"><a href="#cb81-1000" aria-hidden="true" tabindex="-1"></a>part_1_iters <span class="ot">&lt;-</span> iters</span>
<span id="cb81-1001"><a href="#cb81-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(layout<span class="sc">==</span> <span class="st">"#"</span>)</span>
<span id="cb81-1002"><a href="#cb81-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1003"><a href="#cb81-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1004"><a href="#cb81-1004" aria-hidden="true" tabindex="-1"></a>On the test set, this takes <span class="in">`r part_1_iters`</span> iterations. On the full data set, my answer is 2316, and it took 107 iterations.</span>
<span id="cb81-1005"><a href="#cb81-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1006"><a href="#cb81-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Part 2: Looking further</span></span>
<span id="cb81-1007"><a href="#cb81-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1008"><a href="#cb81-1008" aria-hidden="true" tabindex="-1"></a>Now, people look to the first seat they can see in each direction, and will change from occupied to unoccupied if five or more of them are occupied.</span>
<span id="cb81-1009"><a href="#cb81-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1010"><a href="#cb81-1010" aria-hidden="true" tabindex="-1"></a>The plan is to write a function that extracts full vectors from a given seat to the edge of the layout matrix in each of the eight directions, then finds the first seat in each of those directions, and finally collects those into a vector of the seats under consideration when determining if a change is needed. Then I can reuse the loop from Part 1, just changing the arguments in the calls to <span class="in">`needs_changing`</span>.</span>
<span id="cb81-1011"><a href="#cb81-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1012"><a href="#cb81-1012" aria-hidden="true" tabindex="-1"></a>Here's a helper function to get the first seat in a vector looking in one direction:</span>
<span id="cb81-1013"><a href="#cb81-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1016"><a href="#cb81-1016" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1017"><a href="#cb81-1017" aria-hidden="true" tabindex="-1"></a>get_first_seat_from_vec <span class="ot">&lt;-</span> <span class="cf">function</span>(vec) {</span>
<span id="cb81-1018"><a href="#cb81-1018" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1019"><a href="#cb81-1019" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(vec <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"#"</span>, <span class="st">"L"</span>))) {</span>
<span id="cb81-1020"><a href="#cb81-1020" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(vec[<span class="fu">min</span>(<span class="fu">which</span>(vec <span class="sc">!=</span> <span class="st">"."</span>))])</span>
<span id="cb81-1021"><a href="#cb81-1021" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-1022"><a href="#cb81-1022" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1023"><a href="#cb81-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb81-1024"><a href="#cb81-1024" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1025"><a href="#cb81-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1026"><a href="#cb81-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1027"><a href="#cb81-1027" aria-hidden="true" tabindex="-1"></a>Now, if I thought getting adjacent seats to a given seat in Part 1 was fiddly, it's nothing on getting a vector from a given seat to the edge of the matrix. There are many cases to consider to make we we don't go out of bounds. In the diagonal directions, first we get a matrix of the indices of the matrix we need, then subset into the matrix accordingly.</span>
<span id="cb81-1028"><a href="#cb81-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1031"><a href="#cb81-1031" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1032"><a href="#cb81-1032" aria-hidden="true" tabindex="-1"></a><span class="co"># takes a layout matrix (elements ".", "#", "L")</span></span>
<span id="cb81-1033"><a href="#cb81-1033" aria-hidden="true" tabindex="-1"></a><span class="co"># returns vector with first "L" or "#" encountered in each direction</span></span>
<span id="cb81-1034"><a href="#cb81-1034" aria-hidden="true" tabindex="-1"></a>get_first_seat <span class="ot">&lt;-</span> <span class="cf">function</span>(mat, i,j) {</span>
<span id="cb81-1035"><a href="#cb81-1035" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1036"><a href="#cb81-1036" aria-hidden="true" tabindex="-1"></a>  nr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(mat)</span>
<span id="cb81-1037"><a href="#cb81-1037" aria-hidden="true" tabindex="-1"></a>  nc <span class="ot">&lt;-</span> <span class="fu">ncol</span>(mat)</span>
<span id="cb81-1038"><a href="#cb81-1038" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1039"><a href="#cb81-1039" aria-hidden="true" tabindex="-1"></a>  <span class="co"># North</span></span>
<span id="cb81-1040"><a href="#cb81-1040" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>) N <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1041"><a href="#cb81-1041" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) N <span class="ot">&lt;-</span> mat[(i<span class="dv">-1</span>)<span class="sc">:</span><span class="dv">1</span>,j]</span>
<span id="cb81-1042"><a href="#cb81-1042" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1043"><a href="#cb81-1043" aria-hidden="true" tabindex="-1"></a>  <span class="co"># South</span></span>
<span id="cb81-1044"><a href="#cb81-1044" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> nr) S <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1045"><a href="#cb81-1045" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> nr) S <span class="ot">&lt;-</span> mat[(i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nr,j]</span>
<span id="cb81-1046"><a href="#cb81-1046" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1047"><a href="#cb81-1047" aria-hidden="true" tabindex="-1"></a>  <span class="co"># East</span></span>
<span id="cb81-1048"><a href="#cb81-1048" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">==</span> nc) E <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1049"><a href="#cb81-1049" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">&lt;</span> nc) E <span class="ot">&lt;-</span> mat[i, (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>nc]</span>
<span id="cb81-1050"><a href="#cb81-1050" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1051"><a href="#cb81-1051" aria-hidden="true" tabindex="-1"></a>  <span class="co"># West</span></span>
<span id="cb81-1052"><a href="#cb81-1052" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">==</span> <span class="dv">1</span>) W <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1053"><a href="#cb81-1053" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (j <span class="sc">&gt;</span> <span class="dv">1</span>) W <span class="ot">&lt;-</span> mat[i, (j<span class="dv">-1</span>)<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb81-1054"><a href="#cb81-1054" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1055"><a href="#cb81-1055" aria-hidden="true" tabindex="-1"></a>  <span class="co"># how far in each direction to edge of matrix</span></span>
<span id="cb81-1056"><a href="#cb81-1056" aria-hidden="true" tabindex="-1"></a>  to_N <span class="ot">&lt;-</span> i <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb81-1057"><a href="#cb81-1057" aria-hidden="true" tabindex="-1"></a>  to_S <span class="ot">&lt;-</span> nr <span class="sc">-</span> i</span>
<span id="cb81-1058"><a href="#cb81-1058" aria-hidden="true" tabindex="-1"></a>  to_E <span class="ot">&lt;-</span> nc <span class="sc">-</span> j</span>
<span id="cb81-1059"><a href="#cb81-1059" aria-hidden="true" tabindex="-1"></a>  to_W <span class="ot">&lt;-</span> j <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb81-1060"><a href="#cb81-1060" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1061"><a href="#cb81-1061" aria-hidden="true" tabindex="-1"></a>  <span class="co"># North-West</span></span>
<span id="cb81-1062"><a href="#cb81-1062" aria-hidden="true" tabindex="-1"></a>  NW_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_N, to_W)</span>
<span id="cb81-1063"><a href="#cb81-1063" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1064"><a href="#cb81-1064" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> j <span class="sc">==</span> <span class="dv">1</span>) NW <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1065"><a href="#cb81-1065" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb81-1066"><a href="#cb81-1066" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb81-1067"><a href="#cb81-1067" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">-</span>NW_length), (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">-</span>NW_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb81-1068"><a href="#cb81-1068" aria-hidden="true" tabindex="-1"></a>    NW <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb81-1069"><a href="#cb81-1069" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-1070"><a href="#cb81-1070" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1071"><a href="#cb81-1071" aria-hidden="true" tabindex="-1"></a>  <span class="co"># North-East</span></span>
<span id="cb81-1072"><a href="#cb81-1072" aria-hidden="true" tabindex="-1"></a>  NE_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_N, to_E)</span>
<span id="cb81-1073"><a href="#cb81-1073" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1074"><a href="#cb81-1074" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> j <span class="sc">==</span> nc) NE <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1075"><a href="#cb81-1075" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb81-1076"><a href="#cb81-1076" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb81-1077"><a href="#cb81-1077" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="dv">-1</span>)<span class="sc">:</span>(i<span class="sc">-</span>NE_length), (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(j<span class="sc">+</span>NE_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb81-1078"><a href="#cb81-1078" aria-hidden="true" tabindex="-1"></a>    NE <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb81-1079"><a href="#cb81-1079" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-1080"><a href="#cb81-1080" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1081"><a href="#cb81-1081" aria-hidden="true" tabindex="-1"></a>  <span class="co"># South-East</span></span>
<span id="cb81-1082"><a href="#cb81-1082" aria-hidden="true" tabindex="-1"></a>  SE_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_S, to_E)</span>
<span id="cb81-1083"><a href="#cb81-1083" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1084"><a href="#cb81-1084" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">|</span> j <span class="sc">==</span> nc) SE <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1085"><a href="#cb81-1085" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb81-1086"><a href="#cb81-1086" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb81-1087"><a href="#cb81-1087" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(i<span class="sc">+</span>SE_length), (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(j<span class="sc">+</span>SE_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb81-1088"><a href="#cb81-1088" aria-hidden="true" tabindex="-1"></a>    SE <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb81-1089"><a href="#cb81-1089" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-1090"><a href="#cb81-1090" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1091"><a href="#cb81-1091" aria-hidden="true" tabindex="-1"></a>  <span class="co"># South-West</span></span>
<span id="cb81-1092"><a href="#cb81-1092" aria-hidden="true" tabindex="-1"></a>  SW_length <span class="ot">&lt;-</span> <span class="fu">min</span>(to_S, to_W)</span>
<span id="cb81-1093"><a href="#cb81-1093" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1094"><a href="#cb81-1094" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> nr <span class="sc">|</span> j <span class="sc">==</span> <span class="dv">1</span>) SW <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb81-1095"><a href="#cb81-1095" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb81-1096"><a href="#cb81-1096" aria-hidden="true" tabindex="-1"></a>    mat_index <span class="ot">&lt;-</span> </span>
<span id="cb81-1097"><a href="#cb81-1097" aria-hidden="true" tabindex="-1"></a>      <span class="fu">matrix</span>(<span class="fu">c</span>((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(i<span class="sc">+</span>SW_length), (j<span class="dv">-1</span>)<span class="sc">:</span>(j<span class="sc">-</span>SW_length)), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb81-1098"><a href="#cb81-1098" aria-hidden="true" tabindex="-1"></a>    SW <span class="ot">&lt;-</span> mat[mat_index]</span>
<span id="cb81-1099"><a href="#cb81-1099" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb81-1100"><a href="#cb81-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1101"><a href="#cb81-1101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vectors from mat[i,j] to the edge in each direction </span></span>
<span id="cb81-1102"><a href="#cb81-1102" aria-hidden="true" tabindex="-1"></a>  all_vecs <span class="ot">&lt;-</span> </span>
<span id="cb81-1103"><a href="#cb81-1103" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">list</span>(<span class="at">N =</span> N, <span class="at">S =</span> S, <span class="at">E =</span> E, <span class="at">W =</span> W, <span class="at">NW =</span> NW, <span class="at">NE =</span> NE, <span class="at">SE =</span> SE, <span class="at">SW =</span> SW))</span>
<span id="cb81-1104"><a href="#cb81-1104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1105"><a href="#cb81-1105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the first seat in each direction, collapsed to a vector</span></span>
<span id="cb81-1106"><a href="#cb81-1106" aria-hidden="true" tabindex="-1"></a>  first_seats <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_chr</span>(all_vecs, get_first_seat_from_vec)</span>
<span id="cb81-1107"><a href="#cb81-1107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1108"><a href="#cb81-1108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove NAs from list and return</span></span>
<span id="cb81-1109"><a href="#cb81-1109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (these occur either when starting on an edge, </span></span>
<span id="cb81-1110"><a href="#cb81-1110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># or when there are no seats in a given direction)</span></span>
<span id="cb81-1111"><a href="#cb81-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(first_seats[<span class="sc">!</span><span class="fu">is.na</span>(first_seats)])</span>
<span id="cb81-1112"><a href="#cb81-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1113"><a href="#cb81-1113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1114"><a href="#cb81-1114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1115"><a href="#cb81-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1118"><a href="#cb81-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb81-1119"><a href="#cb81-1119" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> initial_layout</span>
<span id="cb81-1120"><a href="#cb81-1120" aria-hidden="true" tabindex="-1"></a>iters <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-1121"><a href="#cb81-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1122"><a href="#cb81-1122" aria-hidden="true" tabindex="-1"></a><span class="co"># loop until there are no further changes</span></span>
<span id="cb81-1123"><a href="#cb81-1123" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb81-1124"><a href="#cb81-1124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1125"><a href="#cb81-1125" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb81-1126"><a href="#cb81-1126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1127"><a href="#cb81-1127" aria-hidden="true" tabindex="-1"></a>  seats_to_change <span class="ot">&lt;-</span> </span>
<span id="cb81-1128"><a href="#cb81-1128" aria-hidden="true" tabindex="-1"></a>    seats_df <span class="sc">%&gt;%</span></span>
<span id="cb81-1129"><a href="#cb81-1129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb81-1130"><a href="#cb81-1130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">change_seat =</span> <span class="fu">needs_changing</span>(layout,i,j, get_first_seat, <span class="dv">5</span>))   </span>
<span id="cb81-1131"><a href="#cb81-1131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1132"><a href="#cb81-1132" aria-hidden="true" tabindex="-1"></a>  change <span class="ot">&lt;-</span> <span class="fu">sum</span>(seats_to_change<span class="sc">$</span>change_seat)</span>
<span id="cb81-1133"><a href="#cb81-1133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1134"><a href="#cb81-1134" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (change <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">break</span></span>
<span id="cb81-1135"><a href="#cb81-1135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1136"><a href="#cb81-1136" aria-hidden="true" tabindex="-1"></a>  indices_to_change <span class="ot">&lt;-</span> </span>
<span id="cb81-1137"><a href="#cb81-1137" aria-hidden="true" tabindex="-1"></a>    seats_to_change <span class="sc">%&gt;%</span></span>
<span id="cb81-1138"><a href="#cb81-1138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(change_seat) <span class="sc">%&gt;%</span></span>
<span id="cb81-1139"><a href="#cb81-1139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(i,j) <span class="sc">%&gt;%</span></span>
<span id="cb81-1140"><a href="#cb81-1140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()  </span>
<span id="cb81-1141"><a href="#cb81-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1142"><a href="#cb81-1142" aria-hidden="true" tabindex="-1"></a>  layout[indices_to_change] <span class="ot">&lt;-</span> </span>
<span id="cb81-1143"><a href="#cb81-1143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setdiff</span>(<span class="fu">c</span>(<span class="st">"L"</span>, <span class="st">"#"</span>),  layout[indices_to_change])</span>
<span id="cb81-1144"><a href="#cb81-1144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-1145"><a href="#cb81-1145" aria-hidden="true" tabindex="-1"></a>  iters <span class="ot">&lt;-</span> iters <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb81-1146"><a href="#cb81-1146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1147"><a href="#cb81-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1148"><a href="#cb81-1148" aria-hidden="true" tabindex="-1"></a>part_2_iters <span class="ot">&lt;-</span> iters</span>
<span id="cb81-1149"><a href="#cb81-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(layout<span class="sc">==</span> <span class="st">"#"</span>)</span>
<span id="cb81-1150"><a href="#cb81-1150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb81-1151"><a href="#cb81-1151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1152"><a href="#cb81-1152" aria-hidden="true" tabindex="-1"></a>On the test set, this takes <span class="in">`r part_2_iters`</span> iterations. On the full data set, my answer is 2128, and it took 87 iterations. Given this is fewer iterations than in Part 1, it must be my code for getting the first seat that's slowing things down. </span>
<span id="cb81-1153"><a href="#cb81-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1154"><a href="#cb81-1154" aria-hidden="true" tabindex="-1"></a>I am unsatisfied both by how many lines of code this has taken as well as the time taken to run. The introduction to Advent of Code says that each challenge has a solution that will complete in at most 15 seconds on ten year old hardware. So clearly there's a better way of doing this. Perhaps something to revisit in the future.</span>
<span id="cb81-1155"><a href="#cb81-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1156"><a href="#cb81-1156" aria-hidden="true" tabindex="-1"></a><span class="fu">## Next</span></span>
<span id="cb81-1157"><a href="#cb81-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-1158"><a href="#cb81-1158" aria-hidden="true" tabindex="-1"></a>I was late to the game, and that was as far as I managed to get in December 2020. I'm looking forward to taking on the challenge again in 2021!</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>



</div><script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>